update tblopciones set localidadlocal='0';
insert into tblactualizaciones(version) values('ver 9017 rev 2');

ALTER TABLE `tblinventario` ADD COLUMN `porlotes` TINYINT UNSIGNED NOT NULL AFTER `separarkit`;

CREATE TABLE `tblcompraslotes` (
  `id` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idlote` INTEGER UNSIGNED NOT NULL,
  `iddetalle` INTEGER UNSIGNED NOT NULL,
  `cantidad` DOUBLE NOT NULL,
  `surtido` DOUBLE NOT NULL,
  PRIMARY KEY (`id`)
)
ENGINE = InnoDB;


CREATE TABLE `tblinventariolotes` (
  `idlote` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `lote` VARCHAR(45) NOT NULL,
  `fechacaducidad` VARCHAR(10) NOT NULL,
  `cantidad` DOUBLE NOT NULL,
  `idinventario` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`idlote`)
)
ENGINE = InnoDB;

DELIMITER $$

DROP PROCEDURE IF EXISTS `spmodificainventariolotes` $$
CREATE PROCEDURE `spmodificainventariolotes` (pidlote int,pcantidad double,pcantidadant double,pmodo tinyint)
BEGIN

declare vcantidad double;

set vcantidad=ifnull((select cantidad from tblinventariolotes where idlote=pidlote),0);

  if pmodo=0 then
  set vcantidad=vcantidad+pcantidad;
  end if;
  if pmodo=1 then
  set vcantidad=vcantidad-pcantidad;
  end if;
  if pmodo=2 then
  set vcantidad=vcantidad-pcantidadant+pcantidad;
  end if;
  if pmodo=3 then
  set vcantidad=vcantidad+pcantidadant-pcantidad;
  end if;

update tblinventariolotes set cantidad=vcantidad where idlote=pidlote;

END $$

DELIMITER ;

CREATE TABLE `tblrepmovimientosclientes` (
  `idmovimiento` INTEGER UNSIGNED NOT NULL,
  `fecha` VARCHAR(10) NOT NULL,
  `concepto` VARCHAR(100) NOT NULL,
  `serie` VARCHAR(20) NOT NULL,
  `folio` INTEGER UNSIGNED NOT NULL,
  `cantidad` DOUBLE NOT NULL,
  `nombrei` VARCHAR(450) NOT NULL,
  `clavei` VARCHAR(45) NOT NULL,
  `precio` DOUBLE NOT NULL,
  `preciou` DOUBLE NOT NULL,
  `almacen1` VARCHAR(45) NOT NULL,
  `almacen2` VARCHAR(45) NOT NULL,
  `costobase` DOUBLE NOT NULL,
  `conceptotipo` TINYINT UNSIGNED NOT NULL,
  `referencia` VARCHAR(45) NOT NULL,
  `idcliente` INTEGER UNSIGNED NOT NULL,
  `nombrec` VARCHAR(450) NOT NULL
)
ENGINE = InnoDB;
ALTER TABLE `tblrepmovimientosclientes` ADD COLUMN `idconcepto` INTEGER UNSIGNED NOT NULL AFTER `nombrec`;




DROP TABLE IF EXISTS `tbldetallesequipos`;
CREATE TABLE  `tbldetallesequipos` (
  `idDetalles` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idEquipo` int(10) unsigned NOT NULL,
  `Cantidad` varchar(5) NOT NULL,
  `idInventario` int(10) unsigned NOT NULL,
  `TiempoVida` varchar(6) NOT NULL,
  `fecha` varchar(45) NOT NULL,
  PRIMARY KEY (`idDetalles`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tblserviciosinventario2`;
CREATE TABLE  `tblserviciosinventario2` (
  `idserviciosinventario` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idevento` int(10) unsigned NOT NULL,
  `idinventario` int(10) unsigned NOT NULL,
  `precio` double NOT NULL,
  `cantidad` int(10) unsigned NOT NULL,
  `Total` double NOT NULL,
  `idEquipo` int(10) unsigned NOT NULL,
  `fecha` varchar(11) NOT NULL,
  PRIMARY KEY (`idserviciosinventario`)
) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=latin1;

ALTER TABLE `tblservicios` ADD COLUMN `idequipo` INTEGER UNSIGNED NOT NULL AFTER `cerrado`;



ALTER TABLE `db_services`.`tblservicioseventos` ADD COLUMN `idequipo` INTEGER UNSIGNED NOT NULL AFTER `idtecnico`;


DROP TABLE IF EXISTS `tblserviciosequipos`;
CREATE TABLE  `tblserviciosequipos` (
  `idservicioequipo` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idequipo` int(10) unsigned NOT NULL,
  `idservicio` int(10) unsigned NOT NULL,
  `idcliente` int(10) unsigned NOT NULL,
  PRIMARY KEY (`idservicioequipo`),
  KEY `FK_tblserviciosequipos_1` (`idequipo`),
  KEY `FK_tblserviciosequipos_2` (`idservicio`),
  CONSTRAINT `FK_tblserviciosequipos_1` FOREIGN KEY (`idequipo`) REFERENCES `tblclientesequipos` (`idequipo`) ON UPDATE NO ACTION,
  CONSTRAINT `FK_tblserviciosequipos_2` FOREIGN KEY (`idservicio`) REFERENCES `tblservicios` (`idservicio`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `tblservicioseventos`;
CREATE TABLE  `tblservicioseventos` (
  `idevento` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idservicio` int(10) unsigned NOT NULL,
  `idclasificacion` int(10) unsigned NOT NULL,
  `idclasificacion2` int(10) unsigned NOT NULL,
  `comentario` varchar(100) NOT NULL,
  `tiempo` double NOT NULL,
  `precio` double NOT NULL,
  `idtecnico` int(10) unsigned NOT NULL,
  `idEquipo` int(10) unsigned NOT NULL,
  PRIMARY KEY (`idevento`),
  KEY `FK_tblservicioseventos_1` (`idservicio`),
  KEY `FK_tblservicioseventos_2` (`idclasificacion`),
  KEY `FK_tblservicioseventos_3` (`idclasificacion2`),
  KEY `FK_tblservicioseventos_4` (`idtecnico`),
  CONSTRAINT `FK_tblservicioseventos_1` FOREIGN KEY (`idservicio`) REFERENCES `tblservicios` (`idservicio`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT `FK_tblservicioseventos_2` FOREIGN KEY (`idclasificacion`) REFERENCES `tblserviciosclasificaciones` (`idclasificacion`) ON UPDATE NO ACTION,
  CONSTRAINT `FK_tblservicioseventos_3` FOREIGN KEY (`idclasificacion2`) REFERENCES `tblserviciosclasificaciones2` (`idclasificacion2`) ON UPDATE NO ACTION,
  CONSTRAINT `FK_tblservicioseventos_4` FOREIGN KEY (`idtecnico`) REFERENCES `tbltecnicos` (`idtecnico`) ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `tblserviciosinventario2`;
CREATE TABLE  `tblserviciosinventario2` (
  `idserviciosinventario` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idevento` int(10) unsigned NOT NULL,
  `idinventario` int(10) unsigned NOT NULL,
  `precio` double NOT NULL,
  `cantidad` int(10) unsigned NOT NULL,
  `Total` double NOT NULL,
  `idEquipo` int(10) unsigned NOT NULL,
  `fecha` varchar(11) NOT NULL,
  PRIMARY KEY (`idserviciosinventario`)
) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tblserviciosinventario`;
CREATE TABLE  `tblserviciosinventario` (
  `idserviciosinventario` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idevento` int(10) unsigned NOT NULL,
  `idinventario` int(10) unsigned NOT NULL,
  `precio` double NOT NULL,
  `cantidad` int(3) unsigned NOT NULL,
  `Total` double NOT NULL,
  PRIMARY KEY (`idserviciosinventario`),
  KEY `FK_tblserviciosinventario_1` (`idevento`),
  KEY `FK_tblserviciosinventario_2` (`idinventario`),
  CONSTRAINT `FK_tblserviciosinventario_1` FOREIGN KEY (`idevento`) REFERENCES `tblservicioseventos` (`idevento`) ON DELETE CASCADE ON UPDATE NO ACTION,
  CONSTRAINT `FK_tblserviciosinventario_2` FOREIGN KEY (`idinventario`) REFERENCES `tblinventario` (`idinventario`) ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;





delete from tblimpresionesnodos where documento=34 and idsucursal=1;
insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho) values(500,100,34,1,66,4,0,864);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(540,63,'Fecha:','fechaCheque',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Fecha Cheque',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,122,'A nombre de:','nombreCheque',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'A nombre de',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,150,'SON:','cantidadLetra',400,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Cantidad con letra',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(600,122,'Cantidad:','cantidad',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Cantidad',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,388,'Concepto:','concepto',480,45,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Concepto',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(546,388,'Firma Cheque Recibido:','firmaChequeRecibido',300,25,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Firma Cheque Recibido',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,446,'Cuenta:','Cuenta',250,20,'Microsoft Sans Serif',7,0,0,1,0,1,34,1,0,0,'Cuenta',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(298,446,'Descripción:','descripcion',300,20,'Microsoft Sans Serif',7,0,0,1,0,1,34,1,0,0,'Descripción',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(607,446,'Debe:','debe',120,20,'Microsoft Sans Serif',7,0,0,1,0,1,34,1,0,0,'Debe',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(727,446,'Haber:','haber',120,20,'Microsoft Sans Serif',7,0,0,1,0,1,34,1,0,0,'Haber',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(607,900,'Total Debe:','totalDebe',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Total debe',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(727,900,'Total Haber:','totalHacer',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Total hacer',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,900,'Número Póliza:','numeroPoliza',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Número Póliza',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(168,900,'Hecha por:','hechaPor',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Hecha por',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(293,900,'Autorizada por::','autorizadaPor',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Autorizada por',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(418,900,'Auxiliares:','auxiliares',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,34,1,0,0,'Auxiliares',0,0);

delete from tblimpresionesnodos where documento=37 and idsucursal=1;
insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho) values(500,100,37,1,66,4,0,864);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,388,'Concepto:','concepto',480,45,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Concepto',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(546,388,'Firma Cheque Recibido:','firmaChequeRecibido',300,25,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Firma Cheque Recibido',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,446,'Cuenta:','Cuenta',250,20,'Microsoft Sans Serif',7,0,0,1,0,1,37,1,0,0,'Cuenta',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(298,446,'Descripción:','descripcion',300,20,'Microsoft Sans Serif',7,0,0,1,0,1,37,1,0,0,'Descripción',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(607,446,'Debe:','debe',120,20,'Microsoft Sans Serif',7,0,0,1,0,1,37,1,0,0,'Debe',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(727,446,'Haber:','haber',120,20,'Microsoft Sans Serif',7,0,0,1,0,1,37,1,0,0,'Haber',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(607,900,'Total Debe:','totalDebe',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Total debe',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(727,900,'Total Haber:','totalHacer',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Total hacer',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,900,'Número Póliza:','numeroPoliza',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Número Póliza',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(168,900,'Hecha por:','hechaPor',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Hecha por',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(293,900,'Autorizada por::','autorizadaPor',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Autorizada por',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(418,900,'Auxiliares:','auxiliares',120,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Auxiliares',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,50,'Num. Cuenta','nCuenta',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Num. Cuenta',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(214,50,'Banco','banco',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Banco',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(645,15,'Fecha','fecha',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'Fecha',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,82,'Referencia','referencia',500,40,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'referencia',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,134,'Banco Cliente','bancoCliente',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'bancoCliente',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,167,'Cantidad','cantidad',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,37,1,0,0,'cantidad',0,0);




delete from tblimpresionesnodos where documento=35 and idsucursal=1;
insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho) values(500,100,35,1,66,4,0,864);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(600,42,'Mes I.:','mesInicial',50,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Mes Inicial',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(655,42,'Mes F.:','mesFinal',50,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Mes Final',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(710,42,'Ejercicio:','ejercico',50,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Ejercicio',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(140,117,'RFC:','rfc',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'RFC.',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(140,147,'CURP:','curp',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'CURP.',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(140,177,'Nombre:','nombre',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Nombre',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(229,412,'Cantidad Gravada - ISR','CGISR',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Cantidad Grabada - ISR',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(395,412,'Cantidad Gravada - IVA','CGIVA',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Cantidad Grabada - IVA',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(562,412,'Cantidad Gravada - IEPS','CGIEPS',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Cantidad Grabada - IEPS',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(229,464,'Cantidad Retenida - ISR','CRISR',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Cantidad Retenida - ISR',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(395,464,'Cantidad Retenida - IVA','CRIVA',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Cantidad Retenida - IVA',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(562,464,'Cantidad Retenida - IEPS','CRIEPS',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Cantidad Retenida - IEPS',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(181,525,'Retenedor - RFC','retenedorRFC',250,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Retenedor - RFC',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(181,556,'Retenedor - Nombre','retenedorNombre',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Retenedor - Nombre',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(181,586,'Retenedor - Nombre representante legal','retenedorRepresentante',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Retenedor - Nombre representante legal',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(181,618,'Retenedor - RFC representante legal','retenedorRFCRepresentante',250,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Retenedor - RFC representante legal',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(76,700,'Firma retenedor o representante','firmaRetenedor',250,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Firma retenedor',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(250,700,'Firma recibido','firmaRecibido',250,20,'Microsoft Sans Serif',7,0,0,0,0,1,35,1,0,0,'Firma recibido',0,0);


delete from tblimpresionesnodos where documento=36 and idsucursal=1;
insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho) values(500,100,36,1,66,4,0,864);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(740,58,'Formato - Clave:','formatoClave',100,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Formato - Clave',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(682,89,'Numero:','numero',50,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Numero',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(741,89,'Día:','dia',30,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Día',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(783,89,'Mes:','mes',30,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Mes',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(824,89,'Año:','anio',30,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Año',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(112,147,'UR - Clave:','URClave',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Unidad Responsable - Clave',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(275,147,'UR - Denominación:','URDenominacion',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Unidad Responsable - Denominación',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(112,198,'Solicitante','solicitante',663,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Solicitante',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(275,250,'Descripción','descripcion',500,60,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Descripción',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(275,344,'Proveedor - Nombre','proveedorNombre',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Proveedor - Nombre',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(275,379,'Proveedor - RFC','proveedorRFC',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Proveedor - RFC',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(275,414,'Proveedor - Domicilio','proveedorDomicilio',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Proveedor - Domicilio',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(112,474,'Partida:','partida',150,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Partida',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(279,474,'Forma de pago:','formaPago',180,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Forma de pago',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(478,474,'Costo:','costo',80,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Costo',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(566,474,'% IVA','porcientoIVA',30,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'% IVA',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(604,474,'Importe IVA','importeIVA',80,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Importe IVA',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(692,474,'Importe Total','importeTotal',82,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Importe Total',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(112,573,'Firma Proveedor','firmaProveedor',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Firma Proveedor',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(341,573,'Firma Servicios Admin.','firmaServicios',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Firma Servicios Admin.',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(575,573,'Firma Titular','firmaTitular',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,36,1,0,0,'Firma Titular',0,0);


DROP TABLE IF EXISTS `tbldescuentos`;
CREATE TABLE  `tbldescuentos` (
  `idDescuento` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `activado` tinyint(1) NOT NULL,
  `descuento` varchar(10) NOT NULL,
  `descripcion` varchar(45) NOT NULL,
  `fechai` varchar(25) NOT NULL,
  `horai` varchar(16) NOT NULL,
  `fechaf` varchar(25) NOT NULL,
  `horaf` varchar(16) NOT NULL,
  `productos` varchar(4000) NOT NULL,
  `tipoDescuento` varchar(15) NOT NULL,
  `Folio` int(11) NOT NULL,
  `FechaInicioC` varchar(30) NOT NULL,
  `FechaFinalC` varchar(30) NOT NULL,
  PRIMARY KEY (`idDescuento`)
) ENGINE=InnoDB AUTO_INCREMENT=106 DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tblventasdesc`;
CREATE TABLE  `tblventasdesc` (
  `idVentasDesc` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idVenta` int(10) unsigned NOT NULL,
  `idDescuento` int(10) unsigned NOT NULL,
  `folioVenta` int(10) unsigned NOT NULL,
  `perteneciente` int(10) unsigned NOT NULL,
  `perte` varchar(45) NOT NULL,
  PRIMARY KEY (`idVentasDesc`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tbldescpromociones`;
CREATE TABLE  `tbldescpromociones` (
  `idPromociones` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `folioVenta` int(10) unsigned NOT NULL,
  `folioDescuento` int(10) unsigned NOT NULL,
  `idProducto` int(10) unsigned NOT NULL,
  `renglon` int(10) unsigned NOT NULL,
  PRIMARY KEY (`idPromociones`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

DELIMITER $$

DROP FUNCTION IF EXISTS `spmodificainventariolotesf` $$
CREATE FUNCTION `spmodificainventariolotesf` (pidlote int,pcantidad double,pcantidadant double,pmodo tinyint) RETURNS INT
BEGIN

declare vcantidad double;

set vcantidad=ifnull((select cantidad from tblinventariolotes where idlote=pidlote),0);


if pmodo=0 then
  set vcantidad=vcantidad+pcantidad;
  end if;
  if pmodo=1 then
  set vcantidad=vcantidad-pcantidad;
  end if;
  if pmodo=2 then
  set vcantidad=vcantidad-pcantidadant+pcantidad;
  end if;
  if pmodo=3 then
  set vcantidad=vcantidad+pcantidadant-pcantidad;
  end if;


update tblinventariolotes set cantidad=vcantidad where idlote=pidlote;

return 0;

END $$

DELIMITER ;

insert into tblactualizaciones(version) values('ver 9017 rev 6');


DROP TABLE IF EXISTS `tbldetallesequipos`;
CREATE TABLE  `tbldetallesequipos` (
  `idDetalles` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idEquipo` int(10) unsigned NOT NULL,
  `Cantidad` varchar(5) NOT NULL,
  `idInventario` int(10) unsigned NOT NULL,
  `TiempoVida` varchar(6) NOT NULL,
  `fecha` varchar(45) NOT NULL,
  PRIMARY KEY (`idDetalles`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tblserviciosinventario2`;
CREATE TABLE  `tblserviciosinventario2` (
  `idserviciosinventario` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idevento` int(10) unsigned NOT NULL,
  `idinventario` int(10) unsigned NOT NULL,
  `precio` double NOT NULL,
  `cantidad` int(10) unsigned NOT NULL,
  `Total` double NOT NULL,
  `idEquipo` int(10) unsigned NOT NULL,
  `fecha` varchar(11) NOT NULL,
  PRIMARY KEY (`idserviciosinventario`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=latin1;

ALTER TABLE `tblusuarios` ADD COLUMN `permisos9` BIGINT UNSIGNED NOT NULL AFTER `permisos8`;

DROP TABLE IF EXISTS `tbltrabajadores`;
CREATE TABLE  `tbltrabajadores` (
  `idtrabajador` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre` varchar(450) NOT NULL,
  `registropatronal` varchar(25) NOT NULL,
  `numeroempleado` varchar(20) NOT NULL,
  `curp` varchar(45) NOT NULL,
  `tiporegimen` tinyint(3) unsigned NOT NULL,
  `numerosegurosocial` varchar(20) NOT NULL,
  `fechainiciolaboral` varchar(10) NOT NULL,
  `antiguedad` int(10) unsigned NOT NULL,
  `departamento` varchar(100) NOT NULL,
  `puesto` varchar(200) NOT NULL,
  `tipojornada` varchar(200) NOT NULL,
  `tipocontrato` varchar(200) NOT NULL,
  `periodicidad` varchar(100) NOT NULL,
  `salariobasecotapor` double NOT NULL,
  `riesgopuesto` tinyint(3) unsigned NOT NULL,
  `salariodiariointegrado` double NOT NULL,
  `direccion` varchar(450) NOT NULL,
  `telefono` varchar(150) NOT NULL,
  `email` varchar(600) NOT NULL,
  `rfc` varchar(15) NOT NULL,
  `ciudad` varchar(45) NOT NULL,
  `cp` varchar(5) NOT NULL,
  `estado` varchar(45) NOT NULL,
  `pais` varchar(45) NOT NULL,
  `noexterior` varchar(20) NOT NULL,
  `nointerior` varchar(20) NOT NULL,
  `colonia` varchar(45) NOT NULL,
  `municipio` varchar(45) NOT NULL,
  `referencia` varchar(150) NOT NULL,
  `banco` int(10) unsigned NOT NULL,
  `clabe` varchar(45) NOT NULL,
  PRIMARY KEY (`idtrabajador`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;

CREATE TABLE `tblpercepciones` (
  `idpercepcion` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `clave` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`idpercepcion`)
)
ENGINE = InnoDB;

CREATE TABLE `tbldeducciones` (
  `iddeduccion` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `clave` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`iddeduccion`)
)
ENGINE = InnoDB;


insert into tblpercepciones(clave,descripcion) values('001','Sueldos, Salarios, Rayas y Jornales');
insert into tblpercepciones(clave,descripcion) values('002','Gratificacion Anual (Aguinaldo)');
insert into tblpercepciones(clave,descripcion) values('003','Participacion de los trabajadores en las utildades PTU');
insert into tblpercepciones(clave,descripcion) values('004','Reembolso de gastos médicos, dentales y hospitalarios');
insert into tblpercepciones(clave,descripcion) values('005','Fondo de Ahorro');
insert into tblpercepciones(clave,descripcion) values('006','Caja de ahorro');
insert into tblpercepciones(clave,descripcion) values('007','Vales');
insert into tblpercepciones(clave,descripcion) values('008','Ayudas');
insert into tblpercepciones(clave,descripcion) values('009','Contribuciones a cargo del trabajador pagadas por el patrón');
insert into tblpercepciones(clave,descripcion) values('010','Premios por puntualidad');
insert into tblpercepciones(clave,descripcion) values('011','Prima de seguro de vida');
insert into tblpercepciones(clave,descripcion) values('012','Seguro de gastos médicos mayores');
insert into tblpercepciones(clave,descripcion) values('013','Cuotas sindicales pagadas por el patrón');
insert into tblpercepciones(clave,descripcion) values('014','Subsidios por incapacidad');
insert into tblpercepciones(clave,descripcion) values('015','Becas para trabajadores y/o hijos');
insert into tblpercepciones(clave,descripcion) values('016','Otros');
insert into tblpercepciones(clave,descripcion) values('017','Subsidio para el empleo');
insert into tblpercepciones(clave,descripcion) values('018','Fomento al primer empleo');
insert into tblpercepciones(clave,descripcion) values('019','Horas Extra');
insert into tblpercepciones(clave,descripcion) values('020','Prima dominical');
insert into tblpercepciones(clave,descripcion) values('021','Prima vacacional');
insert into tblpercepciones(clave,descripcion) values('022','Prima por antigüedad');
insert into tblpercepciones(clave,descripcion) values('023','Pagos por separación');
insert into tblpercepciones(clave,descripcion) values('024','Seguro de retiro');
insert into tblpercepciones(clave,descripcion) values('025','Indemnizaciones');
insert into tblpercepciones(clave,descripcion) values('026','Reembolso por funeral');
insert into tblpercepciones(clave,descripcion) values('027','Cuotas de seguridad social pagadas pro el patrón');
insert into tblpercepciones(clave,descripcion) values('028','Comisiones');

insert into tbldeducciones(clave,descripcion) values('001','Seguridad Social');
insert into tbldeducciones(clave,descripcion) values('002','ISR');
insert into tbldeducciones(clave,descripcion) values('003','Aportaciones a retiro, cesantía en edad avanzada y vejez');
insert into tbldeducciones(clave,descripcion) values('004','Otros');
insert into tbldeducciones(clave,descripcion) values('005','Aportaciones a fondo de vivienda');
insert into tbldeducciones(clave,descripcion) values('006','Descuento por incapacidad');
insert into tbldeducciones(clave,descripcion) values('007','Pensión alimenticia');
insert into tbldeducciones(clave,descripcion) values('008','Renta');
insert into tbldeducciones(clave,descripcion) values('009','Prestamos provenientes del fondo nacional de la vivienda para los trabajadores');
insert into tbldeducciones(clave,descripcion) values('010','Pago por crédito de vivienda');
insert into tbldeducciones(clave,descripcion) values('011','Pago de abonos INFONACOT');
insert into tbldeducciones(clave,descripcion) values('012','Anticipo de salarios');
insert into tbldeducciones(clave,descripcion) values('013','Pagos hechos con exceso al trabajador');
insert into tbldeducciones(clave,descripcion) values('014','Errores');
insert into tbldeducciones(clave,descripcion) values('015','Pérdidas');
insert into tbldeducciones(clave,descripcion) values('016','Averías');
insert into tbldeducciones(clave,descripcion) values('017','Adquisición de artículos producidos por la empresa o establecimiento');
insert into tbldeducciones(clave,descripcion) values('018','Cuotas para la constitución y fomento de sociedades cooperaticas y de cajas de ahorro');
insert into tbldeducciones(clave,descripcion) values('019','Cuotas sindicales');
insert into tbldeducciones(clave,descripcion) values('020','Ausencia');
insert into tbldeducciones(clave,descripcion) values('021','Cuotas obrero patronales');


CREATE TABLE `tblbancoscatalogo` (
  `idbanco` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `clave` INTEGER UNSIGNED NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `nombrelargo` VARCHAR(500) NOT NULL,
  PRIMARY KEY (`idbanco`)
)
ENGINE = InnoDB;


insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(2,'BANAMEX','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(6,'BANCOMEXT','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(9,'BANOBRAS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(12,'BBVA BANCOMER','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(14,'SANTANDER','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(19,'BANJERCITO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(21,'HSBC','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(30,'BAJIO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(32,'IXE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(36,'INBURSA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(37,'INTERACCIONES','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(42,'MIFEL','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(44,'SCOTIABANK','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(58,'BANREGIO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(59,'INVEX','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(60,'BANSI','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(62,'AFIRME','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(72,'BANORTE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(102,'THE ROYAL BANK','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(103,'AMERICAN EXPRESS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(106,'BAMSA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(108,'TOKYO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(110,'JP MORGAN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(112,'BMONEX','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(113,'VE POR MAS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(116,'ING','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(124,'DEUTSCHE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(126,'CREDIT SUISSE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(127,'AZTECA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(128,'AUTOFIN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(129,'BARCLAYS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(130,'COMPARTAMOS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(131,'BANCO FAMSA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(132,'BMULTIVA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(133,'ACTINVER','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(134,'WAL-MART','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(135,'NAFIN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(136,'INTERBANCO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(137,'BANCOPPEL','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(138,'ABC CAPITAL','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(139,'UBS BANK','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(140,'CONSUBANCO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(141,'VOLKSWAGEN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(143,'CIBANCO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(145,'BBASE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(166,'BANSEFI','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(168,'HIPOTECARIA FEDERAL','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(600,'MONEXCB','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(601,'GBM','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(602,'MASARI','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(605,'VALUE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(606,'ESTRUCTURADORES','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(607,'TIBER','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(608,'VECTOR','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(610,'B&B','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(614,'ACCIVAL','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(615,'MERRIL LYNCH','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(616,'FINAMEX','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(617,'VALMEX','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(618,'UNICA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(619,'MAPFRE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(620,'PROFUTURO','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(621,'CB ACTINVER','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(622,'OACTIN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(623,'SKANDIA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(626,'CBDEUTSCHE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(627,'ZURICH','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(628,'ZURICHVI','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(629,'SU CASITA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(630,'CB INTERCAM','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(631,'CI BOLSA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(632,'BULLTICK CB','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(633,'STERLING','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(634,'FINCOMUN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(636,'HDI SEGUROS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(637,'ORDER','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(638,'AKALA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(640,'CB JPMORGAN','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(642,'REFORMA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(646,'STP','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(647,'TELECOMM','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(648,'EVERCORE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(649,'SKANDIA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(651,'SEGMTY','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(652,'ASEA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(653,'KUSPIT','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(655,'SOFIEXPRESS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(656,'UNAGRA','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(659,'OPCIONES EMPRESARIALES DEL NOROESTE','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(670,'LIBERTAD','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(901,'CLS','');
insert into tblbancoscatalogo(clave,nombre,nombrelargo) values(902,'INDEVAL','');


CREATE TABLE `tblnominas` (
  `idnomina` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idtrabajador` INTEGER UNSIGNED NOT NULL,
  `fecha` VARCHAR(10) NOT NULL,
  `folio` INTEGER UNSIGNED NOT NULL,
  `total` DOUBLE NOT NULL,
  `hora` VARCHAR(8) NOT NULL,
  `estado` TINYINT UNSIGNED NOT NULL,
  `iva` DOUBLE NOT NULL,
  `totalapagar` DOUBLE NOT NULL,
  `idsucursal` INTEGER UNSIGNED NOT NULL,
  `serie` VARCHAR(20) NOT NULL,
  `tipodecambio` DOUBLE NOT NULL,
  `noaprobacion` VARCHAR(15) NOT NULL,
  `yearaprobacion` VARCHAR(5) NOT NULL,
  `nocertificado` VARCHAR(45) NOT NULL,
  `eselectronica` TINYINT UNSIGNED NOT NULL,
  `idmoneda` INTEGER UNSIGNED NOT NULL,
  `fechacancelado` VARCHAR(10) NOT NULL,
  `horacancelado` VARCHAR(8) NOT NULL,
  `isr` DOUBLE NOT NULL,
  `ivaretenido` DOUBLE NOT NULL,
  `comentario` VARCHAR(1500) NOT NULL,
  `fechapago` VARCHAR(10) NOT NULL,
  `fechainicialpago` VARCHAR(10) NOT NULL,
  `fechafinalpago` VARCHAR(10) NOT NULL,
  `banco` INTEGER UNSIGNED NOT NULL,
  `clabe` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idnomina`)
)
ENGINE = InnoDB;


DROP TABLE IF EXISTS `tblnominadetalles`;
CREATE TABLE  `tblnominadetalles` (
  `iddetalle` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idnomina` int(10) unsigned NOT NULL,
  `tipo` int(10) unsigned NOT NULL,
  `tipodetalle` tinyint(3) unsigned NOT NULL,
  `clave` varchar(45) NOT NULL,
  `concepto` varchar(5000) NOT NULL,
  `importegravado` double NOT NULL,
  `importeexento` double NOT NULL,
  PRIMARY KEY (`iddetalle`),
  KEY `FK_tblnominadetalles_1` (`idnomina`),
  CONSTRAINT `FK_tblnominadetalles_1` FOREIGN KEY (`idnomina`) REFERENCES `tblnominas` (`idnomina`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;


DROP TABLE IF EXISTS `tblnominahorasextra`;
CREATE TABLE  `tblnominahorasextra` (
  `iddetalle` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idnomina` int(10) unsigned NOT NULL,
  `dias` int(10) unsigned NOT NULL,
  `tipohoras` varchar(10) NOT NULL,
  `horasextra` int(10) unsigned NOT NULL,
  `importepagado` double NOT NULL,
  PRIMARY KEY (`iddetalle`),
  KEY `FK_tblnominahorasextra_1` (`idnomina`),
  CONSTRAINT `FK_tblnominahorasextra_1` FOREIGN KEY (`idnomina`) REFERENCES `tblnominas` (`idnomina`) ON DELETE CASCADE ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

DROP TABLE IF EXISTS `tblnominaincapacidades`;
CREATE TABLE `tblnominaincapacidades` (
  `iddetalle` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idnomina` int(10) unsigned NOT NULL,
  `tipoincapacidad` tinyint(3) unsigned NOT NULL,
  `dias` int(10) unsigned NOT NULL,
  `descuento` double NOT NULL,
  PRIMARY KEY (`iddetalle`),
  KEY `FK_tblnomaincapacidades_1` (`idnomina`),
  CONSTRAINT `FK_tblnomaincapacidades_1` FOREIGN KEY (`idnomina`) REFERENCES `tblnominas` (`idnomina`) ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho) values(350,350,38,1,40,3,0,864);

CREATE TABLE `tblnominastimbrado` (
  `idnomina` INTEGER UNSIGNED NOT NULL,
  `uuid` VARCHAR(45) NOT NULL,
  `fechatimbrado` VARCHAR(45) NOT NULL,
  `sellocfd` VARCHAR(1000) NOT NULL,
  `nocertificadosat` VARCHAR(45) NOT NULL,
  `sellosat` VARCHAR(450) NOT NULL,
  CONSTRAINT `FK_tblnominastimbrado_1` FOREIGN KEY `FK_tblnominastimbrado_1` (`idnomina`)
    REFERENCES `tblnominas` (`idnomina`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION
)
ENGINE = InnoDB;

ALTER TABLE `tblinventario` ADD COLUMN `ieps` DOUBLE NOT NULL AFTER `porlotes`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `ieps`;

ALTER TABLE `tblventasinventario` ADD COLUMN `ieps` DOUBLE NOT NULL AFTER `tipocantidadm`,
 ADD COLUMN `IVARetenido` DOUBLE NOT NULL AFTER `ieps`;

ALTER TABLE `tblventascotizacionesinventario` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `preciooriginal`,
 ADD COLUMN `IVARetenido` DOUBLE NOT NULL AFTER `IEPS`;

ALTER TABLE `tblventaspedidosinventario` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `preciooriginal`,
 ADD COLUMN `IVARetenido` DOUBLE NOT NULL AFTER `IEPS`;

ALTER TABLE `tblventasremisionesinventario` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `preciooriginal`,
 ADD COLUMN `IVARetenido` DOUBLE NOT NULL AFTER `IEPS`;


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,0,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,0,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,0,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,0,1,0,0,'Documento - Total % IVA Retenido',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,1,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,1,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,1,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,1,1,0,0,'Documento - Total % IVA Retenido',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,2,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,2,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,2,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,2,1,0,0,'Documento - Total % IVA Retenido',0,1);



insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,3,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,3,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,3,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,3,1,0,0,'Documento - Total % IVA Retenido',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,16,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,16,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,16,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,16,1,0,0,'Documento - Total % IVA Retenido',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,17,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,17,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,17,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,17,1,0,0,'Documento - Total % IVA Retenido',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,18,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,18,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,18,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,18,1,0,0,'Documento - Total % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,507,'IEPS:','ieps',90,20,'Arial',10,0,0,1,0,0,19,1,0,0,'Documento - % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,527,'IVA RETENIDO:','ivaRetenido',90,20,'Arial',10,0,0,1,0,0,19,1,0,0,'Documento - % IVA Retenido',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Total IEPS:','Totalieps',90,20,'Arial',10,0,0,0,0,0,19,1,0,0,'Documento - Total % IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(170,1032,'Totoal IVA Retenido:','TotalivaRetenido',90,20,'Arial',10,0,0,0,0,0,19,1,0,0,'Documento - Total % IVA Retenido',0,1);

Update tblopciones set noexterior='0',nointerior='0';

ALTER TABLE `tbldevoluciones` ADD COLUMN `referenciadoc` VARCHAR(45) NOT NULL AFTER `comentario`;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(130,273,'Ubicación:','ubicacion',100,20,'Lucida Console',8,0,0,1,0,0,0,1,0,0,'Artículos - Ubicación',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(130,273,'Ubicación:','ubicacion',100,20,'Lucida Console',8,0,0,1,0,0,16,1,0,0,'Artículos - Ubicación',0,4);



insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(715,743,'Total Conceptos:','totalcon',120,20,'Lucida Console',8,0,0,0,1,0,38,1,0,1,'Documento - Total Conceptos',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,756,'Total letra','totalletracon',570,50,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Documento - Total letra conceptos',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Lugar:','lugartimbrado',300,20,'Lucida Console',8,0,0,0,0,0,0,1,0,0,'Fiscal - Lugar Elaboracion Timbrado',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Lugar:','lugartimbrado',300,20,'Lucida Console',8,0,0,0,0,0,16,1,0,0,'Fiscal - Lugar Elaboracion Timbrado',0,6);

insert into tblactualizaciones(version) values('ver 9018 rev 6');



ALTER TABLE `tblventas` ADD COLUMN `refdocumento` VARCHAR(25) NOT NULL AFTER `deremision`;
ALTER TABLE `tblventas` ADD COLUMN `adicional` VARCHAR(150) NOT NULL AFTER `refdocumento`;

update tblventas set refdocumento='',adicional='';

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Clave vendedor:','clavevendedor',300,20,'Lucida Console',8,0,0,0,0,0,0,1,0,0,'Documento - Clave vendedor',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Documento Referencia:','refdocumento',300,20,'Lucida Console',8,0,0,0,0,0,0,1,0,0,'Documento - Documento Referencia',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Adicional:','adicional',300,20,'Lucida Console',8,0,0,0,0,0,0,1,0,0,'Documento - Adicional',0,0);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Clave vendedor:','clavevendedor',300,20,'Lucida Console',8,0,0,0,0,0,16,1,0,0,'Documento - Clave vendedor',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Documento Referencia:','refdocumento',300,20,'Lucida Console',8,0,0,0,0,0,16,1,0,0,'Documento - Documento Referencia',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(231,98,'Adicional:','adicional',300,20,'Lucida Console',8,0,0,0,0,0,16,1,0,0,'Documento - Adicional',0,0);

insert into tblactualizaciones(version) values('ver 9018 rev 8');


delete from tblimpresionesnodos where documento=8 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Compra:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Folio Pre-Orden',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','docIVA',100,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(692,434,'% IVA ','docIVAcant',25,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - IVA cantidad',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,8,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle:','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col:','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP:','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC:','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel:','empresaTel',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Telefono',0,2);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail:','empresaEMail',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom:','provDom',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col:','provCol',210,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP:','provCP',90,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad:','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC:','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - RFC',0,3);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(46,369,'Codigo','artCod',100,20,'Lucida Console',8,0,0,1,0,1,8,1,0,0,'Artículos - Cant',0,4);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(548,369,'Cant:','artCant',100,20,'Lucida Console',8,0,0,1,0,1,8,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,369,'Descripcion ','artDesc',400,20,'Lucida Console',8,0,0,1,0,1,8,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,8,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe:','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,8,1,0,0,'Artículos - Importe',0,4);

delete from tblimpresionesnodos where documento=11 and idsucursal=1;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Devolución:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Documento - Folio Dev',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Documento - Fecha',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','iva',100,20,'Lucida Console',8,0,0,0,1,1,11,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Documento - Total',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,11,1,0,0,'Documento - Mensaje Candelado',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle: ','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col: ','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC: ','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel: ','empresaTel',150,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,144,'Tel:','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Empresa - EMail',0,2);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom: ','provDom',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col: ','provCol',210,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP: ','provCP',90,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,11,1,0,1,'Proveedor - RFC',0,3);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(142,369,'Código','artCod',100,20,'Lucida Console',8,0,0,1,0,1,11,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(242,369,'Cant: ','artCant',100,20,'Lucida Console',8,0,0,1,0,1,11,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(348,369,'Descripcion ','artDesc',300,20,'Lucida Console',8,0,0,1,0,1,11,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,11,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,11,1,0,0,'Artículos - Importe',0,4);


delete from tblimpresionesnodos where documento=7 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(652,52,'Folio Compra:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Folio Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(702,52,'Serie Compra','docSerie',50,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Serie Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','iva',100,20,'Lucida Console',8,0,0,0,1,1,7,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Total',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,434,'Costo indirecto: ','docCostoIndirecto',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Costo indirecto',0,1);



insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle:','empresaCalle',400,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col:','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP:','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC:','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel:','empresaTel',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail:','empresaEMail',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Empresa - EMail',0,2);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom:','provDom',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col:','provCol',210,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP:','provCP',90,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Proveedor - RFC',0,3);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,369,'Cant:','artCant',100,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Cant',0,4);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,369,'Descripcion ','artDesc',500,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Importe',0,4);

delete from tblimpresionesnodos where documento=13 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Notas de cargo:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Documento - Folio Notas',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','iva',100,20,'Lucida Console',8,0,0,0,1,1,13,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Documento - Total',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,13,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle: ','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col: ','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC: ','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel: ','empresaTel',150,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,144,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom: ','provDom',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col: ','provCol',210,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP: ','provCP',90,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,13,1,0,1,'Proveedor - RFC',0,3);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(242,369,'Cant: ','artCant',100,20,'Lucida Console',8,0,0,1,0,1,13,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(348,369,'Descripcion ','artDesc',300,20,'Lucida Console',8,0,0,1,0,1,13,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,13,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,13,1,0,0,'Artículos - Importe',0,4);

delete from tblimpresionesnodos where documento=12 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Notas de crédito:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Documento - Folio Notas',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','iva',100,20,'Lucida Console',8,0,0,0,1,1,12,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Documento - Total',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,12,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle: ','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col: ','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC: ','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel: ','empresaTel',150,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,144,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom: ','provDom',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col: ','provCol',210,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP: ','provCP',90,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,12,1,0,1,'Proveedor - RFC',0,3);



insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(242,369,'Cant: ','artCant',100,20,'Lucida Console',8,0,0,1,0,1,12,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(348,369,'Descripcion ','artDesc',300,20,'Lucida Console',8,0,0,1,0,1,12,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,12,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,12,1,0,0,'Artículos - Importe',0,4);

delete from tblimpresionesnodos where documento=9 and idsucursal=1;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Compra:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Documento - Folio Pedido',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Documento - Fecha',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','iva',100,20,'Lucida Console',8,0,0,0,1,1,9,1,0,0,'Documento - IVA',0,1);
                                                                                     															                                                     
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Documento - Total',0,1);
                                                                                                                                                                                                                                                                   

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,9,1,0,0,'Documento - Mensaje Candelado',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle: ','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col: ','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC: ','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel: ','empresaTel',150,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,144,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail: ','empresaEMail',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Empresa - EMail',0,2);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom: ','provDom',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col: ','provCol',210,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP: ','provCP',90,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,9,1,0,1,'Proveedor - RFC',0,3);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,369,'Código','artCod',100,20,'Lucida Console',8,0,0,1,0,1,9,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(145,369,'Cant: ','artCant',100,20,'Lucida Console',8,0,0,1,0,1,9,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(247,369,'Descripcion ','artDesc',400,20,'Lucida Console',8,0,0,1,0,1,9,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,9,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,9,1,0,0,'Artículos - Importe',0,4);


delete from tblimpresionesnodos where documento=8 and idsucursal=1;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Compra:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Folio Pre-Orden',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Fecha',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','iva',100,20,'Lucida Console',8,0,0,0,1,1,8,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Total',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Cantidad Letra',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,8,1,0,0,'Documento - Mensaje Candelado',0,7);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle: ','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col: ','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC: ','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel: ','empresaTel',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,144,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - EMail',0,2);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom: ','provDom',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col: ','provCol',210,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP: ','provCP',90,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Proveedor - RFC',0,3);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,369,'Cant: ','artCant',100,20,'Lucida Console',8,0,0,1,1,1,8,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,369,'Descripcion ','artDesc',500,20,'Lucida Console',8,0,0,1,1,1,8,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,1,1,8,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,1,1,8,1,0,0,'Artículos - Importe',0,4);


delete from tblimpresionesnodos where documento=10 and idsucursal=1;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(680,52,'Folio Remisión:','docFolio',50,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Documento - Folio Remisiones',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Documento - Fecha',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,410,'SubTotal ','docSubTotal',100,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,434,'IVA ','docIVA',100,20,'Lucida Console',8,0,0,0,1,1,10,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,458,'Total ','docTotal',100,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Documento - Total',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,410,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,10,1,0,0,'Documento - Mensaje Candelado',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,63,'Nombre','empresaNombre',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,84,'Calle: ','empresaCalle',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,104,'Col: ','empresaColonia',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,124,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,124,'RFC: ','empresaRFC',150,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,144,'Tel: ','empresaTel',150,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(192,144,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Empresa - EMail',0,2);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,210,'Nombre ','provNombre',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,230,'Dom: ','provDom',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,250,'Col: ','provCol',210,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,250,'CP: ','provCP',90,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,270,'Ciudad: ','provCiudad',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,290,'RFC: ','provRFC',300,20,'Lucida Console',8,0,0,0,0,1,10,1,0,1,'Proveedor - RFC',0,3);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(142,369,'Código','artCodigo',100,20,'Lucida Console',8,0,0,1,0,1,10,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(242,369,'Cant: ','artCant',100,20,'Lucida Console',8,0,0,1,0,1,10,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(348,369,'Descripcion ','artDesc',300,20,'Lucida Console',8,0,0,1,0,1,10,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(648,369,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,10,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(748,369,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,10,1,0,0,'Artículos - Importe',0,4);


DROP TABLE IF EXISTS `tbladdendapepsico`;
CREATE TABLE  `tbladdendapepsico` (
  `idAddenda` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `tipo` varchar(10) NOT NULL,
  `version` int(10) unsigned NOT NULL,
  `idPedido` varchar(10) NOT NULL,
  `idSolicitudPago` varchar(10) DEFAULT NULL,
  `referencia` varchar(46) DEFAULT NULL,
  `serie` varchar(10) DEFAULT NULL,
  `folio` varchar(20) DEFAULT NULL,
  `folioUUID` varchar(36) DEFAULT NULL,
  `tipoDoc` int(10) unsigned NOT NULL,
  `idProveedor` varchar(10) NOT NULL,
  `idVenta` int(10) unsigned NOT NULL,
  PRIMARY KEY (`idAddenda`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tbladdendapesicorecepcion`;
CREATE TABLE  `tbladdendapesicorecepcion` (
  `idRecepcion` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idAddenda` int(10) unsigned NOT NULL,
  `idInventario` int(10) unsigned NOT NULL,
  `recepcion` varchar(10) NOT NULL,
  PRIMARY KEY (`idRecepcion`)
) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=latin1;

ALTER TABLE `tblcomprasdetalles` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `costoindirecto`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `IEPS`;


ALTER TABLE `tblcompraspedidosdetalles` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `surtido`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `IEPS`;


ALTER TABLE `tblcomprascotizacionesdetalles` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `descuento`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `IEPS`;

ALTER TABLE `tblcomprasremisionesdetalles` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `surtido`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `IEPS`;

ALTER TABLE `tbldevolucionesdetalles` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `equivalenciab`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `IEPS`;



ALTER TABLE `tbldevolucionesdetallesc` ADD COLUMN `IEPS` DOUBLE NOT NULL AFTER `descuento`,
 ADD COLUMN `ivaRetenido` DOUBLE NOT NULL AFTER `IEPS`;

DROP TABLE IF EXISTS `tbladdendapepsico`;
CREATE TABLE  `tbladdendapepsico` (
  `idAddenda` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `tipo` varchar(10) NOT NULL,
  `version` int(10) unsigned NOT NULL,
  `idPedido` varchar(10) NOT NULL,
  `idSolicitudPago` varchar(10) DEFAULT NULL,
  `referencia` varchar(46) DEFAULT NULL,
  `serie` varchar(10) DEFAULT NULL,
  `folio` varchar(20) DEFAULT NULL,
  `folioUUID` varchar(36) DEFAULT NULL,
  `tipoDoc` int(10) unsigned NOT NULL,
  `idProveedor` varchar(10) NOT NULL,
  `idVenta` int(10) unsigned NOT NULL,
  PRIMARY KEY (`idAddenda`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tbladdendapesicorecepcion`;
CREATE TABLE  `tbladdendapesicorecepcion` (
  `idRecepcion` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idAddenda` int(10) unsigned NOT NULL,
  `idInventario` int(10) unsigned NOT NULL,
  `recepcion` varchar(10) NOT NULL,
  PRIMARY KEY (`idRecepcion`)
) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=latin1;


ALTER TABLE `tblnominas` ADD COLUMN `diaspagados` DOUBLE NOT NULL AFTER `clabe`,
 ADD COLUMN `antiguedad` INTEGER UNSIGNED NOT NULL AFTER `diaspagados`;



insert into tblactualizaciones(version) values('ver 9018 rev 11');


ALTER TABLE `tblnominas` ADD COLUMN `importado` TINYINT UNSIGNED NOT NULL AFTER `antiguedad`;
update tblopciones set localidad='0';

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(723,773,'Total negativos:','totalnegativos',120,20,'Lucida Console',8,0,0,0,1,0,0,1,0,0,'Documento - Total Negativos',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(723,773,'Total negativos:','totalnegativos',120,20,'Lucida Console',8,0,0,0,1,0,16,1,0,0,'Documento - Total Negativos',0,1);
update tblimpresionesnodos set tipo=0,tipodato=1,tiponodo=0 where datapropertyname='subtotalsinret' or datapropertyname='subtotalsindesc' or datapropertyname='totaldesc';
insert into tblactualizaciones(version) values('ver 9019 rev 1');



delete from tblimpresionesnodos where documento=7 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio:','docFolio',100,20,'Arial',10,0,0,0,0,1,7,1,0,0,'Documento - Folio Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie','docSerie',50,20,'Arial',10,0,0,0,0,1,7,1,0,0,'Documento - Serie Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,84,'Ref:','docref',200,20,'Arial',10,0,0,0,0,1,7,1,0,0,'Documento - Referencia Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha:','docFecha',200,20,'Arial',10,0,0,0,0,1,7,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Lucida Console',8,0,0,0,1,1,7,1,0,1,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Lucida Console',8,0,0,0,1,1,7,1,0,1,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Lucida Console',8,0,0,0,1,1,7,1,0,1,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,7,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(30,994,'Costo indirecto: ','docCostoIndirecto',300,20,'Lucida Console',8,0,0,0,0,1,7,1,0,1,'Documento - Costo indirecto',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,18,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,7,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle:','empresaCalle',400,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col:','empresaColonia',300,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP:','empresaCP',150,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC:','empresaRFC',150,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel:','empresaTel',300,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(320,227,'E-mail:','empresaEMail',300,20,'Arial',10,0,0,0,0,0,7,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,7,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom:','provDom',300,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col:','provCol',210,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP:','provCP',90,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,7,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant:','artCant',100,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,7,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',200,20,'Microsoft Sans Serif',9,0,0,0,0,1,7,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,7,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,7,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,7,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,7,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(50,1064,'Recibió:_____________________________________','et06',400,20,'Arial',10,0,0,0,0,1,7,1,2,0,'Etiqueta06',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,7,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(411,1063,'Autorizó:__________________________________','et07',400,20,'Arial',10,0,0,0,0,1,7,1,2,0,'Etiqueta07',0,7);

delete from tblimpresionesnodos where documento=23 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio:','docFolio',100,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Folio Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie','docSerie',50,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Serie Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,84,'Ref:','docref',200,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Referencia Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha:','docFecha',200,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Lucida Console',8,0,0,0,1,1,23,1,0,1,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Lucida Console',8,0,0,0,1,1,23,1,0,1,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Lucida Console',8,0,0,0,1,1,23,1,0,1,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,23,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(30,994,'Costo indirecto: ','docCostoIndirecto',300,20,'Lucida Console',8,0,0,0,0,1,23,1,0,1,'Documento - Costo indirecto',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,18,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle:','empresaCalle',400,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col:','empresaColonia',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP:','empresaCP',150,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC:','empresaRFC',150,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel:','empresaTel',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(320,227,'E-mail:','empresaEMail',300,20,'Arial',10,0,0,0,0,0,23,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom:','provDom',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col:','provCol',210,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP:','provCP',90,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant:','artCant',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',200,20,'Microsoft Sans Serif',9,0,0,0,0,1,23,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(50,1064,'Recibió:_____________________________________','et06',400,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta06',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,23,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(411,1063,'Autorizó:__________________________________','et07',400,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta07',0,7);

update tblimpresiones set y=250,yl=700 where documento=7 or documento=23;

ALTER TABLE `tblusuarios` ADD COLUMN `permisos10` BIGINT UNSIGNED NOT NULL AFTER `permisos9`;

ALTER TABLE `tblinventario` ADD COLUMN `urlImagen` VARCHAR(250) NOT NULL AFTER `ivaRetenido`;

ALTER TABLE `tblclientes` ADD COLUMN `zona` VARCHAR(30) NOT NULL AFTER `activarimpuestos`,
 ADD COLUMN `zona2` VARCHAR(30) NOT NULL AFTER `zona`;

ALTER TABLE `tblvendedores` ADD COLUMN `zona` VARCHAR(30) NOT NULL AFTER `pais`;
update tblclientes set zona='0',zona2='0';
update tblvendedores set zona='0';

CREATE TABLE `tblZona` (
  `idZona` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `zona` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idZona`)
)
ENGINE = InnoDB;

insert into tblactualizaciones(version) values('ver 9019 rev 6');


delete from tblimpresionesnodos where documento=23 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio:','docFolio',100,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Folio Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie','docSerie',50,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Serie Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,84,'Ref:','docref',200,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Referencia Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha:','docFecha',200,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Lucida Console',8,0,0,2,1,1,23,1,0,1,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Lucida Console',8,0,0,2,1,1,23,1,0,1,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Lucida Console',8,0,0,2,1,1,23,1,0,1,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,2,0,1,23,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(30,994,'Costo indirecto: ','docCostoIndirecto',300,20,'Lucida Console',8,0,0,2,0,1,23,1,0,1,'Documento - Costo indirecto',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,18,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle:','empresaCalle',400,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col:','empresaColonia',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP:','empresaCP',150,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC:','empresaRFC',150,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel:','empresaTel',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(320,227,'E-mail:','empresaEMail',300,20,'Arial',10,0,0,0,0,0,23,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom:','provDom',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col:','provCol',210,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP:','provCP',90,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant:','artCant',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',200,20,'Microsoft Sans Serif',9,0,0,0,0,1,23,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(50,1064,'Recibió:_____________________________________','et06',400,20,'Arial',10,0,0,2,0,1,23,1,2,0,'Etiqueta06',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,23,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(411,1063,'Autorizó:__________________________________','et07',400,20,'Arial',10,0,0,2,0,1,23,1,2,0,'Etiqueta07',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,957,'Línea02','ln02',850,2,'Arial',10,0,0,2,0,1,23,1,1,0,'Línea02',0,8);

insert into tblactualizaciones(version) values('ver 9020 rev 2');


delete from tblimpresionesnodos where documento=23 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio:','docFolio',100,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Folio Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie','docSerie',50,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Serie Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,84,'Ref:','docref',200,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Referencia Compra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha:','docFecha',200,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Lucida Console',8,0,0,2,1,1,23,1,0,1,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Lucida Console',8,0,0,2,1,1,23,1,0,1,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Lucida Console',8,0,0,2,1,1,23,1,0,1,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,2,0,1,23,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(30,994,'Costo indirecto: ','docCostoIndirecto',300,20,'Lucida Console',8,0,0,2,0,1,23,1,0,1,'Documento - Costo indirecto',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,18,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle:','empresaCalle',400,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col:','empresaColonia',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP:','empresaCP',150,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC:','empresaRFC',150,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel:','empresaTel',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(320,227,'E-mail:','empresaEMail',300,20,'Arial',10,0,0,0,0,0,23,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,23,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom:','provDom',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col:','provCol',210,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP:','provCP',90,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,23,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant:','artCant',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Lucida Console',8,0,0,1,0,1,23,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',200,20,'Microsoft Sans Serif',9,0,0,0,0,1,23,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,23,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(50,1064,'Recibió:_____________________________________','et06',400,20,'Arial',10,0,0,2,0,1,23,1,2,0,'Etiqueta06',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,23,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(411,1063,'Autorizó:__________________________________','et07',400,20,'Arial',10,0,0,2,0,1,23,1,2,0,'Etiqueta07',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,957,'Línea02','ln02',850,2,'Arial',10,0,0,2,0,1,23,1,1,0,'Línea02',0,8);

insert into tblactualizaciones(version) values('ver 9020 rev 3');


delete from tblimpresionesnodos where documento=8 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Compra:','docFolio',100,20,'Arial',10,0,0,0,0,1,8,1,0,0,'Documento - Folio Pre-Orden',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha','docFecha',200,20,'Arial',10,0,0,0,0,1,8,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,8,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,8,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,8,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,8,1,0,0,'Documento - Cantidad Letra',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,8,1,0,0,'Documento - Mensaje Candelado',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,18,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,8,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,8,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(418,166,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,8,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(431,174,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,8,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,8,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',94,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,8,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,1,1,8,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,1,1,8,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,1,1,8,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,1,1,8,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',200,20,'Arial',10,0,0,0,0,1,8,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial Narrow',10,0,0,0,0,1,8,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,8,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,8,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,8,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,8,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,8,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,8,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,8,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,8,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=24 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Compra:','docFolio',100,20,'Arial',10,0,0,0,0,1,24,1,0,0,'Documento - Folio Pre-Orden',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha','docFecha',200,20,'Arial',10,0,0,0,0,1,24,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,24,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,24,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,24,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,24,1,0,0,'Documento - Cantidad Letra',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,24,1,0,0,'Documento - Mensaje Candelado',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,18,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,24,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Lucida Console',8,0,0,0,0,1,24,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(418,166,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,24,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(431,174,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,24,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,24,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',94,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,24,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,1,1,24,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,1,1,24,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,1,1,24,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,1,1,24,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',200,20,'Arial',10,0,0,0,0,1,24,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial Narrow',10,0,0,0,0,1,24,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,24,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,24,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,24,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,24,1,1,0,'Línea01',0,8);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,24,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,24,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,24,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,24,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=11 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Devolución:','docFolio',100,20,'Arial',10,0,0,0,0,1,11,1,0,0,'Documento - Folio Dev',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,11,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,11,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,11,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1015,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,11,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,11,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,11,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,11,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(436,148,'Tel:','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,11,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(437,171,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,11,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,11,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,11,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(142,369,'Código','artCod',100,20,'Lucida Console',8,0,0,1,0,0,11,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,11,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,11,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,11,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,11,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,11,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,11,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,11,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,11,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,11,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,11,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,11,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,11,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(200,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,11,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=27 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Devolución:','docFolio',100,20,'Arial',10,0,0,0,0,1,27,1,0,0,'Documento - Folio Dev',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,27,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,27,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,27,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1015,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,27,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,27,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,27,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,27,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(436,148,'Tel:','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,27,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(437,171,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,27,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,27,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,27,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(142,369,'Código','artCod',100,20,'Lucida Console',8,0,0,1,0,0,27,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,27,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,27,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,27,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,27,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,27,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,27,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,27,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,27,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,27,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,27,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,27,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,27,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,27,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=13 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Notas de cargo:','docFolio',100,20,'Arial',10,0,0,0,0,1,13,1,0,0,'Documento - Folio Notas',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,13,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,13,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,13,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,13,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,13,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,13,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,13,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(381,143,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,13,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(408,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,13,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,13,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,13,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,13,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,13,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,13,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,13,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,13,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(649,18,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,13,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,13,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,13,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,13,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,13,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,13,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,13,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,13,1,2,0,'Proveedor - País',0,3);



delete from tblimpresionesnodos where documento=29 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Notas de cargo:','docFolio',100,20,'Arial',10,0,0,0,0,1,29,1,0,0,'Documento - Folio Notas',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,29,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,29,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,29,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,29,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,29,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,29,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,29,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(381,143,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,29,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(408,164,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,29,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,29,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(252,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,29,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,29,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,29,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,29,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,29,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,29,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(649,18,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,29,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,29,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,29,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,29,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,29,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,29,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,29,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,29,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=12 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Notas de crédito:','docFolio',100,20,'Arial',10,0,0,0,0,1,12,1,0,0,'Documento - Folio Notas',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,12,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,12,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,12,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,12,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,12,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,12,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,12,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(350,142,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,12,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(408,169,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,12,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,12,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,12,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,12,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,12,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,12,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,12,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,12,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,12,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,12,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,12,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,12,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,12,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,12,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,12,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,12,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=28 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Notas de crédito:','docFolio',100,20,'Arial',10,0,0,0,0,1,28,1,0,0,'Documento - Folio Notas',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(638,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,28,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,28,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,28,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,28,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,28,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,28,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,28,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(350,142,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,28,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(408,169,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,28,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,28,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,28,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,28,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,28,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,28,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,28,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,28,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,28,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,28,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,28,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,28,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,28,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,28,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,28,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,28,1,2,0,'Proveedor - País',0,3);


delete from tblimpresionesnodos where documento=9 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Compra:','docFolio',100,20,'Arial',10,0,0,0,0,1,9,1,0,0,'Documento - Folio Pedido',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha','docFecha',200,20,'Arial',10,0,0,0,0,1,9,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,9,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,9,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,9,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,9,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,9,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,9,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(508,187,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,9,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(404,218,'E-mail: ','empresaEMail',300,20,'Lucida Console',8,0,0,0,0,0,9,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,9,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,9,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,369,'Código','artCod',100,20,'Lucida Console',8,0,0,1,0,0,9,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,9,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,9,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,9,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,9,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',300,20,'Arial',10,0,0,0,0,1,9,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,9,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'FOLIO:','et03',100,20,'Arial',10,0,0,0,0,1,9,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'FECHA:','et04',100,20,'Arial',10,0,0,0,0,1,9,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,9,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,9,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,9,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,9,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,9,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,9,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=25 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Compra:','docFolio',100,20,'Arial',10,0,0,0,0,1,25,1,0,0,'Documento - Folio Pedido',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,127,'Fecha','docFecha',200,20,'Arial',10,0,0,0,0,1,25,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,25,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','iva',100,20,'Arial',10,0,0,0,1,1,25,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,25,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,25,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,25,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,25,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(508,187,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,25,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(404,218,'E-mail: ','empresaEMail',300,20,'Lucida Console',8,0,0,0,0,0,25,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,25,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(249,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,25,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,369,'Código','artCod',100,20,'Lucida Console',8,0,0,1,0,0,25,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,25,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,25,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,25,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,25,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,110,'Datos del Proveedor:','et01',300,20,'Arial',10,0,0,0,0,1,25,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,25,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'FOLIO:','et03',100,20,'Arial',10,0,0,0,0,1,25,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,109,'FECHA:','et04',100,20,'Arial',10,0,0,0,0,1,25,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et05',100,20,'Arial',10,0,0,0,0,1,25,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,25,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,25,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,25,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,25,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,25,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=10 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Remisión:','docFolio',100,20,'Arial',10,0,0,0,0,1,10,1,0,0,'Documento - Folio Remisiones',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(649,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,10,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,10,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','docIVA',100,20,'Arial',10,0,0,0,1,1,10,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,10,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,10,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,10,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,10,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(389,145,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,10,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(370,166,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,10,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,10,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(248,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,10,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(142,369,'Código','artCodigo',100,20,'Lucida Console',8,0,0,1,0,0,10,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,10,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,10,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,10,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,10,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,10,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,10,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,10,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,10,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,10,1,1,0,'Línea01',0,8);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(200,20,'referencia','referencia',650,82,'Arial',10,0,0,0,0,1,10,1,2,0,'Documento - Referencia Compra',0,7);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,0,10,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,0,10,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,0,10,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,0,10,1,2,0,'Proveedor - País',0,3);

delete from tblimpresionesnodos where documento=26 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio Remisión:','docFolio',100,20,'Arial',10,0,0,0,0,1,26,1,0,0,'Documento - Folio Remisiones',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(649,102,'Fecha','docFecha',150,20,'Arial',10,0,0,0,0,1,26,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,974,'SubTotal:','docSubTotal',100,20,'Arial',10,0,0,0,1,1,26,1,0,0,'Documento - SubTotal',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,995,'IVA 16%:','docIVA',100,20,'Arial',10,0,0,0,1,1,26,1,0,0,'Documento - IVA',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total:','docTotal',100,20,'Arial',10,0,0,0,1,1,26,1,0,0,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,1016,'Cantidad Letra ','docCantLetra',500,20,'Lucida Console',8,0,0,0,0,1,26,1,0,0,'Documento - Cantidad Letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,0,26,1,0,0,'Documento - Mensaje Candelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,21,'Nombre','empresaNombre',600,20,'Arial',10,0,0,0,0,1,26,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,40,'Calle: ','empresaCalle',400,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Empresa - Dirección calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,55,'Col: ','empresaColonia',300,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Empresa - Dirección colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,70,'CP: ','empresaCP',150,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(193,70,'RFC: ','empresaRFC',150,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,85,'Tel: ','empresaTel',300,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Empresa - Telefono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(389,145,', ','empresaTel2',150,20,'Lucida Console',8,0,0,0,0,0,26,1,0,1,'Empresa - Telefono2',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(370,166,'E-mail: ','empresaEMail',150,20,'Lucida Console',8,0,0,0,0,0,26,1,0,1,'Empresa - EMail',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,130,'Nombre ','provNombre',300,20,'Arial',10,0,0,0,0,1,26,1,0,0,'Proveedor - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,145,'Dom: ','provDom',300,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Proveedor - Domicilio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,160,'Col: ','provCol',210,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Proveedor - Col',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(248,160,'CP: ','provCP',90,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Proveedor - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,175,'Ciudad: ','provCiudad',300,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Proveedor - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,190,'RFC: ','provRFC',300,20,'Arial',10,0,0,0,0,1,26,1,0,1,'Proveedor - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(142,369,'Código','artCodigo',100,20,'Lucida Console',8,0,0,1,0,0,26,1,0,0,'Artículos - Codigo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(527,255,'Cant: ','artCant',100,20,'Arial',10,0,0,1,0,1,26,1,0,0,'Artículos - Cant',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,255,'Descripcion ','artDesc',500,20,'Arial',10,0,0,1,0,1,26,1,0,0,'Artículos - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(636,255,'Precio U','artPrecioU',100,20,'Arial',10,0,0,1,0,1,26,1,0,0,'Artículos - Precio U.',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,255,'Importe: ','provImporte',100,20,'Arial',10,0,0,1,0,1,26,1,0,0,'Artículos - Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(42,220,'CONCEPTOS:','et01',100,20,'Arial',10,0,0,0,0,1,26,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(654,17,'COMPRA','et02',100,20,'Arial',10,0,0,0,0,1,26,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,44,'Folio:','et03',100,20,'Arial',10,0,0,0,0,1,26,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,82,'Fecha:','et04',100,20,'Arial',10,0,0,0,0,1,26,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,241,'Línea01','ln01',850,2,'Arial',10,0,0,0,0,1,26,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(200,20,'referencia','referencia',650,82,'Arial',10,0,0,0,0,1,26,1,2,0,'Documento - Referencia Compra',0,7);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Interior: ','privnoInterior',650,82,'Arial',10,0,0,0,0,1,26,1,2,0,'Proveedor - Numero Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Número Exterior: ','provnoExterior',650,82,'Arial',10,0,0,0,0,1,26,1,2,0,'Proveedor - Numero Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'Estado:: ','provEstado',650,82,'Arial',10,0,0,0,0,1,26,1,2,0,'Proveedor - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(20,20,'País:: ','provPais',650,82,'Arial',10,0,0,0,0,1,26,1,2,0,'Proveedor - País',0,3);

update tblimpresiones set y=270,yl=700 where documento=8 or documento=24 or documento=11 or documento=27 or documento=13 or documento=29 or documento=12 or documento=28 or documento=9 or documento=25 or documento=10 or documento=26;


insert into tblactualizaciones(version) values('ver 9020 rev 4');

update tblvendedores set zona='0';

insert into tblactualizaciones(version) values('ver 9020 rev 5');


DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafecha` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafecha`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN
declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare vtipodecambio double;
declare vmetodo varchar(2);
if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  set vcosto=0;

  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);

    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;
  end while;

else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventariopreciosidmoneda<>2;


update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

end if;

return ifnull(vcosto,0);
END $$

DELIMITER ;


DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafechaa` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafechaa`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN

declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare varfechamax varchar(10);
declare varinvant double;
declare varidmax int;
declare vtipodecambio double;
declare vmetodo varchar(2);

if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha=pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha=pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  
  
  set varfechamax=ifnull((select max(fecha) from tblinventariocostohex where fecha<pfecha1),'1900/01/01');
  
  set vcosto=ifnull((select costo from tblinventariocostohex where fecha=varfechamax limit 1),0);
  
  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);
    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;
     
  end while;

    insert into tblinventariocostohex(idinventario,fecha,costo) values(pidinventario,pfecha1,vcosto);
else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<=pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<=pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

end if;

return ifnull(vcosto,0);



END $$

DELIMITER ;



DROP TABLE IF EXISTS `tblcomprasremisioneslotes`;
CREATE TABLE  `tblcomprasremisioneslotes` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idlote` int(10) unsigned NOT NULL,
  `iddetalle` int(10) unsigned NOT NULL,
  `cantidad` double NOT NULL,
  `surtido` double NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;



ALTER TABLE `tblcompraslotes` ADD CONSTRAINT `FK_tblcompraslotes_1` FOREIGN KEY `FK_tblcompraslotes_1` (`iddetalle`)
    REFERENCES `tblcomprasdetalles` (`iddetalle`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;

ALTER TABLE `tblcomprasremisioneslotes` ADD CONSTRAINT `FK_tblcomprasremisioneslotes_1` FOREIGN KEY `FK_tblcomprasremisioneslotes_1` (`iddetalle`)
    REFERENCES `tblcomprasremisionesdetalles` (`iddetalle`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;




insert into tblactualizaciones(version) values('ver 9020 rev 6');


CREATE TABLE  `tblventaslotes` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idlote` int(10) unsigned NOT NULL,
  `iddetalle` int(10) unsigned NOT NULL,
  `cantidad` double NOT NULL,
  `surtido` double NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

CREATE TABLE  `tblventasremisioneslotes` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idlote` int(10) unsigned NOT NULL,
  `iddetalle` int(10) unsigned NOT NULL,
  `cantidad` double NOT NULL,
  `surtido` double NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

ALTER TABLE `tblventasremisioneslotes` ADD CONSTRAINT `FK_tblventasremisioneslotes_1` FOREIGN KEY `FK_tblventasremisioneslotes_1` (`iddetalle`)
    REFERENCES `tblventasremisionesinventario` (`iddetalle`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;

ALTER TABLE `tblventaslotes` ADD CONSTRAINT `FK_tblventaslotes_1` FOREIGN KEY `FK_tblventaslotes_1` (`iddetalle`)
    REFERENCES `tblventasinventario` (`idventasinventario`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;


insert into tblactualizaciones(version) values('ver 9020 rev 8');


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Tipo Regimen:','tiporegimentrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Tipo Regimen',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'No. Seguro Social:','nsstrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - No. Seguro Social',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Inicio Laboral:','finiciotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Inicio Laboral',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Antigüedad:','anttrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Antigüedad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Departamento:','deptrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Departamento',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Puesto:','puestotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Puesto',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Tipo Jornada:','tipojtrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Tipo Jornada',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Tipo contrato:','tipoctrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Tipo Contrato',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Tipo Periodicidad:','periodotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Periodicidad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Salario Base:','sbasetrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Salario Base',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Riesgo:','riesgotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Riesgo',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(45,322,'Salario Diario:','sdiariotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Salario diario',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(736,396,'Importe Percepción','imppercepcion',120,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Importe Percepción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(736,396,'Importe Deducción','impdeduccion',120,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Importe Deducción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(218,171,'Días Pagados:','diaspagados',200,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Documento - Días pagados',0,1);

insert into tblactualizaciones(version) values('ver 9020 rev 15');


delete from tblimpresionesnodos where documento=38 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,10,'Empresa','nombrefiscal',500,20,'Arial',10,1,0,0,0,0,38,1,0,0,'Empresa - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(244,20,'Calle - Empresa','direccion',150,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Empresa - Calle',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(397,22,'No:','noexterior',220,20,'Arial',10,0,0,0,0,0,38,1,0,1,'Empresa - No. Exterior',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(683,11,'No. Interior - Empresa','nointerior',220,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Empresa - No. Interior',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(244,28,'Col:','colonia',160,20,'Arial',10,0,0,0,0,0,38,1,0,1,'Empresa - Colonia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(389,23,'Ciudad - Empresa','ciudad',160,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Empresa - Ciudad',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(297,29,'Estado - Empresa','estado',160,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Empresa - Estado',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,72,'C.P:','cp',80,20,'Arial',10,0,0,0,0,0,38,1,0,1,'Empresa - CP',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(319,39,'RFC:','rfc',130,20,'Arial',10,0,0,0,0,0,38,1,0,1,'Empresa - RFC',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(379,28,'Tel:','tel',180,20,'Arial',10,0,0,0,0,0,38,1,0,1,'Empresa - Teléfono',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(239,56,'Email - Empresa','email',400,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Empresa - Email',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(304,51,'Referencia - Empresa','referencia',200,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Empresa - Referencia',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,202,'trabajador: ','nombretrabajador',490,16,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Trabajador - Nombre',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,218,'Calle:','direcciontrabajador',350,16,'Lucida Console',8,0,0,0,0,1,38,1,0,1,'Trabajador - Calle',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(330,218,'No:','noexteriortrabajador',150,16,'Lucida Console',8,0,0,0,0,1,38,1,0,1,'Trabajador - No. Exterior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(385,145,'No Int:','nointeriortrabajador',150,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Trabajador - No. Interior',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,234,'Colonia:','coloniatrabajador',230,16,'Lucida Console',8,0,0,0,0,1,38,1,0,1,'Trabajador - Colonia',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(262,234,'CP:','cptrabajador',120,16,'Lucida Console',8,0,0,0,0,1,38,1,0,1,'Trabajador - CP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,250,'Ciudad:','ciudadtrabajador',140,20,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Trabajador - Ciudad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(172,250,'Estado:','estadotrabajador',160,20,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Trabajador - Estado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(600,186,'RFC:','rfctrabajador',150,13,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Trabajador - RFC',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(725,145,'Serie','serie',50,20,'Lucida Console',8,1,0,0,0,1,38,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(768,145,'Folio','folio',100,20,'Lucida Console',8,1,0,0,0,1,38,1,0,0,'Documento - Folio',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(31,777,'Certificado del Emisor:','certificado',370,13,'Lucida Console',6,0,0,0,0,1,38,1,0,1,'Documento - Certificado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(97,14,'Fecha','fecha',100,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(380,131,'Hora','hora',100,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Documento - Hora',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(28,305,'Tipo','tipoconcepto',80,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Tipo',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(117,305,'Clave','clave',50,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Clave',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(198,305,'Descripción','descripcion',305,200,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Descripción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(572,332,'Imp. Gravado','impgravado',80,20,'Lucida Console',8,0,0,1,1,0,38,1,0,0,'Detalles - Importe Gravado',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(644,333,'Imp. Exento','impexento',80,20,'Lucida Console',8,0,0,1,1,0,38,1,0,0,'Detalles - Importe Exento',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(607,305,'Total Importe','imptotal',120,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Total Importe',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(528,305,'Dias','dias',50,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Dias',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(553,305,'Horas Extra','horasextra',50,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Horas Extra',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(711,703,'Total:','total',120,20,'Lucida Console',8,0,0,0,1,1,38,1,0,1,'Documento - Total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(29,740,'Total letra','totalletra',560,13,'Lucida Console',7,0,0,0,0,1,38,1,0,0,'Documento - Total letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(84,803,'Folio Fiscal:','uuid',350,13,'Lucida Console',6,0,0,0,0,1,38,1,0,1,'Fiscal - Folio Fiscal CFDI',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(68,790,'Certificado SAT:','cersat',300,13,'Lucida Console',6,0,0,0,0,1,38,1,0,1,'Fiscal - Certificado SAT',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(120,816,'Fecha:','fechatimbrado',300,13,'Lucida Console',6,0,0,0,0,1,38,1,0,1,'Fiscal - Fecha Timbrado',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(599,106,'Lugar:','lugar',250,16,'Lucida Console',7,0,0,0,0,1,38,1,0,0,'Fiscal - Lugar Elaboracion',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(29,902,'Sello CFDI: ','sellocfdi',560,30,'Lucida Console',5,0,0,0,0,1,38,1,0,1,'Fiscal - Sello CFDI',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(29,946,'Sello SAT: ','sellosat',560,30,'Lucida Console',5,0,0,0,0,1,38,1,0,1,'Fiscal - Sello SAT',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(29,1025,'Cadena original del complemento de certificación digital del SAT: ','cadenasat',560,90,'Lucida Console',5,0,0,0,0,1,38,1,0,0,'Fiscal - Cadena Original SAT',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(674,892,'Codigo Bidimensional','codigobi',160,150,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Fiscal - Codigo Bidimensional',0,6);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,25,'ESTE DOCUMENTO ES UNA REPRESENTACIÓN IMPRESA DE UN CFDI','et01',376,14,'Arial',8,1,0,0,0,1,38,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(27,87,'Municipio:','municipiotrabajador',160,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Trabajador - Municipio',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(257,71,'Municipio empresa','municipio',136,20,'Arial',8,0,0,0,0,0,38,1,0,0,'Empresa - Municipio',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(342,250,'CURP','curptrabajador',180,20,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Trabajador - CURP',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(120,139,'Regimen Fiscal','regimenfiscal',120,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Empresa - Regimen Fiscal',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(567,51,'Referencia:','reftrabajador',160,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Trabajador - Ref. Dom.',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(324,492,'Mensaje Cancelado','cancelado',170,20,'Arial',18,0,0,1,0,1,38,1,0,0,'Documento - Mensaje Cancelado',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(13,643,'Comentario','comentario',700,20,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Documento - Comentario',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,186,'Número Empleado:','numtrabajador',120,16,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Trabajador - Num. Empleado',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(259,127,'Fecha de Pago:','fechapago',100,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Documento - Fecha Pago',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(28,711,'Fecha Inicial:','fechainicial',100,13,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Documento - Fecha Inicial',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(131,711,'Fecha Final','fechafinal',100,13,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Documento - Fecha Final',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(328,97,'CLABE:','clabe',200,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Documento - CLABE',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(218,171,'Banco:','banco',200,20,'Arial',10,0,0,0,0,0,38,1,0,0,'Documento - Banco',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(57,587,'Total letra','totalletracon',570,50,'Lucida Console',8,0,0,0,0,0,38,1,0,0,'Documento - Total letra conceptos',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(711,675,'Total Conceptos:','totalcon',120,20,'Lucida Console',8,0,0,0,1,1,38,1,0,1,'Documento - Total Conceptos',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(27,47,'Tipo Regimen:','tiporegimentrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Tipo Regimen',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(600,222,'No. Seguro Social:','nsstrabajador',230,13,'Lucida Console',8,0,0,0,0,1,38,1,0,1,'Trabajador - No. Seguro Social',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(41,332,'Inicio Laboral:','finiciotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Inicio Laboral',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(41,380,'Antigüedad:','anttrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Antigüedad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,424,'Departamento:','deptrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Departamento',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(32,680,'Puesto:','puestotrabajador',230,16,'Lucida Console',8,0,0,0,0,1,38,1,0,1,'Trabajador - Puesto',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(53,522,'Tipo Jornada:','tipojtrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Tipo Jornada',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(49,487,'Tipo contrato:','tipoctrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Tipo Contrato',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,445,'Tipo Periodicidad:','periodotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Periodicidad',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(44,345,'Salario Base:','sbasetrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Salario Base',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(50,357,'Riesgo:','riesgotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Riesgo',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(68,393,'Salario Diario:','sdiariotrabajador',230,16,'Lucida Console',8,0,0,0,0,0,38,1,0,1,'Trabajador - Salario diario',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(601,373,'Importe Percepción','imppercepcion',120,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Importe Percepción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(731,373,'Importe Deducción','impdeduccion',120,20,'Lucida Console',8,0,0,1,0,1,38,1,0,0,'Detalles - Importe Deducción',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(236,711,'Días Pagados:','diaspagados',200,13,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Documento - Días pagados',0,1);

update tblopciones set codigopostal='NO',estadolocal='0',referenciadomicilio='0';

ALTER TABLE `tblservicios` ADD COLUMN `idEquipo` INTEGER UNSIGNED NOT NULL AFTER `cerrado`,
 ADD COLUMN `Serie` VARCHAR(5) AFTER `idEquipo`;

CREATE TABLE `tblServiciosEstados` (
  `idEstado` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `codigo` VARCHAR(10) NOT NULL,
  `estado` VARCHAR(25) NOT NULL,
  PRIMARY KEY (`idEstado`)
)
ENGINE = InnoDB;

ALTER TABLE `tblservicioseventos` ADD COLUMN `fecha` VARCHAR(11) NOT NULL AFTER `idequipo`;
ALTER TABLE `tblservicioseventos` ADD COLUMN `iva` DOUBLE NOT NULL AFTER `fecha`;

ALTER TABLE `tbldepostito` ADD COLUMN `comentario` VARCHAR(200) AFTER `Banco2`;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(48,115,'Registro Patronal','regtrabajador',120,20,'Arial',8,0,0,0,0,0,38,1,0,0,'Trabajador - Reg. Patronal',0,3);

insert into tblactualizaciones(version) values('ver 9020 rev 17');


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(715,743,'Total Percepciones:','totalper',120,20,'Lucida Console',8,0,0,0,1,1,38,1,0,1,'Documento - Total Percepciones',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(715,743,'Total Deducciones:','totalded',120,20,'Lucida Console',8,0,0,0,1,1,38,1,0,1,'Documento - Total Deducciones',0,1);
update tblopciones set municipio='0';

ALTER TABLE `tblnominaincapacidades`
 DROP FOREIGN KEY `FK_tblnomaincapacidades_1`;

ALTER TABLE `tblnominaincapacidades` ADD CONSTRAINT `FK_tblnomaincapacidades_1` FOREIGN KEY `FK_tblnomaincapacidades_1` (`idnomina`)
    REFERENCES `tblnominas` (`idnomina`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;


insert into tblactualizaciones(version) values('ver 9020 rev 18');


insert into tblpercepciones(clave,descripcion) values('029','Vales de despensa');
insert into tblpercepciones(clave,descripcion) values('030','Vales de restaurante');
insert into tblpercepciones(clave,descripcion) values('031','Vales de gasolina');
insert into tblpercepciones(clave,descripcion) values('032','Vales de ropa');
insert into tblpercepciones(clave,descripcion) values('033','Ayuda para renta');
insert into tblpercepciones(clave,descripcion) values('034','Ayuda para artículos escolares');
insert into tblpercepciones(clave,descripcion) values('035','Ayuda para anteojos');
insert into tblpercepciones(clave,descripcion) values('036','Ayuda para transporte');
insert into tblpercepciones(clave,descripcion) values('037','Ayuda para gastos de funeral');
insert into tblpercepciones(clave,descripcion) values('038','Otros ingresos por salarios');
insert into tblpercepciones(clave,descripcion) values('039','Jubilaciones, pensione o haberes de retiro');

insert into tblactualizaciones(version) values('ver 9020 rev 19');


DROP TABLE IF EXISTS `tblclientesviejossaldosex`;
CREATE TABLE  `tblclientesviejossaldosex` (
  `fecha` varchar(10) NOT NULL,
  `idcliente` int(10) unsigned NOT NULL,
  `serie` varchar(45) NOT NULL,
  `folio` int(10) unsigned NOT NULL,
  `limite` varchar(10) NOT NULL,
  `sietedias` double NOT NULL,
  `quincedias` double NOT NULL,
 `treintadias` double NOT NULL,
  `tresmeses` double NOT NULL,
  `seismeses` double NOT NULL,
  `docemeses` double NOT NULL,
  `dosyears` double NOT NULL,
  `tresyears` double NOT NULL,
  `cuatroyears` double NOT NULL,
  `cincoyears` double NOT NULL,
  `credito` double NOT NULL,
  `tipo` tinyint(3) unsigned NOT NULL,
  `tipodecambio` double NOT NULL,
  `corriente` double NOT NULL,
  `totalapagar` double NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho) values(500,300,39,1,40,4,0,864);
delete from tblimpresionesnodos where documento=39 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(540,63,'Fecha:','fechaCheque',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,39,1,0,0,'Fecha Cheque',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,122,'A nombre de:','nombreCheque',500,20,'Microsoft Sans Serif',7,0,0,0,0,1,39,1,0,0,'A nombre de',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,150,'SON:','cantidadLetra',400,20,'Microsoft Sans Serif',7,0,0,0,0,1,39,1,0,0,'Cantidad con letra',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(600,122,'Cantidad:','cantidad',200,20,'Microsoft Sans Serif',7,0,0,0,0,1,39,1,0,0,'Cantidad',0,0);

insert into tblactualizaciones(version) values('ver 9020 rev 23');

update tblopciones set estado='0';
insert into tblactualizaciones(version) values('ver 9020 rev 26');



DELIMITER $$

DROP FUNCTION IF EXISTS `spdaultimocostoinv` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spdaultimocostoinv`(pidinventario int) RETURNS double
BEGIN

declare vcosto double;
declare vfmax varchar(10);
declare vfmax2 varchar(10);

set vfmax=ifnull((select max(fecha) from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where estado=3 and idinventario=pidinventario),'1900/01/01');
set vfmax2=ifnull((select max(fecha) from tblmovimientos inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento where (tipo=0 or tipo=4) and estado=3 and idinventario=pidinventario),'1900/01/01');

if vfmax>=vfmax2 then
set vcosto=ifnull((select (precio/cantidad)+(tblcomprasdetalles.costoindirecto/surtido) from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where estado=3 and idinventario=pidinventario and fecha=vfmax order by tblcompras.idcompra desc limit 1),0);
else
set vcosto=ifnull((select (precio/cantidad) from tblmovimientos inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento where (tipo=0 or tipo=4) and estado=3 and idinventario=pidinventario and fecha=vfmax2 order by tblmovimientos.idmovimiento desc limit 1),0);
end if;

return vcosto;
END $$

DELIMITER ;

insert into tblactualizaciones(version) values('ver 9021 rev 3');


DROP TABLE IF EXISTS `tblidentificacion`;
CREATE TABLE  `tblidentificacion` (
  `idIdentificacion` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre` varchar(45) NOT NULL,
  PRIMARY KEY (`idIdentificacion`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;

ALTER TABLE `tblclientes` ADD COLUMN `imagen` VARCHAR(500) NOT NULL AFTER `zona2`,
 ADD COLUMN `identificacion` INTEGER UNSIGNED NOT NULL AFTER `imagen`,
 ADD COLUMN `numeroID` VARCHAR(45) NOT NULL AFTER `identificacion`;

update tblclientes set imagen='',identificacion=0,numeroid='';

insert into tblactualizaciones(version) values('ver 9021 rev 5');



insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(63,30,'Método de pago:','metododepago',120,20,'Lucida Console',8,0,0,0,0,1,38,1,0,0,'Documento - Método de pago',0,1);
ALTER TABLE `tblnominas` ADD COLUMN `idforma` INTEGER UNSIGNED NOT NULL AFTER `importado`;
update tblnominas set idforma=1;

insert into tblactualizaciones(version) values('ver 9022 rev 1');



DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafechaa` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafechaa`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN

declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare varfechamax varchar(10);
declare varinvant double;
declare varidmax int;
declare vtipodecambio double;
declare vmetodo varchar(2);

if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha=pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha=pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  

  set varfechamax=ifnull((select max(fecha) from tblinventariocostohex where fecha<pfecha1),'1900/01/01');
  
  set vcosto=ifnull((select costo from tblinventariocostohex where fecha=varfechamax limit 1),0);
  
  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);
    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;

  end while;

    insert into tblinventariocostohex(idinventario,fecha,costo) values(pidinventario,pfecha1,vcosto);
else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<=pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<=pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

end if;

return ifnull(vcosto,0);



END $$

DELIMITER ;


DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafecha` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafecha`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN
declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare vtipodecambio double;
declare vmetodo varchar(2);
if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  set vcosto=0;

  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);

    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;
  end while;

else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventariopreciosidmoneda<>2;


/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;

end if;

return ifnull(vcosto,0);
END $$

DELIMITER ;

insert into tblactualizaciones(version) values('ver 9022 rev 3');

update tblopciones set nombreempresalocal='0';
insert into tblactualizaciones(version) values('ver 9022 rev 7');


DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafecha` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafecha`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN
declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare vtipodecambio double;
declare vmetodo varchar(2);
if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  set vcosto=0;

  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);

    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;
  end while;

else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventariopreciosidmoneda<>2;


/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

end if;

return ifnull(vcosto,0);
END $$

DELIMITER ;

DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafechaa` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafechaa`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN

declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare varfechamax varchar(10);
declare varinvant double;
declare varidmax int;
declare vtipodecambio double;
declare vmetodo varchar(2);

if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha=pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha=pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  

  set varfechamax=ifnull((select max(fecha) from tblinventariocostohex where fecha<pfecha1),'1900/01/01');
  
  set vcosto=ifnull((select costo from tblinventariocostohex where fecha=varfechamax limit 1),0);

  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);
    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;

  end while;

    insert into tblinventariocostohex(idinventario,fecha,costo) values(pidinventario,pfecha1,vcosto);
else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<=pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<=pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

end if;

return ifnull(vcosto,0);



END $$

DELIMITER ;

insert into tblactualizaciones(version) values('ver 9022 rev 9');



DROP TABLE IF EXISTS `tblempenios`;
CREATE TABLE  `tblempenios` (
  `idmovimiento` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `fecha` varchar(12) NOT NULL,
  `folio` int(10) unsigned NOT NULL,
  `hora` varchar(8) NOT NULL,
  `estado` tinyint(3) unsigned NOT NULL,
  `total` double NOT NULL,
  `idsucursal` int(10) unsigned NOT NULL,
  `serie` varchar(45) NOT NULL,
  `idcaja` int(10) unsigned NOT NULL,
  `idvendedor` int(10) unsigned NOT NULL,
  `comentario` varchar(2000) NOT NULL,
  `tipo` tinyint(3) unsigned NOT NULL,
  `idcliente` int(10) unsigned NOT NULL,
  `diasPrestamos` int(10) unsigned NOT NULL,
  `A1a30` double NOT NULL,
  `A31a60` double NOT NULL,
  `A61a90` double NOT NULL,
  `A90mas` double NOT NULL,
  `B1a30` double NOT NULL,
  `B31a60` double NOT NULL,
  `B61a90` double NOT NULL,
  `B90mas` double NOT NULL,
  `fechaContrato` varchar(12) NOT NULL,
  `pagado` tinyint(3) unsigned NOT NULL,
  `TotalAux` double NOT NULL,
  PRIMARY KEY (`idmovimiento`)
) ENGINE=InnoDB AUTO_INCREMENT=35 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblempeniosabono`;
CREATE TABLE  `tblempeniosabono` (
  `idAbono` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idEmpenio` int(10) unsigned NOT NULL,
  `fecha` varchar(12) NOT NULL,
  `cantidad` double NOT NULL,
  `habilitado` tinyint(3) unsigned NOT NULL,
  PRIMARY KEY (`idAbono`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblempeniosclasificacion`;
CREATE TABLE  `tblempeniosclasificacion` (
  `idClasificacion` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre` varchar(45) NOT NULL,
  PRIMARY KEY (`idClasificacion`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblempeniosconfiguracion`;
CREATE TABLE  `tblempeniosconfiguracion` (
  `idConfiguracion` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `factor` double NOT NULL,
  `folio` tinyint(3) unsigned NOT NULL,
  `interes` double NOT NULL,
  `diasProrroga` double NOT NULL,
  `numRegistro` varchar(20) NOT NULL,
  `almacenaje` double NOT NULL,
  `A1a30` double NOT NULL,
  `A31a60` double NOT NULL,
  `A61a90` double NOT NULL,
  `A90mas` double NOT NULL,
  `B1a30` double NOT NULL,
  `B31a60` double NOT NULL,
  `B61a90` double NOT NULL,
  `B90mas` double NOT NULL,
  `aumentoPrenda` double NOT NULL,
  PRIMARY KEY (`idConfiguracion`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblempeniosdetalles`;
CREATE TABLE `tblempeniosdetalles` (
  `idDetalle` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idMovimiento` int(10) unsigned NOT NULL,
  `descripcion` varchar(45) NOT NULL,
  `precio` double NOT NULL,
  `clasificacion` int(10) unsigned NOT NULL,
  `kilates` double NOT NULL,
  `peso` double NOT NULL,
  `evaluo` double NOT NULL,
  PRIMARY KEY (`idDetalle`)
) ENGINE=InnoDB AUTO_INCREMENT=35 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblgastos`;
CREATE TABLE  `tblgastos` (
  `idmovimiento` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `fecha` varchar(10) NOT NULL,
  `folio` int(10) unsigned NOT NULL,
  `hora` varchar(8) NOT NULL,
  `estado` tinyint(3) unsigned NOT NULL,
  `total` double NOT NULL,
  `idsucursal` int(10) unsigned NOT NULL,
  `serie` varchar(45) NOT NULL,
  `idcaja` int(10) unsigned NOT NULL,
  `idvendedor` int(10) unsigned NOT NULL,
  `comentario` varchar(2000) DEFAULT NULL,
  `tipo` tinyint(3) unsigned NOT NULL,
  PRIMARY KEY (`idmovimiento`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblgastosclasificacion`;
CREATE TABLE  `tblgastosclasificacion` (
  `idClasificacion` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre` varchar(45) NOT NULL,
  PRIMARY KEY (`idClasificacion`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblgastosdetalles`;
CREATE TABLE  `tblgastosdetalles` (
  `idDetalle` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idMovimiento` int(10) unsigned NOT NULL,
  `descripcion` varchar(45) NOT NULL,
  `precio` double NOT NULL,
  `clasificacion` int(10) unsigned NOT NULL,
  PRIMARY KEY (`idDetalle`)
) ENGINE=InnoDB AUTO_INCREMENT=29 DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tblgastosprogradetalles`;
CREATE TABLE  `tblgastosprogradetalles` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idGasto` int(10) unsigned NOT NULL,
  `fecha` varchar(11) NOT NULL,
  `hora` varchar(5) NOT NULL,
  `frecuencia` varchar(5) NOT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=104 DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `tblgastosprogramables`;
CREATE TABLE  `tblgastosprogramables` (
  `idGasto` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `tipo` int(10) unsigned NOT NULL,
  `nombre` varchar(50) NOT NULL,
  `fecha` varchar(11) NOT NULL,
  `dias` int(10) unsigned NOT NULL,
  `frecuencia` varchar(5) NOT NULL,
  `inicio` varchar(11) NOT NULL,
  `fin` varchar(11) NOT NULL,
  `estado` tinyint(1) NOT NULL,
  PRIMARY KEY (`idGasto`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=latin1;

ALTER TABLE `tblgastosdetalles` ADD COLUMN `esSalario` INTEGER UNSIGNED NOT NULL AFTER `clasificacion`;

DROP TABLE IF EXISTS `tblgastosempleados`;
CREATE TABLE  `tblgastosempleados` (
  `idEmpleado` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `nombre` varchar(45) NOT NULL,
  `telefono` varchar(20) NOT NULL,
  `email` varchar(100) NOT NULL,
  `RFC` varchar(13) NOT NULL,
  `CURP` varchar(19) NOT NULL,
  `calle` varchar(30) NOT NULL,
  `noInterior` varchar(8) NOT NULL,
  `noExterior` varchar(8) NOT NULL,
  `colonia` varchar(30) NOT NULL,
  `municipio` varchar(30) NOT NULL,
  `ciudad` varchar(30) NOT NULL,
  `referencia` varchar(45) NOT NULL,
  `estado` varchar(30) NOT NULL,
  `CP` varchar(6) NOT NULL,
  `pais` varchar(30) NOT NULL,
  `salario` double NOT NULL,
  PRIMARY KEY (`idEmpleado`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `tblsueldo`;
CREATE TABLE  `tblsueldo` (
  `idSueldo` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `idGasto` int(10) unsigned NOT NULL,
  `idEmpleado` int(10) unsigned NOT NULL,
  `sueldo` double NOT NULL,
  `dias` double NOT NULL,
  `total` double NOT NULL,
  PRIMARY KEY (`idSueldo`)
) ENGINE=InnoDB AUTO_INCREMENT=29 DEFAULT CHARSET=latin1;


insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho)values(500,300,40,1,40,4,0,864);

delete from tblimpresionesnodos where documento=40 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio:','docFolio',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Folio',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(186,81,'Fecha:','docFecha',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,122,'Nombre:','clienteNombre',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Cliente - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,144,'Dirección:','clienteDireccion',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Cliente - Direccion',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,166,'Número de cliente:','clienteNumero',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Cliente - Número',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(412,122,'Evaluador:','docEvaluador',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Evaluador',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(411,167,'Fecha de Vencimiento:','docFechaVen',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Fecha de Vencimiento',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(145,191,'Prestamo:','docPrestamo',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Prestamo con letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,217,'Interés díario:','docInteresdoc',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Interés total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(574,217,'Plazo para desempeño:','docPlazoDesempenio',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Plazo para desempeño',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(573,243,'Fecha límite finiquito:','docFechaLimiteFini',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Fecha límite finiquito',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(577,268,'Inicio de comercialización:','docInicioComerciali',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Inicio de comercialización',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(410,145,'Avalúo:','ArticuloAvaluo',300,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Avalúo',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(36,317,'Descripción:','ArticuloDescripcion',300,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Descripcion',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(341,317,'Peso:','ArticuloPeso',100,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Peso',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(447,316,'Kilates:','ArticuloKilates',100,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Kilates',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(68,395,'PLAZO','et01',50,10,'Lucida Console',8,0,0,0,0,1,40,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(149,396,'FECHA DE PAGO','et02',100,10,'Lucida Console',8,0,0,0,0,1,40,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(279,396,'INTERÉS','et03',50,10,'Lucida Console',8,0,0,0,0,1,40,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(375,397,'ALMACENAJE','et04',80,10,'Lucida Console',8,0,0,0,0,1,40,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(479,397,'REFERIDO','et05',80,10,'Lucida Console',8,0,0,0,0,1,40,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(588,394,'DESEMPEÑO','et06',80,10,'Lucida Console',8,0,0,0,0,1,40,1,2,0,'Etiqueta06',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(5,413,'Línea01','ln01',864,2,'Arial',10,0,0,0,0,1,40,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(350,218,'% del prestamo interes','docPorcentajeInteres',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - % del prestamo interés',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(679,28,'Número de registro:','docNumerodeRegistro',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Número de registro',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,423,'Plazo:','ArticuloPlazo30',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Plazo 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,423,'Fecha de Pago:','ArticuloFechaPago30',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Fecha de pago 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,423,'Interés:','ArticuloInteres30',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Interés 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,423,'Almacenaje:','ArticuloAlmacenaje30',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Almacenaje 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,423,'Refrendo:','ArticuloRefrendo30',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Refrendo 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,423,'Desempeño:','ArticuloDesempenio30',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Desempeño 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,449,'Plazo:','ArticuloPlazo60',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Plazo 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,449,'Fecha de Pago:','ArticuloFechaPago60',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Fecha de pago 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,449,'Interés:','ArticuloInteres60',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Interés 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,449,'Almacenaje:','ArticuloAlmacenaje60',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Almacenaje 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,449,'Refrendo:','ArticuloRefrendo60',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Refrendo 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,449,'Desempeño:','ArticuloDesempenio60',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Desempeño 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,475,'Plazo:','ArticuloPlazo90',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Plazo 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,475,'Fecha de Pago:','ArticuloFechaPago90',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Fecha de pago 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,475,'Interés:','ArticuloInteres90',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Interés 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,475,'Almacenaje:','ArticuloAlmacenaje90',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Almacenaje 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,475,'Refrendo:','ArticuloRefrendo90',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Refrendo 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,475,'Desempeño:','ArticuloDesempenio90',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Desempeño 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,500,'Plazo:','ArticuloPlazo120',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Plazo 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,500,'Fecha de Pago:','ArticuloFechaPago120',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Fecha de pago 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,500,'Interés:','ArticuloInteres120',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Interés 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,500,'Almacenaje:','ArticuloAlmacenaje120',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Almacenaje 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,500,'Refrendo:','ArticuloRefrendo120',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Refrendo 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,500,'Desempeño:','ArticuloDesempenio120',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Artículo - Desempeño 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(36,40,'Forma de pago:','docFormaPago',250,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Forma de Pago',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,191,'Prestamo:','docPrestamoNumero',100,20,'Arial',10,0,0,0,0,1,40,1,0,0,'Documento - Prestamo con Numero',0,1);

insert into tblimpresiones(y,yl,documento,idsucursal,rg,alt,modo,ancho)values(500,300,40+16,1,40,4,0,864);

delete from tblimpresionesnodos where documento=40+16 and idsucursal=1;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Folio:','docFolio',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Folio',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(186,81,'Fecha:','docFecha',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Fecha',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,122,'Nombre:','clienteNombre',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Cliente - Nombre',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,144,'Dirección:','clienteDireccion',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Cliente - Direccion',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,166,'Número de cliente:','clienteNumero',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Cliente - Número',0,2);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(412,122,'Evaluador:','docEvaluador',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Evaluador',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(411,167,'Fecha de Vencimiento:','docFechaVen',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Fecha de Vencimiento',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(145,191,'Prestamo:','docPrestamo',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Prestamo con letra',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,217,'Interés díario:','docInteresdoc',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Interés total',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(574,217,'Plazo para desempeño:','docPlazoDesempenio',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Plazo para desempeño',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(573,243,'Fecha límite finiquito:','docFechaLimiteFini',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Fecha límite finiquito',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(577,268,'Inicio de comercialización:','docInicioComerciali',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Inicio de comercialización',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(410,145,'Avalúo:','ArticuloAvaluo',300,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Avalúo',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(36,317,'Descripción:','ArticuloDescripcion',300,20,'Arial',10,0,0,1,0,1,40+16,1,0,0,'Artículo - Descripcion',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(341,317,'Peso:','ArticuloPeso',100,20,'Arial',10,0,0,1,0,1,40+16,1,0,0,'Artículo - Peso',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(447,316,'Kilates:','ArticuloKilates',100,20,'Arial',10,0,0,1,0,1,40+16,1,0,0,'Artículo - Kilates',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(68,395,'PLAZO','et01',50,10,'Lucida Console',8,0,0,0,0,1,40+16,1,2,0,'Etiqueta01',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(149,396,'FECHA DE PAGO','et02',100,10,'Lucida Console',8,0,0,0,0,1,40+16,1,2,0,'Etiqueta02',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(279,396,'INTERÉS','et03',50,10,'Lucida Console',8,0,0,0,0,1,40+16,1,2,0,'Etiqueta03',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(375,397,'ALMACENAJE','et04',80,10,'Lucida Console',8,0,0,0,0,1,40+16,1,2,0,'Etiqueta04',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(479,397,'REFERIDO','et05',80,10,'Lucida Console',8,0,0,0,0,1,40+16,1,2,0,'Etiqueta05',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(588,394,'DESEMPEÑO','et06',80,10,'Lucida Console',8,0,0,0,0,1,40+16,1,2,0,'Etiqueta06',0,7);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(5,413,'Línea01','ln01',864,2,'Arial',10,0,0,0,0,1,40+16,1,1,0,'Línea01',0,8);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(350,218,'% del prestamo interes','docPorcentajeInteres',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - % del prestamo interés',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(679,28,'Número de registro:','docNumerodeRegistro',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Número de registro',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,423,'Plazo:','ArticuloPlazo30',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Plazo 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,423,'Fecha de Pago:','ArticuloFechaPago30',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Fecha de pago 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,423,'Interés:','ArticuloInteres30',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Interés 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,423,'Almacenaje:','ArticuloAlmacenaje30',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Almacenaje 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,423,'Refrendo:','ArticuloRefrendo30',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Refrendo 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,423,'Desempeño:','ArticuloDesempenio30',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Desempeño 30',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,449,'Plazo:','ArticuloPlazo60',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Plazo 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,449,'Fecha de Pago:','ArticuloFechaPago60',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Fecha de pago 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,449,'Interés:','ArticuloInteres60',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Interés 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,449,'Almacenaje:','ArticuloAlmacenaje60',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Almacenaje 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,449,'Refrendo:','ArticuloRefrendo60',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Refrendo 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,449,'Desempeño:','ArticuloDesempenio60',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Desempeño 60',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,475,'Plazo:','ArticuloPlazo90',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Plazo 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,475,'Fecha de Pago:','ArticuloFechaPago90',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Fecha de pago 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,475,'Interés:','ArticuloInteres90',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Interés 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,475,'Almacenaje:','ArticuloAlmacenaje90',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Almacenaje 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,475,'Refrendo:','ArticuloRefrendo90',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Refrendo 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,475,'Desempeño:','ArticuloDesempenio90',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Desempeño 90',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(40,500,'Plazo:','ArticuloPlazo120',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Plazo 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(148,500,'Fecha de Pago:','ArticuloFechaPago120',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Fecha de pago 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(256,500,'Interés:','ArticuloInteres120',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Interés 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(364,500,'Almacenaje:','ArticuloAlmacenaje120',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Almacenaje 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(472,500,'Refrendo:','ArticuloRefrendo120',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Refrendo 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(581,500,'Desempeño:','ArticuloDesempenio120',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Artículo - Desempeño 120',0,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(36,40,'Forma de pago:','docFormaPago',250,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Forma de Pago',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(43,191,'Prestamo:','docPrestamoNumero',100,20,'Arial',10,0,0,0,0,1,40+16,1,0,0,'Documento - Prestamo con Numero',0,1);




insert into tblempeniosconfiguracion (factor,folio,interes,diasProrroga,numRegistro,almacenaje,A1a30,A31a60,A61a90,A90mas,B1a30,B31a60,B61a90,B90mas ,aumentoPrenda) Values(20,0,0.18,15,'xxxx-xxxx',0.12,0.18,0.18,0.18,0,0.12,0.12,0.12,0,20);


update tblopciones set nombreempresalocal='0';

ALTER TABLE `tblempenios` ADD COLUMN `idforma` INTEGER UNSIGNED NOT NULL AFTER `TotalAux`;
update tblempenios set idforma=1;

CREATE TABLE `tblAdquiriente` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(254) NOT NULL,
  `ApellidoPaterno` VARCHAR(200) NOT NULL,
  `ApellidoMaterno` VARCHAR(200) NOT NULL,
  `RFC` VARCHAR(13) NOT NULL,
  `CURP` VARCHAR(18) NOT NULL,
  `IDNotario` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;


CREATE TABLE `tblAdquirientes` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(254) NOT NULL,
  `ApellidoPaterno` VARCHAR(200) NOT NULL,
  `ApellidoMaterno` VARCHAR(200) NOT NULL,
  `RFC` VARCHAR(13) NOT NULL,
  `CURP` VARCHAR(18) NOT NULL,
  `Porcentaje` DOUBLE NOT NULL,
  `IDNotario` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

CREATE TABLE `tblEnajenante` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(254) NOT NULL,
  `ApellidoPaterno` VARCHAR(200) NOT NULL,
  `ApellidoMaterno` VARCHAR(200) NOT NULL,
  `RFC` VARCHAR(13) NOT NULL,
  `CURP` VARCHAR(18) NOT NULL,
  `IDNotario` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;


CREATE TABLE `tblEnajenantes` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(254) NOT NULL,
  `ApellidoPaterno` VARCHAR(200) NOT NULL,
  `ApellidoMaterno` VARCHAR(200) NOT NULL,
  `RFC` VARCHAR(13) NOT NULL,
  `CURP` VARCHAR(18) NOT NULL,
  `Porcentaje` DOUBLE NOT NULL,
  `IDNotario` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

CREATE TABLE `tblEstados` (
  `id` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `estado` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`)
)
ENGINE = InnoDB;

insert into tblestados (estado) values("Aguascalientes");
insert into tblestados (estado) values("Baja California Norte");
insert into tblestados (estado) values("Baja California Sur");
insert into tblestados (estado) values("Campeche");
insert into tblestados (estado) values("Coahuila");
insert into tblestados (estado) values("Colima");
insert into tblestados (estado) values("Chiapas");
insert into tblestados (estado) values("Chihuahua");
insert into tblestados (estado) values("Distrito Federal");
insert into tblestados (estado) values("Durango");
insert into tblestados (estado) values("Guanajuato");
insert into tblestados (estado) values("Guerrero");

insert into tblestados (estado) values("Hidalgo");
insert into tblestados (estado) values("Jalisco");
insert into tblestados (estado) values("México");
insert into tblestados (estado) values("Mmichoacán");
insert into tblestados (estado) values("Morelos");
insert into tblestados (estado) values("Nayarit");
insert into tblestados (estado) values("Nuevo León");
insert into tblestados (estado) values("Oaxaca");
insert into tblestados (estado) values("Puebla");
insert into tblestados (estado) values("Queretaro");

insert into tblestados (estado) values("Quintana Roo");
insert into tblestados (estado) values("San Luis Potosí");
insert into tblestados (estado) values("Sinaloa");
insert into tblestados (estado) values("Sonora");
insert into tblestados (estado) values("Tabasco");
insert into tblestados (estado) values("Tamaulipas");
insert into tblestados (estado) values("Tlaxcala");
insert into tblestados (estado) values("Veracruz");
insert into tblestados (estado) values("Yucatan");
insert into tblestados (estado) values("Zacatecas");

CREATE TABLE `tblNotariosPublicos` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `TipoInmueble` VARCHAR(2) NOT NULL,
  `Calle` VARCHAR(150) NOT NULL,
  `NoExterior` VARCHAR(55) NOT NULL,
  `NoInterior` VARCHAR(30) NOT NULL,
  `Colonia` VARCHAR(100) NOT NULL,
  `Localidad` VARCHAR(100) NOT NULL,
  `Referencia` VARCHAR(100) NOT NULL,
  `Municipio` VARCHAR(100) NOT NULL,
  `Estado` INTEGER UNSIGNED NOT NULL,
  `Pais` VARCHAR(3) NOT NULL,
  `CodigoPostal` VARCHAR(5) NOT NULL,
  `NumInstrumentoNotarial` INTEGER UNSIGNED NOT NULL,
  `FechaInstNotarial` VARCHAR(11) NOT NULL,
  `MontoOperacion` DOUBLE NOT NULL,
  `Subtotal` DOUBLE NOT NULL,
  `IVA` DOUBLE NOT NULL,
  `CURP` VARCHAR(18) NOT NULL,
  `NumNotaria` INTEGER UNSIGNED NOT NULL,
  `EntidadFederativa` INTEGER UNSIGNED NOT NULL,
  `Adscripcion` VARCHAR(255) NOT NULL,
  `CoproSocConyugalE` BOOLEAN NOT NULL,
  `CoproSocConyugalE2` BOOLEAN NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

ALTER TABLE `tblnotariospublicos` ADD COLUMN `idFactura` INTEGER UNSIGNED NOT NULL AFTER `CoproSocConyugalE2`;

CREATE TABLE `tblTipoInmueble` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

insert into tbltipoinmueble(nombre) values("Terreno");
insert into tbltipoinmueble(nombre) values("Terreno uso comercial");
insert into tbltipoinmueble(nombre) values("Construcción habitacional");
insert into tbltipoinmueble(nombre) values("Construcción uso comercial");
insert into tbltipoinmueble(nombre) values("Uso mixto");

CREATE TABLE `tblPais` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(100) NOT NULL,
  `clave` VARCHAR(3) NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

insert into tblpais (nombre,clave) values("AFGANISTAN (EMIRATO ISLAMICO DE)","AFG");
insert into tblpais (nombre,clave) values("ALBANIA (REPUBLICA DE)","ALB");
insert into tblpais (nombre,clave) values("ALEMANIA (REPUBLICA FEDERAL DE)","DEU");
insert into tblpais (nombre,clave) values("ANDORRA (PRINCIPADO DE)","AND");
insert into tblpais (nombre,clave) values("ANGOLA (REPUBLICA DE)","AGO");
insert into tblpais (nombre,clave) values("ANGUILA","AIA");
insert into tblpais (nombre,clave) values("ANTIGUA Y BARBUDA (COMUNIDAD BRITANICA DE NACIONES)","ATG");
insert into tblpais (nombre,clave) values("ANTILLAS NEERLANDESAS (TERRITORIO HOLANDES DE ULTRAMAR)","ANT");
insert into tblpais (nombre,clave) values("ARABIA SAUDITA (REINO DE)","SAU");
insert into tblpais (nombre,clave) values("ARGELIA (REPUBLICA DEMOCRATICA Y POPULAR DE)","DZA");
insert into tblpais (nombre,clave) values("ARGENTINA(REPUBLICA)","ARG");
insert into tblpais (nombre,clave) values("ARMENIA (REPUBLICA DE)","ARM");
insert into tblpais (nombre,clave) values("ARUBA (TERRITORIO HOLANDES DE ULTRAMAR)","ABW");
insert into tblpais (nombre,clave) values("AUSTRALIA (COMUNIDAD DE)","AUS");
insert into tblpais (nombre,clave) values("AUSTRIA (REPUBLICA DE)","AUT");
insert into tblpais (nombre,clave) values("AZERBAIJAN (REPUBLICA AZERBAIJANI)","AZE");
insert into tblpais (nombre,clave) values("BAHAMAS (COMUNIDAD DE LAS)","BHS");
insert into tblpais (nombre,clave) values("BAHREIN (ESTADO DE)","BHR");
insert into tblpais (nombre,clave) values("BANGLADESH (REPUBLICA POPULAR DE)","BGD");
insert into tblpais (nombre,clave) values("BARBADOS (COMUNIDAD BRITANICA DE NACIONES)","BRB");
insert into tblpais (nombre,clave) values("BELGICA (REINO DE)","BEL");
insert into tblpais (nombre,clave) values("BELICE","BLZ");
insert into tblpais (nombre,clave) values("BENIN (REPUBLICA DE)","BEN");
insert into tblpais (nombre,clave) values("BERMUDAS","BMU");
insert into tblpais (nombre,clave) values("BIELORRUSIA (REPUBLICA DE)","BLR");
insert into tblpais (nombre,clave) values("BOLIVIA (REPUBLICA DE)","BOL");
insert into tblpais (nombre,clave) values("BOSNIA Y HERZEGOVINA","BIH");
insert into tblpais (nombre,clave) values("BOTSWANA (REPUBLICA DE)","BWA");
insert into tblpais (nombre,clave) values("BRASIL (REPUBLICA FEDERATIVA DE)","BRA");
insert into tblpais (nombre,clave) values("BRUNEI (ESTADO DE)(RESIDENCIA DE PAZ)","BRN");
insert into tblpais (nombre,clave) values("BULGARIA (REPUBLICA DE)","BGR");
insert into tblpais (nombre,clave) values("BURKINA FASO","BFA");
insert into tblpais (nombre,clave) values("BURUNDI (REPUBLICA DE)","BDI");
insert into tblpais (nombre,clave) values("BUTAN (REINO DE)","BTN");
insert into tblpais (nombre,clave) values("CABO VERDE (REPUBLICA DE)","CPV");
insert into tblpais (nombre,clave) values("CHAD (REPUBLICA DEL)","TCD");
insert into tblpais (nombre,clave) values("CAIMAN(ISLAS)","CYM");
insert into tblpais (nombre,clave) values("CAMBOYA (REINO DE)","KHM");
insert into tblpais (nombre,clave) values("CAMERUN (REPUBLICA DEL)","CMR");
insert into tblpais (nombre,clave) values("CANADA","CAN");
insert into tblpais (nombre,clave) values("CANAL, ISLAS DEL (ISLAS NORMANDAS)","RKE");
insert into tblpais (nombre,clave) values("CHILE (REPUBLICA DE)","CHL");
insert into tblpais (nombre,clave) values("CHINA (REPUBLICA POPULAR)","CHN");
insert into tblpais (nombre,clave) values("CHIPRE (REPUBLICA DE)","CYP");
insert into tblpais (nombre,clave) values("CIUDAD DEL VATICANO (ESTADO DE LA)","CIA");
insert into tblpais (nombre,clave) values("COCOS (KEELING, ISLAS AUSTRALIANAS)","CCK");
insert into tblpais (nombre,clave) values("COLOMBIA (REPUBLICA DE)","COL");
insert into tblpais (nombre,clave) values("COMORAS(ISLAS)","COM");
insert into tblpais (nombre,clave) values("COMUNIDAD EUROPEA","EMU");
insert into tblpais (nombre,clave) values("CONGO (REPUBLICA DEL)","COG");
insert into tblpais (nombre,clave) values("COOK(ISLAS)","COK");
insert into tblpais (nombre,clave) values("COREA (REPUBLICA POPULAR DEMOCRATICA DE) (COREA DEL NORTE) ","PRK");
insert into tblpais (nombre,clave) values("COREA (REPUBLICA DE) (COREA DEL SUR)","KOR");
insert into tblpais (nombre,clave) values("A DE MARFIL (REPUBLICA DE LA)","COS");
insert into tblpais (nombre,clave) values("COSTA RICA (REPUBLICA DE)","CRI");
insert into tblpais (nombre,clave) values("CROACIA (REPUBLICA DE)","HRV");
insert into tblpais (nombre,clave) values(" CUBA (REPUBLICA DE)","vCU");
insert into tblpais (nombre,clave) values("CURAZAO (TERRITORIO HOLANDES DE ULTRAMAR)","CUR");
insert into tblpais (nombre,clave) values("DINAMARCA (REINO DE)","DNK");
insert into tblpais (nombre,clave) values("DJIBOUTI (REPUBLICA DE)","DJI");
insert into tblpais (nombre,clave) values("DOMINICA (COMUNIDAD DE)","DMA");
insert into tblpais (nombre,clave) values("ECUADOR (REPUBLICA DEL)","ECU");
insert into tblpais (nombre,clave) values("EGIPTO (REPUBLICA ARABE DE)","EGY");
insert into tblpais (nombre,clave) values("EL SALVADOR (REPUBLICA DE)","SLV");
insert into tblpais (nombre,clave) values("EMIRATOS ARABES UNIDOS","ARE");
insert into tblpais (nombre,clave) values("ERITREA (ESTADO DE)","ERI");
insert into tblpais (nombre,clave) values("ESLOVENIA (REPUBLICA DE)","SVN");
insert into tblpais (nombre,clave) values("ESPAÑA (REINO DE)","ESP");
insert into tblpais (nombre,clave) values("ESTADO FEDERADO DE MICRONESIA","DSM");
insert into tblpais (nombre,clave) values("ESTADOS UNIDOS DE AMERICA","USA");
insert into tblpais (nombre,clave) values("ESTONIA (REPUBLICA DE)","EST");
insert into tblpais (nombre,clave) values("ETIOPIA (REPUBLICA DEMOCRATICA FEDERAL)","ETH");
insert into tblpais (nombre,clave) values("FIDJI (REPUBLICA DE)","FJI");
insert into tblpais (nombre,clave) values("FILIPINAS (REPUBLICA DE LAS)","PHL");
insert into tblpais (nombre,clave) values("FINLANDIA (REPUBLICA DE)","FIN");
insert into tblpais (nombre,clave) values("FRANCIA (REPUBLICA FRANCESA)","FRA");
insert into tblpais (nombre,clave) values("FRANJA DE GAZA","GZA");
insert into tblpais (nombre,clave) values("GABONESA(REPUBLICA)","GAB");
insert into tblpais (nombre,clave) values("GAMBIA (REPUBLICA DE LA)","GMB");
insert into tblpais (nombre,clave) values("GEORGIA (REPUBLICA DE)","GEO");
insert into tblpais (nombre,clave) values("GHANA (REPUBLICA DE)","GHA");
insert into tblpais (nombre,clave) values("GIBRALTAR (R.U.)","GIB");
insert into tblpais (nombre,clave) values("GRANADA","GRD");
insert into tblpais (nombre,clave) values("GRECIA (REPUBLICA HELENICA)","GRC");
insert into tblpais (nombre,clave) values("GROENLANDIA(DINAMARCA)","GRL");
insert into tblpais (nombre,clave) values("GUADALUPE (DEPARTAMENTO DE)","GLP");
insert into tblpais (nombre,clave) values("GUAM (E.U.A.) ","GUM");
insert into tblpais (nombre,clave) values("GUATEMALA (REPUBLICA DE)","GTM");
insert into tblpais (nombre,clave) values("GUINEA-BISSAU (REPUBLICA DE)","GNB");
insert into tblpais (nombre,clave) values("GUINEA ECUATORIAL (REPUBLICA DE)","GNQ");
insert into tblpais (nombre,clave) values("GUINEA (REPUBLICA DE)","GIN");
insert into tblpais (nombre,clave) values("GUYANA FRANCESA","GUF");
insert into tblpais (nombre,clave) values("GUYANA (REPUBLICA COOPERATIVA DE)","GUY");
insert into tblpais (nombre,clave) values("HAITI (REPUBLICA DE)","HTI");
insert into tblpais (nombre,clave) values("HONDURAS (REPUBLICA DE)","HND");
insert into tblpais (nombre,clave) values("HONG KONG (REGION ADMINISTRATIVA ESPECIAL DE LA REPUBLICA) ","HKG");
insert into tblpais (nombre,clave) values("HUNGRIA (REPUBLICA DE)","HUN");
insert into tblpais (nombre,clave) values("INDIA (REPUBLICA DE)","IND");
insert into tblpais (nombre,clave) values("INDONESIA (REPUBLICA DE)","IDN");
insert into tblpais (nombre,clave) values("IRAK (REPUBLICA DE)","IRQ");
insert into tblpais (nombre,clave) values("IRAN (REPUBLICA ISLAMICA DEL)","IRN");
insert into tblpais (nombre,clave) values("IRLANDA (REPUBLICA DE)","IRL");
insert into tblpais (nombre,clave) values("ISLANDIA (REPUBLICA DE)","ISL");
insert into tblpais (nombre,clave) values("ISLAS HEARD Y MCDONALD","LHM");
insert into tblpais (nombre,clave) values("ISLAS MALVINAS (R.U.)","FLK");
insert into tblpais (nombre,clave) values("ISLAS MARIANAS SEPTENTRIONALES","MNP");
insert into tblpais (nombre,clave) values("ISLAS MARSHALL","MHL");
insert into tblpais (nombre,clave) values("ISLAS SALOMON (COMUNIDAD BRITANICA DE NACIONES)","SLB");
insert into tblpais (nombre,clave) values("ISLAS SVALBARD Y JAN MAYEN (NORUEGA)","SJM");
insert into tblpais (nombre,clave) values("ISLAS TOKELAU","TKL");
insert into tblpais (nombre,clave) values("ISLAS WALLIS Y FUTUNA","WLF");
insert into tblpais (nombre,clave) values("ISRAEL (ESTADO DE)","ISR");
insert into tblpais (nombre,clave) values("ITALIA (REPUBLICA ITALIANA)","ITA");
insert into tblpais (nombre,clave) values("JAMAICA","JAM");
insert into tblpais (nombre,clave) values("JAPON","JPN");
insert into tblpais (nombre,clave) values("JORDANIA (REINO HACHEMITA DE)","JOR");
insert into tblpais (nombre,clave) values("KAZAKHSTAN (REPUBLICA DE) ","KAZ");
insert into tblpais (nombre,clave) values("KENYA (REPUBLICA DE)","KEN");
insert into tblpais (nombre,clave) values("KIRIBATI (REPUBLICA DE)","KIR");
insert into tblpais (nombre,clave) values("KUWAIT (ESTADO DE)","KWT");
insert into tblpais (nombre,clave) values("KYRGYZSTAN (REPUBLICA KIRGYZIA)","KGZ");
insert into tblpais (nombre,clave) values("LESOTHO (REINO DE)","LSO");
insert into tblpais (nombre,clave) values("LETONIA (REPUBLICA DE)","LVA");
insert into tblpais (nombre,clave) values("LIBANO (REPUBLICA DE)","LBN");
insert into tblpais (nombre,clave) values("LIBERIA (REPUBLICA DE)","LBR");
insert into tblpais (nombre,clave) values("LIBIA (JAMAHIRIYA LIBIA ARABE POPULAR SOCIALISTA)","LBY");
insert into tblpais (nombre,clave) values("LIECHTENSTEIN (PRINCIPADO DE)","LIE");
insert into tblpais (nombre,clave) values("LITUANIA (REPUBLICA DE)","LTU");
insert into tblpais (nombre,clave) values("LUXEMBURGO (GRAN DUCADO DE)","LUX");
insert into tblpais (nombre,clave) values("MACAO","MAC");
insert into tblpais (nombre,clave) values("MACEDONIA (ANTIGUA REPUBLICA YUGOSLAVA DE)","MKD");
insert into tblpais (nombre,clave) values("MADAGASCAR (REPUBLICA DE)","MDG");
insert into tblpais (nombre,clave) values("MALASIA","MYS");
insert into tblpais (nombre,clave) values("MALAWI (REPUBLICA DE)","MWI");
insert into tblpais (nombre,clave) values("MALDIVAS (REPUBLICA DE)","MDV");
insert into tblpais (nombre,clave) values("MALI (REPUBLICA DE)","MLI");
insert into tblpais (nombre,clave) values("MALTA (REPUBLICA DE)","MLT");
insert into tblpais (nombre,clave) values("MARRUECOS (REINO DE)","MAR");
insert into tblpais (nombre,clave) values("MARTINICA (DEPARTAMENTO DE) (FRANCIA)","MTQ");
insert into tblpais (nombre,clave) values("MAURICIO (REPUBLICA DE)","MUS");
insert into tblpais (nombre,clave) values("MAURITANIA (REPUBLICA ISLAMICA DE)","MRT");
insert into tblpais (nombre,clave) values("MEXICO (ESTADOS UNIDOS MEXICANOS)","MEX");
insert into tblpais (nombre,clave) values("MOLDAVIA (REPUBLICA DE)","MDA");
insert into tblpais (nombre,clave) values("MONACO (PRINCIPADO DE)","MCO");
insert into tblpais (nombre,clave) values("MONGOLIA","MNG");
insert into tblpais (nombre,clave) values("MONSERRAT(ISLA)","MSR");
insert into tblpais (nombre,clave) values("MOZAMBIQUE (REPUBLICA DE)","MOZ");
insert into tblpais (nombre,clave) values("MYANMAR (UNION DE)","MMR");
insert into tblpais (nombre,clave) values("NAMIBIA (REPUBLICA DE)","NAM");
insert into tblpais (nombre,clave) values("NAURU","NRU");
insert into tblpais (nombre,clave) values("NAVIDAD(CHRISTMAS)(ISLAS)","CXI");
insert into tblpais (nombre,clave) values("NEPAL (REINO DE)","NPL");
insert into tblpais (nombre,clave) values("NICARAGUA (REPUBLICA DE)","NIC");
insert into tblpais (nombre,clave) values("NIGER (REPUBLICA DE)","NER");
insert into tblpais (nombre,clave) values("NIGERIA (REPUBLICA FEDERAL DE)","NGA");
insert into tblpais (nombre,clave) values("NIVE(ISLA)","NIU");
insert into tblpais (nombre,clave) values("NORFOLK(ISLA)","NFK");
insert into tblpais (nombre,clave) values("NORUEGA (REINO DE)","NOR");
insert into tblpais (nombre,clave) values("NUEVA CALEDONIA (TERRITORIO FRANCES DE ULTRAMAR)","NCL");
insert into tblpais (nombre,clave) values("NUEVA ZELANDIA","NZL");
insert into tblpais (nombre,clave) values("OMAN (SULTANATO DE)","OMN");
insert into tblpais (nombre,clave) values("PACIFICO, ISLAS DEL (ADMON. E.U.A.)","PIK");
insert into tblpais (nombre,clave) values("PAISES BAJOS (REINO DE LOS) (HOLANDA)","ZYA");
insert into tblpais (nombre,clave) values("PAISES NO DECLARADOS","KCD");
insert into tblpais (nombre,clave) values("PAKISTAN (REPUBLICA ISLAMICA DE)","PAK");
insert into tblpais (nombre,clave) values("PALAU (REPUBLICA DE)","PLW");
insert into tblpais (nombre,clave) values("PANAMA (REPUBLICA DE)","PAN");
insert into tblpais (nombre,clave) values("PAPUA NUEVA GUINEA (ESTADO INDEPENDIENTE DE)","PNG");
insert into tblpais (nombre,clave) values("PARAGUAY (REPUBLICA DEL)","PRY");
insert into tblpais (nombre,clave) values("PERU (REPUBLICA DEL)","PER");
insert into tblpais (nombre,clave) values("PITCAIRNS (ISLAS DEPENDENCIA BRITANICA)","PCN");
insert into tblpais (nombre,clave) values("POLINESIA FRANCESA","PYF");
insert into tblpais (nombre,clave) values("POLONIA (REPUBLICA DE)","POL");
insert into tblpais (nombre,clave) values("PORTUGAL (REPUBLICA PORTUGUESA)","PRT");
insert into tblpais (nombre,clave) values("PUERTO RICO (ESTADO LIBRE ASOCIADO DE LA COMUNIDAD DE)","PRI");
insert into tblpais (nombre,clave) values("QATAR (ESTADO DE)","QAT");
insert into tblpais (nombre,clave) values("REINO UNIDO DE LA GRAN BRETAÑA E IRLANDA DEL NORTE","GBR");
insert into tblpais (nombre,clave) values("REPUBLICA CHECA","CZE");
insert into tblpais (nombre,clave) values("REPUBLICA CENTROAFRICANA","CAF");
insert into tblpais (nombre,clave) values("REPUBLICA DEMOCRATICA POPULAR LAOS","LAO");
insert into tblpais (nombre,clave) values("REPUBLICA DOMINICANA","DOM");
insert into tblpais (nombre,clave) values("REPUBLICA ESLOVACA","SVK");
insert into tblpais (nombre,clave) values("REPUBLICA POPULAR DEL CONGO","COD");
insert into tblpais (nombre,clave) values("REPUBLICA RUANDESA","RWA");
insert into tblpais (nombre,clave) values("REUNION (DEPARTAMENTO DE LA) (FRANCIA)","REU");
insert into tblpais (nombre,clave) values("RUMANIA","ROM");
insert into tblpais (nombre,clave) values("RUSIA (FEDERACION RUSA)","RUS");
insert into tblpais (nombre,clave) values("SAHARA OCCIDENTAL (REPUBLICA ARABE SAHARAVI DEMOCRATICA)","ESH");
insert into tblpais (nombre,clave) values("SAMOA (ESTADO INDEPENDIENTE DE)","WSM");
insert into tblpais (nombre,clave) values("SAN CRISTOBAL Y NIEVES (FEDERACION DE) (SAN KITTS-NEVIS)","KNA");
insert into tblpais (nombre,clave) values("SAN MARINO (SERENISIMA REPUBLICA DE)","SMR");
insert into tblpais (nombre,clave) values("SAN PEDRO Y MIQUELON","SPM");
insert into tblpais (nombre,clave) values("SAN VICENTE Y LAS GRANADINAS","VCT");
insert into tblpais (nombre,clave) values("SANTA ELENA ","SHN");
insert into tblpais (nombre,clave) values("SANTA LUCIA ","LCA");
insert into tblpais (nombre,clave) values("SANTO TOME Y PRINCIPE (REPUBLICA DEMOCRATICA DE)","STP");
insert into tblpais (nombre,clave) values("SENEGAL (REPUBLICA DEL)","SEN");
insert into tblpais (nombre,clave) values("SEYCHELLES (REPUBLICA DE LAS)","SYC");
insert into tblpais (nombre,clave) values("SIERRA LEONA (REPUBLICA DE)","SLE");
insert into tblpais (nombre,clave) values("SINGAPUR (REPUBLICA DE)","SGP");
insert into tblpais (nombre,clave) values("SIRIA (REPUBLICA ARABE)","SYR");
insert into tblpais (nombre,clave) values("SOMALIA","SOM");
insert into tblpais (nombre,clave) values("SRI LANKA (REPUBLICA DEMOCRATICA SOCIALISTA DE)","LKA");
insert into tblpais (nombre,clave) values("SUDAFRICA (REPUBLICA DE)","ZAF");
insert into tblpais (nombre,clave) values("SUDAN (REPUBLICA DEL)","SDN");
insert into tblpais (nombre,clave) values("SUECIA (REINO DE)","SWE");
insert into tblpais (nombre,clave) values("SUIZA(CONFEDERACION)","CHE");
insert into tblpais (nombre,clave) values("SURINAME (REPUBLICA DE)","SUR");
insert into tblpais (nombre,clave) values("SWAZILANDIA (REINO DE)","SWZ");
insert into tblpais (nombre,clave) values("TADJIKISTAN (REPUBLICA DE)","TJK");
insert into tblpais (nombre,clave) values("TAILANDIA (REINO DE)","THA");
insert into tblpais (nombre,clave) values("TAIWAN (REPUBLICA DE CHINA)","TWN");
insert into tblpais (nombre,clave) values("TANZANIA (REPUBLICA UNIDA DE)","TZA");
insert into tblpais (nombre,clave) values("TERRITORIOS BRITANICOS DEL OCEANO INDICO","XCH");
insert into tblpais (nombre,clave) values("TERRITORIOS FRANCESES, AUSTRALES Y ANTARTICOS","FXA");
insert into tblpais (nombre,clave) values("TIMOR ORIENTAL","TMP");
insert into tblpais (nombre,clave) values("TOGO (REPUBLICA TOGOLESA)","TGO");
insert into tblpais (nombre,clave) values("TONGA (REINO DE)","TON");
insert into tblpais (nombre,clave) values("TRINIDAD Y TOBAGO (REPUBLICA DE)","TTO");
insert into tblpais (nombre,clave) values("TUNEZ (REPUBLICA DE)","TUN");
insert into tblpais (nombre,clave) values("TURCAS Y CAICOS (ISLAS)","TCA");
insert into tblpais (nombre,clave) values("TURKMENISTAN (REPUBLICA DE)","TKM");
insert into tblpais (nombre,clave) values("TURQUIA (REPUBLICA DE)","TUR");
insert into tblpais (nombre,clave) values("TUVALU (COMUNIDAD BRITANICA DE NACIONES)","TUV");
insert into tblpais (nombre,clave) values("UCRANIA","UKR");
insert into tblpais (nombre,clave) values("UGANDA (REPUBLICA DE)","UGA");
insert into tblpais (nombre,clave) values("URUGUAY (REPUBLICA ORIENTAL DEL)","URY");
insert into tblpais (nombre,clave) values("UZBEJISTAN (REPUBLICA DE)","UZB");
insert into tblpais (nombre,clave) values("VANUATU","VUT");
insert into tblpais (nombre,clave) values("VENEZUELA (REPUBLICA DE)","VEN");
insert into tblpais (nombre,clave) values("VIETNAM (REPUBLICA SOCIALISTA DE)","VNM");
insert into tblpais (nombre,clave) values("VIRGENES.ISLAS(BRITANICAS)","VGB");
insert into tblpais (nombre,clave) values("VIRGENES.ISLAS(NORTEAMERICANAS)","VIR");
insert into tblpais (nombre,clave) values("YEMEN (REPUBLICA DE)","YEM");
insert into tblpais (nombre,clave) values("YUGOSLAVIA (REPUBLICA FEDERAL DE)","YUG");
insert into tblpais (nombre,clave) values("ZAMBIA (REPUBLICA DE)","ZMB");
insert into tblpais (nombre,clave) values("ZIMBABWE (REPUBLICA DE)","ZWE");
insert into tblpais (nombre,clave) values("ZONA DEL CANAL DE PANAMA","PTY");
insert into tblpais (nombre,clave) values("ZONA NEUTRAL IRAQ-ARABIA SAUDITA","RUH");


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,7,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,7,1,0,1,'Documento - Total IVA Ret.',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,7+16,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,7+16,1,0,1,'Documento - Total IVA Ret.',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,8,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,8,1,0,1,'Documento - Total IVA Ret.',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,8+16,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,8+16,1,0,1,'Documento - Total IVA Ret.',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,9,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,9,1,0,1,'Documento - Total IVA Ret.',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,9+16,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,9+16,1,0,1,'Documento - Total IVA Ret.',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,10,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,10,1,0,1,'Documento - Total IVA Ret.',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,10+16,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,10+16,1,0,1,'Documento - Total IVA Ret.',0,1);


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,11,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,11,1,0,1,'Documento - Total IVA Ret.',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IEPS:','doctotalieps',100,20,'Lucida Console',8,0,0,0,1,0,11+16,1,0,1,'Documento - Total IEPS',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(746,1016,'Total IVA Ret:','doctotalivaret',100,20,'Lucida Console',8,0,0,0,1,0,11+16,1,0,1,'Documento - Total IVA Ret.',0,1);


insert into tblactualizaciones(version) values('ver 9022 rev 12');

delete from tblempenios;
delete from tblempeniosdetalles;
delete from tblempeniosabono;

ALTER TABLE `tblempeniosabono` ADD COLUMN `totalEmepnio` DOUBLE NOT NULL AFTER `habilitado`,
 ADD COLUMN `totalRefrendo` DOUBLE NOT NULL AFTER `totalEmepnio`,
 ADD COLUMN `tipoPago` BOOLEAN NOT NULL AFTER `totalRefrendo`;

ALTER TABLE `tblempenios` ADD COLUMN `Adjudicado` BOOLEAN NOT NULL AFTER `idforma`;

update tblempenios set adjudicado=0; 

CREATE TABLE `tblEmpeniosAdjudicaciones` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEmpenio` VARCHAR(45) NOT NULL,
  `refrendo` VARCHAR(45) NOT NULL,
  `fechaAdjudicacion` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;



insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,10,'Empresa','nombrefiscal',500,20,'Arial',10,1,0,0,0,0,40,1,0,0,'Empresa - Nombre',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(244,20,'Calle - Empresa','direccion',150,20,'Arial',10,0,0,0,0,0,40,1,0,0,'Empresa - Calle',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(397,22,'No:','noexterior',220,20,'Arial',10,0,0,0,0,0,40,1,0,1,'Empresa - No. Exterior',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(683,11,'No. Interior - Empresa','nointerior',220,20,'Lucida Console',8,0,0,0,0,0,40,1,0,0,'Empresa - No. Interior',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(244,28,'Col:','colonia',160,20,'Arial',10,0,0,0,0,0,40,1,0,1,'Empresa - Colonia',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(389,23,'Ciudad - Empresa','ciudad',160,20,'Arial',10,0,0,0,0,0,40,1,0,0,'Empresa - Ciudad',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(297,29,'Estado - Empresa','estado',160,20,'Arial',10,0,0,0,0,0,40,1,0,0,'Empresa - Estado',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,72,'C.P:','cp',80,20,'Arial',10,0,0,0,0,0,40,1,0,1,'Empresa - CP',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(319,39,'RFC:','rfc',130,20,'Arial',10,0,0,0,0,0,40,1,0,1,'Empresa - RFC',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(379,28,'Tel:','tel',180,20,'Arial',10,0,0,0,0,0,40,1,0,1,'Empresa - Teléfono',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(239,56,'Email - Empresa','email',400,20,'Arial',10,0,0,0,0,0,40,1,0,0,'Empresa - Email',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(304,51,'Referencia - Empresa','referencia',200,20,'Lucida Console',8,0,0,0,0,0,40,1,0,0,'Empresa - Referencia',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(257,71,'Municipio empresa','municipio',136,20,'Arial',8,0,0,0,0,0,40,1,0,0,'Empresa - Municipio',0,5);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,10,'Empresa','nombrefiscal',500,20,'Arial',10,1,0,0,0,0,56,1,0,0,'Empresa - Nombre',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(244,20,'Calle - Empresa','direccion',150,20,'Arial',10,0,0,0,0,0,56,1,0,0,'Empresa - Calle',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(397,22,'No:','noexterior',220,20,'Arial',10,0,0,0,0,0,56,1,0,1,'Empresa - No. Exterior',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(683,11,'No. Interior - Empresa','nointerior',220,20,'Lucida Console',8,0,0,0,0,0,56,1,0,0,'Empresa - No. Interior',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(244,28,'Col:','colonia',160,20,'Arial',10,0,0,0,0,0,56,1,0,1,'Empresa - Colonia',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(389,23,'Ciudad - Empresa','ciudad',160,20,'Arial',10,0,0,0,0,0,56,1,0,0,'Empresa - Ciudad',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(297,29,'Estado - Empresa','estado',160,20,'Arial',10,0,0,0,0,0,56,1,0,0,'Empresa - Estado',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,72,'C.P:','cp',80,20,'Arial',10,0,0,0,0,0,56,1,0,1,'Empresa - CP',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(319,39,'RFC:','rfc',130,20,'Arial',10,0,0,0,0,0,56,1,0,1,'Empresa - RFC',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(379,28,'Tel:','tel',180,20,'Arial',10,0,0,0,0,0,56,1,0,1,'Empresa - Teléfono',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(239,56,'Email - Empresa','email',400,20,'Arial',10,0,0,0,0,0,56,1,0,0,'Empresa - Email',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(304,51,'Referencia - Empresa','referencia',200,20,'Lucida Console',8,0,0,0,0,0,56,1,0,0,'Empresa - Referencia',0,5);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(257,71,'Municipio empresa','municipio',136,20,'Arial',8,0,0,0,0,0,56,1,0,0,'Empresa - Municipio',0,5);





insert into tblactualizaciones(version) values('ver 9023 rev 1');

CREATE TABLE `tblInmueble` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idNotario` INTEGER UNSIGNED NOT NULL,
  `TipoInmueble` VARCHAR(2) NOT NULL,
  `Calle` VARCHAR(150) NOT NULL,
  `NoExterior` VARCHAR(55) NOT NULL,
  `NoInterior` VARCHAR(30) NOT NULL,
  `Colonia` VARCHAR(100) NOT NULL,
  `Localidad` VARCHAR(100) NOT NULL,
  `Referencia` VARCHAR(100) NOT NULL,
  `Municipio` VARCHAR(100) NOT NULL,
  `Estado` INTEGER UNSIGNED NOT NULL,
  `Pais` VARCHAR(3) NOT NULL,
  `CodigoPostal` VARCHAR(5) NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

ALTER TABLE `tblnotariospublicos` DROP COLUMN `TipoInmueble`,
 DROP COLUMN `Calle`,
 DROP COLUMN `NoExterior`,
 DROP COLUMN `NoInterior`,
 DROP COLUMN `Colonia`,
 DROP COLUMN `Localidad`,
 DROP COLUMN `Referencia`,
 DROP COLUMN `Municipio`,
 DROP COLUMN `Estado`,
 DROP COLUMN `Pais`,
 DROP COLUMN `CodigoPostal`;


CREATE TABLE `tblClientesIdenti` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idcliente` VARCHAR(45) NOT NULL,
  `identificacion` VARCHAR(45) NOT NULL,
  `numero` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;

ALTER TABLE `tblclientesidenti` MODIFY COLUMN `idcliente` INTEGER UNSIGNED NOT NULL,
 MODIFY COLUMN `identificacion` INTEGER UNSIGNED NOT NULL;

ALTER TABLE `tblclientes` DROP COLUMN `identificacion`,
 DROP COLUMN `numeroID`;

ALTER TABLE `tblopciones` ADD COLUMN `correocontenido` VARCHAR(2000) NOT NULL AFTER `emailssl`;



insert into tblactualizaciones(version) values('ver 9023 rev 2');

ALTER TABLE `tblnotariospublicos` ADD COLUMN `nombrenotario` VARCHAR(250) NOT NULL AFTER `idFactura`;

update tblopciones set correocontenido='Comprobante fiscal digital por internet enviado por medio del sistema de facturación de Pull System Soft, S.A. de C.V.\r\nhttp://pullsystemsoft.com';


insert into tblactualizaciones(version) values('ver 9023 rev 3');


ALTER TABLE `tblusuarios` ADD COLUMN `permisos11` BIGINT UNSIGNED NOT NULL AFTER `permisos10`,
 ADD COLUMN `permisos12` BIGINT UNSIGNED NOT NULL AFTER `permisos11`;

ALTER TABLE `tblventascotizaciones` ADD COLUMN `idmoneda` INTEGER UNSIGNED NOT NULL AFTER `comentario`;

update tblventascotizaciones set idmoneda=2;

insert into tblactualizaciones(version) values('ver 9023 rev 6');



ALTER TABLE `tblempeniosdetalles` ADD CONSTRAINT `FK_tblempeniosdetalles_1` FOREIGN KEY `FK_tblempeniosdetalles_1` (`idMovimiento`)
    REFERENCES `tblempenios` (`idmovimiento`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;

ALTER TABLE `tblgastosdetalles` ADD CONSTRAINT `FK_tblgastosdetalles_1` FOREIGN KEY `FK_tblgastosdetalles_1` (`idMovimiento`)
    REFERENCES `tblgastos` (`idmovimiento`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION;

ALTER TABLE `tblventasinventario` ADD COLUMN `predial` VARCHAR(45) NOT NULL AFTER `IVARetenido`;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,304,'Predial:','predial',100,20,'Lucida Console',8,0,0,1,0,0,0,1,0,0,'Artículos - Predial',1,4);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(21,304,'Predial:','predial',100,20,'Lucida Console',8,0,0,1,0,0,16,1,0,0,'Artículos - Predial',1,4);

ALTER TABLE `tblopciones` ADD COLUMN `mostrarpredial` TINYINT UNSIGNED NOT NULL AFTER `correocontenido`;

CREATE TABLE `tblgastosclasificacion2` (
  `idclasificacion` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(150) NOT NULL,
  `idclassuperior` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`idclasificacion`),
  CONSTRAINT `FK_tblgastosclasificacion2_1` FOREIGN KEY `FK_tblgastosclasificacion2_1` (`idclassuperior`)
    REFERENCES `tblgastosclasificacion` (`idClasificacion`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION
)
ENGINE = InnoDB;


ALTER TABLE `tblgastosdetalles` ADD COLUMN `idclasificacion2` INTEGER UNSIGNED NOT NULL AFTER `esSalario`;


insert into tblactualizaciones(version) values('ver 9023 rev 7');


ALTER TABLE `tblempeniosconfiguracion` ADD COLUMN `valorPlata` DOUBLE NOT NULL AFTER `aumentoPrenda`;

ALTER TABLE `tblempeniosconfiguracion` ADD COLUMN `aumentoPlata` DOUBLE NOT NULL AFTER `valorPlata`;

ALTER TABLE `tblempeniosdetalles` ADD COLUMN `tipo` INTEGER UNSIGNED NOT NULL AFTER `evaluo`;

CREATE TABLE `tblempeniosclasificacionV` (
  `idClasificacion` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idClasificacion`)
)
ENGINE = InnoDB;

ALTER TABLE `tblempenios` ADD COLUMN `tipoEmpenio` INTEGER UNSIGNED NOT NULL AFTER `Adjudicado`;

CREATE TABLE `tblempeniosdetallesv` (
  `idDetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idMovimiento` VARCHAR(45) NOT NULL,
  `clasificacion` INTEGER UNSIGNED NOT NULL,
  `marca` VARCHAR(45) NOT NULL,
  `modelo` VARCHAR(45) NOT NULL,
  `color` VARCHAR(45) NOT NULL,
  `noSerie` VARCHAR(45) NOT NULL,
  `placas` VARCHAR(45) NOT NULL,
  `evaluo` DOUBLE NOT NULL,
  `importe` DOUBLE NOT NULL,
  PRIMARY KEY (`idDetalle`)
);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(5,318,'Clasificación:','ArticuloClasificacionV',100,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Clasificacion',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(67,315,'Marca:','ArticuloMarca',150,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Marca',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(201,316,'Modelo:','ArticuloModelo',150,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Modelo',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(443,317,'Color:','ArticuloColor',120,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Color',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(548,317,'No. Serie:','ArticuloNoSerie',150,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - No. Serie',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(702,316,'Placas:','ArticuloPlacas',150,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Placas',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(114,315,'Descripción:','ArticuloDescripcionT',700,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Descripción Terreno',0,3);




ALTER TABLE `tblempeniosconfiguracion` ADD COLUMN `diasProrrogaV` DOUBLE NOT NULL AFTER `aumentoPlata`,
 ADD COLUMN `diasProrrogaT` DOUBLE NOT NULL AFTER `diasProrrogaV`,
 ADD COLUMN `interes1a15V` DOUBLE NOT NULL AFTER `diasProrrogaT`,
 ADD COLUMN `interes16a30V` DOUBLE NOT NULL AFTER `interes1a15V`,
 ADD COLUMN `interes31a60V` DOUBLE NOT NULL AFTER `interes16a30V`,
 ADD COLUMN `almacenaje1a15V` DOUBLE NOT NULL AFTER `interes31a60V`,
 ADD COLUMN `almacenaje16a30V` DOUBLE NOT NULL AFTER `almacenaje1a15V`,
 ADD COLUMN `almacenaje31a60V` DOUBLE NOT NULL AFTER `almacenaje16a30V`,
 ADD COLUMN `interes1a15T` DOUBLE NOT NULL AFTER `almacenaje31a60V`,
 ADD COLUMN `interes16a30T` DOUBLE NOT NULL AFTER `interes1a15T`,
 ADD COLUMN `interes31a60T` DOUBLE NOT NULL AFTER `interes16a30T`,
 ADD COLUMN `almacenaje1a15T` DOUBLE NOT NULL AFTER `interes31a60T`,
 ADD COLUMN `almacenaje16a30T` DOUBLE NOT NULL AFTER `almacenaje1a15T`,
 ADD COLUMN `almacenaje31a60T` DOUBLE NOT NULL AFTER `almacenaje16a30T`,
 ADD COLUMN `aumentoValorPrendaV` DOUBLE NOT NULL AFTER `almacenaje31a60V`,
 ADD COLUMN `aumentoValorPrendaT` DOUBLE NOT NULL AFTER `aumentoValorPrendaV`;


CREATE TABLE `tblempeniosdetallest` (
  `idDetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idMovimiento` INTEGER UNSIGNED NOT NULL,
  `descripcion` VARCHAR(400) NOT NULL,
  `evaluo` DOUBLE NOT NULL,
  `importe` DOUBLE NOT NULL,
  PRIMARY KEY (`idDetalle`)
)
ENGINE = InnoDB;

ALTER TABLE `tblempeniosdetallest` ADD COLUMN `clasificacion` INTEGER UNSIGNED NOT NULL AFTER `importe`;

CREATE TABLE `tblEmpeniosCompras` (
  `idmovimiento` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `fecha` VARCHAR(11) NOT NULL,
  `hora` VARCHAR(9) NOT NULL,
  `folio` INTEGER UNSIGNED NOT NULL,
  `serie` INTEGER UNSIGNED NOT NULL,
  `total` DOUBLE NOT NULL,
  `estado` INTEGER UNSIGNED NOT NULL,
  `comentario` VARCHAR(2000) NOT NULL,
  `idsucursal` INTEGER UNSIGNED NOT NULL,
  `idcaja` INTEGER UNSIGNED NOT NULL,
  `idvendedor` INTEGER UNSIGNED NOT NULL,
  `idcliente` INTEGER UNSIGNED NOT NULL,
  `idforma` INTEGER UNSIGNED NOT NULL,
  `tipo` INTEGER UNSIGNED NOT NULL,
  `tipoempenio` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`idmovimiento`)
)
ENGINE = InnoDB;

CREATE TABLE `tblempeniosGastosDetalles` (
  `idDetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idMovimiento` INTEGER UNSIGNED NOT NULL,
  `descripcion` VARCHAR(45) NOT NULL,
  `precio` DOUBLE NOT NULL,
  `clasificacion` INTEGER UNSIGNED NOT NULL,
  `kilates` INTEGER UNSIGNED NOT NULL,
  `peso` DOUBLE NOT NULL,
  `evaluo` DOUBLE NOT NULL,
  `tipo` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`idDetalle`)
)
ENGINE = InnoDB;

CREATE TABLE `tblempeniosComprasdetallesv` (
  `idDetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idMovimiento` VARCHAR(45) NOT NULL,
  `clasificacion` INTEGER UNSIGNED NOT NULL,
  `marca` VARCHAR(45) NOT NULL,
  `modelo` VARCHAR(45) NOT NULL,
  `color` VARCHAR(45) NOT NULL,
  `noSerie` VARCHAR(45) NOT NULL,
  `placas` VARCHAR(45) NOT NULL,
  `evaluo` DOUBLE NOT NULL,
  `importe` DOUBLE NOT NULL,
  PRIMARY KEY (`idDetalle`)
);

CREATE TABLE `tblempenioscomprasdetallest` (
  `idDetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idMovimiento` INTEGER UNSIGNED NOT NULL,
  `descripcion` VARCHAR(400) NOT NULL,
  `evaluo` DOUBLE NOT NULL,
  `importe` DOUBLE NOT NULL,
  PRIMARY KEY (`idDetalle`)
)
ENGINE = InnoDB;

ALTER TABLE `tblempenioscomprasdetallest` ADD COLUMN `clasificacion` INTEGER UNSIGNED NOT NULL AFTER `importe`;



insert into tblactualizaciones(version) values('ver 9023 rev 8');




insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(5,318,'Clasificación:','ArticuloClasificacionV',100,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Clasificacion',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(67,315,'Marca:','ArticuloMarca',150,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Marca',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(201,316,'Modelo:','ArticuloModelo',150,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Modelo',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(443,317,'Color:','ArticuloColor',120,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Color',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(548,317,'No. Serie:','ArticuloNoSerie',150,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - No. Serie',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(702,316,'Placas:','ArticuloPlacas',150,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Placas',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(114,315,'Descripción:','ArticuloDescripcionT',700,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Descripción Terreno',0,3);




insert into tblactualizaciones(version) values('ver 9023 rev 11');


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(5,318,'Descripcion:','ArticuloDescripcionCompleta',100,20,'Arial',10,0,0,1,0,1,40,1,0,0,'Artículo - Descripción Completa',0,3);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(5,318,'Descripcion:','ArticuloDescripcionCompleta',100,20,'Arial',10,0,0,1,0,1,56,1,0,0,'Artículo - Descripción Completa',0,3);

insert into tblactualizaciones(version) values('ver 9023 rev 12');

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,10,'Almacen:','almacen',500,20,'Arial',10,1,0,0,0,0,3,1,0,0,'Documento - Almacen',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(246,10,'Almacen:','almacen',500,20,'Arial',10,1,0,0,0,0,3,1,0,0,'Documento - Almacen',0,1);
insert into tblactualizaciones(version) values('ver 9023 rev 13');


ALTER TABLE `tblopciones` ADD COLUMN `clientesbloqcod` TINYINT UNSIGNED NOT NULL AFTER `mostrarpredial`,
 ADD COLUMN `clientesmayus` TINYINT UNSIGNED NOT NULL AFTER `clientesbloqcod`;

insert into tblactualizaciones(version) values('ver 9023 rev 15');



ALTER TABLE `tblopciones` ADD COLUMN `igualarfechas` TINYINT UNSIGNED NOT NULL AFTER `clientesmayus`;

insert into tblactualizaciones(version) values('ver 9023 rev 16');


ALTER TABLE `tblempenios` ADD COLUMN `renovado` INTEGER UNSIGNED NOT NULL AFTER `tipoEmpenio`;
ALTER TABLE `tblempeniosconfiguracion` ADD COLUMN `claveautorizacion` VARCHAR(45) NOT NULL AFTER `almacenaje31a60T`;


insert into tblactualizaciones(version) values('ver 9023 rev 18');


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Serie:','serie',100,20,'Arial',10,0,0,0,0,0,40,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(650,62,'Serie:','serie',100,20,'Arial',10,0,0,0,0,0,56,1,0,0,'Documento - Serie',0,1);

insert into tblactualizaciones(version) values('ver 9023 rev 22');


ALTER TABLE `tblopciones` ADD COLUMN `titulooriginalfactura` VARCHAR(45) NOT NULL AFTER `igualarfechas`,
 ADD COLUMN `titulocopiafactura` VARCHAR(45) NOT NULL AFTER `titulooriginalfactura`,
 ADD COLUMN `titulocopia2factura` VARCHAR(45) NOT NULL AFTER `titulocopiafactura`,
 ADD COLUMN `activarcopiafactura` TINYINT UNSIGNED NOT NULL AFTER `titulocopia2factura`,
 ADD COLUMN `activarcopia2factura` TINYINT UNSIGNED NOT NULL AFTER `activarcopiafactura`,
 ADD COLUMN `titulooriginalremision` VARCHAR(45) NOT NULL AFTER `activarcopia2factura`,
 ADD COLUMN `titulocopiaremision` VARCHAR(45) NOT NULL AFTER `titulooriginalremision`,
 ADD COLUMN `titulocopia2remision` VARCHAR(45) NOT NULL AFTER `titulocopiaremision`,
 ADD COLUMN `activarcopiaremision` TINYINT UNSIGNED NOT NULL AFTER `titulocopia2remision`,
 ADD COLUMN `activarcopia2remision` TINYINT UNSIGNED NOT NULL AFTER `activarcopiaremision`;


insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(15,54,'Título Copia:','titulocopia',300,20,'Lucida Console',8,0,0,0,0,0,0,1,0,0,'Documento - Título Copia',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(15,54,'Título Copia:','titulocopia',300,20,'Lucida Console',8,0,0,0,0,0,16,1,0,0,'Documento - Título Copia',0,0);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(15,54,'Título Copia:','titulocopia',300,20,'Lucida Console',8,0,0,0,0,0,3,1,0,0,'Documento - Título Copia',0,0);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(15,54,'Título Copia:','titulocopia',300,20,'Lucida Console',8,0,0,0,0,0,19,1,0,0,'Documento - Título Copia',0,0);

update tblformasdepago set nombre="NO APLICA" where idforma=1;
update tblformasdepago set nombre="NO APLICA" where idforma=2;



insert into tblactualizaciones(version) values('ver 9023 rev 24');

CREATE TABLE `tblinventariorelaciones` (
  `idrelacion` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `extra` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`idrelacion`)
)
ENGINE = InnoDB;


CREATE TABLE `tblinventariorelacionesdetalles` (
  `iddetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idrelacion` INTEGER UNSIGNED NOT NULL,
  `idinventario` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`iddetalle`),
  CONSTRAINT `FK_tblinventariorelacionesdetalles_1` FOREIGN KEY `FK_tblinventariorelacionesdetalles_1` (`idrelacion`)
    REFERENCES `tblinventariorelaciones` (`idrelacion`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_tblinventariorelacionesdetalles_2` FOREIGN KEY `FK_tblinventariorelacionesdetalles_2` (`idinventario`)
    REFERENCES `tblinventario` (`idinventario`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION
)
ENGINE = InnoDB;



insert into tblactualizaciones(version) values('ver 9023 rev 29');

ALTER TABLE `tblopciones` ADD COLUMN `nopermitirventacredito` TINYINT UNSIGNED NOT NULL AFTER `activarcopia2remision`,
 ADD COLUMN `nopermitirremisioncredito` TINYINT UNSIGNED NOT NULL AFTER `nopermitirventacredito`;

DELIMITER $$

DROP FUNCTION IF EXISTS `spanalisisinventariocc` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spanalisisinventariocc`(pfecha1 varchar(10),pfecha2 varchar(10),pidinventario int,pidsucursal int,pidalmacen int) RETURNS int(11)
BEGIN
declare varsumarem double;
declare varsumaremc double;
delete from tblinventarioanalisisc;

if pidsucursal<=0 then

if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.costoindirecto),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fechacancelado>=pfecha1 and tblmovimientos.fechacancelado<=pfecha2 group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idinventario=pidinventario;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;



end if;
else

if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.costoindirecto),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;



set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idinventario=pidinventario and tbldevoluciones.idsucursal=pidsucursal;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario and tbldevolucionescompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;



end if;

end if;


return 0;


END $$

DELIMITER ;


DELIMITER $$

DROP PROCEDURE IF EXISTS `spanalisisinventariob` $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `spanalisisinventariob`(pidinventario int,pfecha1 varchar(10),pfecha2 varchar(10),pidalmacen int,pidsucursal int,pfecha3 varchar(10))
BEGIN
delete from tblinventariomovimientosb;
if pidsucursal<=0 then
  if pidalmacen<=0 then
    if pidinventario<=1 then


insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblremsionesventas.estado=3 or tblremisionesventas.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventastemisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;


    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;

    end if;
  else

    if pidinventario=0 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventas on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblremision.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;

    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventasinventario.porsurtir=0),0),
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;

    end if;

  end if;
else
  if pidalmacen<=0 then
    if pidinventario<=1 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;

    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventas.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;


    end if;
  else

    if pidinventario<=1 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventas.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;


      else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidalmacen;

    end if;
  end if;
end if;



END $$

DELIMITER ;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(166,208,'Empresa','nombrefiscal2',650,20,'Arial',10,1,0,0,0,0,15,1,0,0,'Documento - Empresa 2',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(188,698,'Rep Fiscal','repcliente2',660,20,'Arial',10,1,0,0,0,0,15,1,0,0,'Cliente - Representante 2',0,3);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(166,208,'Empresa','nombrefiscal2',650,20,'Arial',10,1,0,0,0,0,31,1,0,0,'Documento - Empresa 2',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(188,698,'Rep Fiscal','repcliente2',660,20,'Arial',10,1,0,0,0,0,31,1,0,0,'Cliente - Representante 2',0,3);

ALTER TABLE `tblventaspagosremisiones` ADD COLUMN `iddevolucion` INTEGER UNSIGNED NOT NULL AFTER `tipo`;

insert into tblactualizaciones(version) values('ver 9024 rev 2');

DELIMITER $$

DROP PROCEDURE IF EXISTS `spanalisisinventariob` $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `spanalisisinventariob`(pidinventario int,pfecha1 varchar(10),pfecha2 varchar(10),pidalmacen int,pidsucursal int,pfecha3 varchar(10))
BEGIN
delete from tblinventariomovimientosb;
if pidsucursal<=0 then
  if pidalmacen<=0 then
    if pidinventario<=1 then


insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;


    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;

    end if;
  else

    if pidinventario=0 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventas on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblremision.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;

    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventasinventario.porsurtir=0),0),
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;

    end if;

  end if;
else
  if pidalmacen<=0 then
    if pidinventario<=1 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;

    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;


    end if;
  else

    if pidinventario<=1 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;


      else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidalmacen;

    end if;
  end if;
end if;



END $$

DELIMITER ;

insert into tblactualizaciones(version) values('ver 9024 rev 6');

ALTER TABLE `tblopciones` ADD COLUMN `tipoprorrateo` TINYINT UNSIGNED NOT NULL AFTER `nopermitirremisioncredito`;

ALTER TABLE `tblempeniosabono` ADD COLUMN `caja` INTEGER UNSIGNED NOT NULL AFTER `tipoPago`;
ALTER TABLE `tblempeniosabono` ADD COLUMN `idMovimiento` INTEGER UNSIGNED NOT NULL AFTER `caja`;

insert into tblactualizaciones(version) values('ver 9024 rev 7');

ALTER TABLE `tblsucursales` ADD COLUMN `idalmacenc` INTEGER UNSIGNED NOT NULL AFTER `curp`,
 ADD COLUMN `idalmacenm` INTEGER UNSIGNED NOT NULL AFTER `idalmacenc`;

update tblsucursales set idalmacenc=idalmacen,idalmacenm=idalmacen;

insert into tblactualizaciones(version) values('ver 9024 rev 8');

delete from tblimpresionesnodos where (datapropertyname='ieps' or datapropertyname='ivaRetenido') and (tipo=0 or tipo=2) and (documento=3 or documento=19);
update tblimpresionesnodos set nombre='Artículo - IEPS',clasificacion=4 where datapropertyname='ieps' and (documento=0 or documento=16 or documento=3 or documento=19);
update tblimpresionesnodos set nombre='Artículo - IVA Retenido',clasificacion=4 where datapropertyname='ivaRetenido' and (documento=0 or documento=16 or documento=3 or documento=19);
update tblimpresionesnodos set tipo=1 where datapropertyname='importe' and (documento=0 or documento=16 or documento=3 or documento=19);

update tblimpresionesnodos set tipo=1 where datapropertyname='descuentocant' and (documento=0 or documento=16 or documento=3 or documento=19);
update tblimpresionesnodos set tipo=1 where datapropertyname='preciosindesc' and (documento=0 or documento=16 or documento=3 or documento=19);
update tblimpresionesnodos set tipo=1 where datapropertyname='tipocantidad' and (documento=0 or documento=16 or documento=3 or documento=19);
update tblimpresionesnodos set tipo=1 where datapropertyname='clave' and (documento=0 or documento=16 or documento=3 or documento=19);
update tblimpresionesnodos set tipo=1 where datapropertyname='importe' and (documento=0 or documento=16 or documento=3 or documento=19);


insert into tblactualizaciones(version) values('ver 9024 rev 10');

DELIMITER $$

DROP FUNCTION IF EXISTS `spdasaldoafechaclientesrem` $$
CREATE FUNCTION `spdasaldoafechaclientesrem` (pidcliente int,pfecha varchar(10)) RETURNS double
BEGIN
declare vsaldo double;
set vsaldo=0;

set vsaldo=ifnull((select if(idmoneda=2,sum(totalapagar),sum(totalapagar*tipodecambio)) from tblventasremisiones inner join tblformasdepagoremisiones on tblventasremisiones.idforma=tblformasdepagoremisiones.idforma where tblformasdepagoremisiones.tipo=3 and idcliente=pidcliente and fecha<pfecha and estado=3),0);
set vsaldo=vsaldo-ifnull((select if(idmoneda=2,sum(cantidad),sum(cantidad*ptipodecambio)) from tblventaspagosremisiones where idcliente=pidcliente and tblventaspagosremisiones.estado=3 and tblventaspagosremisiones.fecha<pfecha),0);

return vsaldo;
END $$

DELIMITER ;

ALTER TABLE `tblopciones` ADD COLUMN `busquedaporclases` TINYINT UNSIGNED NOT NULL AFTER `tipoprorrateo`;

ALTER TABLE `tblopciones` ADD COLUMN `maximizarventas` TINYINT UNSIGNED NOT NULL AFTER `busquedaporclases`;

CREATE TABLE `tblCodigoBarras` (
  `ID` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `tipo` INTEGER UNSIGNED NOT NULL,
  `codigo` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`ID`)
)
ENGINE = InnoDB;


insert into tblactualizaciones(version) values('ver 9024 rev 11');


DELIMITER $$

DROP FUNCTION IF EXISTS `spanalisisinventariocc` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spanalisisinventariocc`(pfecha1 varchar(10),pfecha2 varchar(10),pidinventario int,pidsucursal int,pidalmacen int) RETURNS int(11)
BEGIN
declare varsumarem double;
declare varsumaremc double;
delete from tblinventarioanalisisc;

if pidsucursal<=0 then

if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.costoindirecto),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idinventario=pidinventario;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;



end if;
else

if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.costoindirecto),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;



set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idinventario=pidinventario and tbldevoluciones.idsucursal=pidsucursal;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario and tbldevolucionescompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;



end if;

end if;


return 0;


END $$

DELIMITER ;


CREATE TABLE `tblsucequipos` (
  `idequipo` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(100) NOT NULL,
  `marca` VARCHAR(45) NOT NULL,
  `modelo` VARCHAR(45) NOT NULL,
  `noserie` VARCHAR(45) NOT NULL,
  `nomotor` VARCHAR(45) NOT NULL,
  `matricula` VARCHAR(45) NOT NULL,
  `color` VARCHAR(20) NOT NULL,
  `kilometraje` DOUBLE NOT NULL,
  `idsucursal` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`idequipo`)
)
ENGINE = InnoDB;

CREATE TABLE `tbldetallesequiposS` (
  `idDetalle` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idEquipo` INTEGER UNSIGNED NOT NULL,
  `Cantidad` VARCHAR(5) NOT NULL,
  `idInventario` INTEGER UNSIGNED NOT NULL,
  `TiempoVida` VARCHAR(6) NOT NULL,
  `fecha` VARCHAR(15) NOT NULL,
  PRIMARY KEY (`idDetalle`)
)
ENGINE = InnoDB;

CREATE TABLE `tblserviciosSuc` (
  `idservicio` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `detalles` VARCHAR(1000) NOT NULL,
  `fechae` VARCHAR(10) NOT NULL,
  `horae` VARCHAR(5) NOT NULL,
  `fechas` VARCHAR(10) NOT NULL,
  `horas` VARCHAR(5) NOT NULL,
  `estado` VARCHAR(3) NOT NULL,
  `idsucursal` INTEGER UNSIGNED NOT NULL,
  `precio` DOUBLE NOT NULL,
  `Folio` INTEGER UNSIGNED NOT NULL,
  `cerrado` TINYINT UNSIGNED NOT NULL,
  `idEquipo` INTEGER UNSIGNED NOT NULL,
  `Serie` VARCHAR(5) NOT NULL,
  PRIMARY KEY (`idservicio`)
)
ENGINE = InnoDB;

CREATE TABLE `tblserviciosequipossuc` (
  `idservicioequipo` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idequipo` INTEGER UNSIGNED NOT NULL,
  `idservicio` INTEGER UNSIGNED NOT NULL,
  `idsucursal` INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY (`idservicioequipo`)
)
ENGINE = InnoDB;

CREATE TABLE `tblservicioseventossuc` (
  `idevento` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idservicio` INTEGER UNSIGNED NOT NULL,
  `idclasificacion` INTEGER UNSIGNED NOT NULL,
  `idclasificacion2` INTEGER UNSIGNED NOT NULL,
  `comentario` VARCHAR(100) NOT NULL,
  `tiempo` DOUBLE NOT NULL,
  `precio` DOUBLE NOT NULL,
  `idtecnico` INTEGER UNSIGNED NOT NULL,
  `idequipo` INTEGER UNSIGNED NOT NULL,
  `fecha` VARCHAR(11) NOT NULL,
  `iva` DOUBLE NOT NULL,
  PRIMARY KEY (`idevento`)
)
ENGINE = InnoDB;

CREATE TABLE `tblserviciosinventario2suc` (
  `idserviciosinventario` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `idevento` INTEGER UNSIGNED NOT NULL,
  `idinventario` INTEGER UNSIGNED NOT NULL,
  `precio` DOUBLE NOT NULL,
  `cantidad` INTEGER UNSIGNED NOT NULL,
  `Total` DOUBLE NOT NULL,
  `idEquipo` INTEGER UNSIGNED NOT NULL,
  `fecha` VARCHAR(11) NOT NULL,
  PRIMARY KEY (`idserviciosinventario`)
)
ENGINE = InnoDB;




insert into tblactualizaciones(version) values('ver 9024 rev 14');

ALTER TABLE `tbldevolucionescompras` ADD COLUMN `serie` VARCHAR(10) NOT NULL AFTER `comentario`,
 ADD COLUMN `folioi` INTEGER UNSIGNED NOT NULL AFTER `serie`;

ALTER TABLE `tbldevolucionescompras` ADD COLUMN `uuid` VARCHAR(45) NOT NULL AFTER `folioi`;

update tbldevolucionescompras set folioi=iddevolucion;

ALTER TABLE `tblcompras` ADD COLUMN `foliocfdi` VARCHAR(45) NOT NULL AFTER `deremision`;

ALTER TABLE `tblnotasdecargocompras` ADD COLUMN `serie` VARCHAR(10) NOT NULL AFTER `comentario`,
 ADD COLUMN `folioi` INTEGER UNSIGNED NOT NULL AFTER `serie`,
 ADD COLUMN `foliocfdi` VARCHAR(45) NOT NULL AFTER `folioi`;

update tblnotasdecargocompras set folioi=idcargo;

ALTER TABLE `tblnotasdecreditocompras` ADD COLUMN `serie` VARCHAR(10) NOT NULL AFTER `comentarionc`,
 ADD COLUMN `folioi` INTEGER UNSIGNED NOT NULL AFTER `serie`,
 ADD COLUMN `foliocfdi` VARCHAR(45) NOT NULL AFTER `folioi`;

update tblnotasdecreditocompras set folioi=idnota;

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,7,1,0,0,'Documento - Folio CFDI',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,7+16,1,0,0,'Documento - Folio CFDI',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie:','serie',50,20,'Arial',10,0,0,0,0,0,11,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Referencia:','referencia',50,20,'Arial',10,0,0,0,0,0,11,1,0,0,'Documento - Referencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie:','serie',50,20,'Arial',10,0,0,0,0,0,11+16,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Referencia:','referencia',50,20,'Arial',10,0,0,0,0,1,11+16,1,0,0,'Documento - Referencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,11,1,0,0,'Documento - Folio CFDI',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,11+16,1,0,0,'Documento - Folio CFDI',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie:','serie',50,20,'Arial',10,0,0,0,0,0,12,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Referencia:','referencia',50,20,'Arial',10,0,0,0,0,0,12,1,0,0,'Documento - Referencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie:','serie',50,20,'Arial',10,0,0,0,0,0,12+16,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Referencia:','referencia',50,20,'Arial',10,0,0,0,0,1,12+16,1,0,0,'Documento - Referencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,12,1,0,0,'Documento - Folio CFDI',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,12+16,1,0,0,'Documento - Folio CFDI',0,1);

insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie:','serie',50,20,'Arial',10,0,0,0,0,0,13,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Referencia:','referencia',50,20,'Arial',10,0,0,0,0,0,13,1,0,0,'Documento - Referencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Serie:','serie',50,20,'Arial',10,0,0,0,0,0,13+16,1,0,0,'Documento - Serie',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Referencia:','referencia',50,20,'Arial',10,0,0,0,0,1,13+16,1,0,0,'Documento - Referencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,13,1,0,0,'Documento - Folio CFDI',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Folio CFDI:','foliocfdi',50,20,'Arial',10,0,0,0,0,0,13+16,1,0,0,'Documento - Folio CFDI',0,1);

update tblimpresionesnodos set datapropertyname='iva' where datapropertyname='docIva';

delete from tblimpresionesnodos where datapropertyname='referencia' and documento=10;
delete from tblimpresionesnodos where datapropertyname='referencia' and documento=26;
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Ref:','referencia',100,20,'Arial',10,0,0,0,0,0,10,1,0,0,'Documento - Refencia',0,1);
insert into tblimpresionesnodos(x,y,texto,datapropertyname,xl,yl,fuente,fuentesize,fuentestilo,alineacion,tipo,tipodato,visible,documento,idsucursal,tiponodo,conetiqueta,nombre,renglon,clasificacion) values(608,62,'Ref:','referencia',100,20,'Arial',10,0,0,0,0,0,26,1,0,0,'Documento - Refencia',0,1);

ALTER TABLE `tblcodigobarras` ADD COLUMN `idInventario` INTEGER UNSIGNED NOT NULL AFTER `codigo`;
ALTER TABLE `tblserviciosestados` ADD COLUMN `final` BOOLEAN NOT NULL AFTER `estado`;
ALTER TABLE `tblserviciosestados` MODIFY COLUMN `final` INTEGER UNSIGNED NOT NULL;

DELIMITER $$

DROP PROCEDURE IF EXISTS `spanalisisinventariob` $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `spanalisisinventariob`(pidinventario int,pfecha1 varchar(10),pfecha2 varchar(10),pidalmacen int,pidsucursal int,pfecha3 varchar(10))
BEGIN
delete from tblinventariomovimientosb;
if pidsucursal<=0 then
  if pidalmacen<=0 then
    if pidinventario<=1 then


insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),


ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),

0
 from tblinventario where tblinventario.idinventario>1;


    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;

    end if;
  else

    if pidinventario=0 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventas on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblremision.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;

    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventasinventario.porsurtir=0),0),
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;

    end if;

  end if;
else
  if pidalmacen<=0 then
    if pidinventario<=1 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),



ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal) ,0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),


0
 from tblinventario where tblinventario.idinventario>1;

    else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidinventario;


    end if;
  else

    if pidinventario<=1 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario>1;


      else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha3,pidalmacen,pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idalmacen=pidalmacen),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idalmacen=pidalmacen and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisionesinventario.idalmacen=pidalmacen and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idalmacen=pidalmacen),0),
ifnull(spdainventarioafecha(tblinventario.idinventario,pfecha1,pidalmacen,pidsucursal),0),
0
 from tblinventario where tblinventario.idinventario=pidalmacen;

    end if;
  end if;
end if;



END $$

DELIMITER ;

DELIMITER $$

DROP FUNCTION IF EXISTS `spanalisisinventarioc` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spanalisisinventarioc`(pfecha1 varchar(10),pfecha2 varchar(10),pidinventario int,pidsucursal int,pidalmacen int) RETURNS int(11)
BEGIN

delete from tblinventarioanalisisc;

if pidsucursal<=0 then
if pidalmacen <=0 then
if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.precio),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=3 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcompras.costoindirecto),0),ifnull(sum(tblcompras.costoindirecto),0),1 from tblcompras  where tblcompras.estado=3 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.precio),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0),ifnull(sum(tblventasinventario.precio),0),3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventas.estado=4 and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.precio),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0),ifnull(sum(tblventasinventario.precio),0),0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventas.estado=3 and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(tbldevolucionesdetallesc.precio),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.precio),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.precio),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.precio),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=3 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where tblcompras.estado=3 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.precio),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tblventasdevolucionesdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0),ifnull(sum(tblventasinventario.precio),0),3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventas.estado=4 and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.precio),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0),ifnull(sum(tblventasinventario.precio),0),0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventas.estado=3 and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(tbldevolucionesdetallesc.precio),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.precio),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.precio),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;

end if;
end if;
end if;


return 0;


END $$

DELIMITER ;

DELIMITER $$

DROP FUNCTION IF EXISTS `spanalisisinventariocc` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spanalisisinventariocc`(pfecha1 varchar(10),pfecha2 varchar(10),pidinventario int,pidsucursal int,pidalmacen int) RETURNS int(11)
BEGIN
declare varsumarem double;
declare varsumaremc double;
delete from tblinventarioanalisisc;

if pidsucursal<=0 then

if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.costoindirecto),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idinventario=pidinventario;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario group by tblinventarioconceptos.idconcepto;



end if;
else

if pidinventario<=0 then


insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.costoindirecto),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;



set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;

else



insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)),0),0 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblcompras.idcompra,0,'Gastos s/compra',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(tblcomprasdetalles.costoindirecto),0),1 from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra where (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Devoluciones Ventas',ifnull(sum(tbldevolucionesdetalles.cantidad),0),ifnull(sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)),0),2 from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion inner join tblinventario on tbldevolucionesdetalles.idinventario=tblinventario.idinventario where tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevolucionesdetalles.idinventario=pidinventario and tbldevoluciones.idsucursal=pidsucursal;

set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,0,'Cancelaciones Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,3 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,0,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)),0),4 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;


set varsumarem=ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
set varsumaremc=ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision inner join tblinventario on tblventasremisionesinventario.idinventario=tblinventario.idinventario where (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0 and tblventasremisionesinventario.idinventario=pidinventario and tblventasremisiones.idsucursal=pidsucursal),0);
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Ventas',ifnull(sum(tblventasinventario.cantidad),0)+varsumarem,ifnull(sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)),0)+varsumaremc,0 from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa inner join tblinventario on tblventasinventario.idinventario=tblinventario.idinventario where (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventasinventario.idinventario=pidinventario and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Devoluciones Compras',ifnull(sum(tbldevolucionesdetallesc.cantidad),0),ifnull(sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)),0),1 from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionesdetallesc.idinventario=pidinventario and tbldevolucionescompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select 0,1,'Cancelaciones Compras',ifnull(sum(tblcomprasdetalles.cantidad),0),ifnull(sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio),tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio*tblcompras.tipodecambio))),0),2 from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcomprasdetalles.idinventario=pidinventario and tblcompras.idsucursal=pidsucursal;
insert into tblinventarioanalisisc(idinventario,tipo,concepto,cantidad,precio,orden)
select tblinventarioconceptos.idconcepto,1,tblinventarioconceptos.nombre,ifnull(sum(tblmovimientosdetalles.cantidad),0),ifnull(sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)),0),3 from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblinventario on tblmovimientosdetalles.idinventario=tblinventario.idinventario where tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientosdetalles.idinventario=pidinventario and tblmovimientos.idsucursal=pidsucursal group by tblinventarioconceptos.idconcepto;



end if;

end if;


return 0;


END $$

DELIMITER ;

DELIMITER $$

DROP PROCEDURE IF EXISTS `spanalisisinventarioclases` $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `spanalisisinventarioclases`(pidinventario int,pfecha1 varchar(10),pfecha2 varchar(10),pidalmacen int,pidsucursal int,pfecha3 varchar(10),pidclase1 int,pidclase2 int,pidclase3 int)
BEGIN
delete from tblinventariomovimientosb;
if pidsucursal<=0 then

if pidclase3>0 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),


ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),

0
 from tblinventario where tblinventario.idinventario>1 and tblinventario.idclasificacion3=pidclase3;

else
 if pidclase2>0 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),


ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),

0
 from tblinventario where tblinventario.idinventario>1 and tblinventario.idclasificacion2=pidclase2;

else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fechacancelado>=pfecha1 and tblcompras.fechacancelado<=pfecha2),0),


ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4)
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4)),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4)),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4)),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0),0)

),0),

0
 from tblinventario where tblinventario.idinventario>1 and tblinventario.idclasificacion=pidclase1;

end if;

end if;

else
if pidclase3>0 then

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),



ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal) ,0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),


0
 from tblinventario where tblinventario.idinventario>1 and tblinventario.idclasificacion3=pidclase3;

else
 if pidclase2>0 then

 insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),



ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal) ,0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),


0
 from tblinventario where tblinventario.idinventario>1 and tblinventario.idclasificacion2=pidclase2;

 else

insert into tblinventariomovimientosb(idinventario,compras,comprasdev,ventas,ventasdev,entradas,salidas,ajustes,costo,cantidad,costocompras,costocomprasd,costomoventradas,costodev,costomovsalidas,costoinicial,costofinal,ventascancelacion,costoventacancelacion,comprascancelacion,costocomprascancelacion,inventarioinicial,costoinicialb)
select tblinventario.idinventario,
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetallesc.cantidad) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
0,
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fecha order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and (tblventas.estado=3 or tblventas.estado=4) and tblventas.fecha>=pfecha1 and tblventas.fecha<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fecha order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.fecha>=pfecha1 and tblventasremisiones.fecha<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha3 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha3 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha3 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha3 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha3 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha3 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha3 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha3 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha3 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha3 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha3 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal),0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha3 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha3 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha3 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha3 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),



ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tbldevolucionesdetallesc.idmoneda=2,tbldevolucionesdetallesc.precio,tbldevolucionesdetallesc.precio*tbldevolucionescompras.tipodecambio)) from tbldevolucionesdetallesc inner join tbldevolucionescompras on tbldevolucionesdetallesc.iddevolucion=tbldevolucionescompras.iddevolucion where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.estado=3 and tbldevolucionescompras.fecha>=pfecha1 and tbldevolucionescompras.fecha<=pfecha2 and tbldevolucionescompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and (tblinventarioconceptos.tipo=0 or tblinventarioconceptos.tipo=4) and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select sum(tbldevolucionesdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tbldevolucionesdetalles.idinventario and fecha<=tbldevoluciones.fecha order by fecha desc limit 1)) from tbldevolucionesdetalles inner join tbldevoluciones on tbldevolucionesdetalles.iddevolucion=tbldevoluciones.iddevolucion where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.estado=3 and tbldevoluciones.fecha>=pfecha1 and tbldevoluciones.fecha<=pfecha2 and tbldevoluciones.idsucursal=pidsucursal),0),
ifnull((select sum(tblmovimientosdetalles.cantidad*(select costo from tblinventariocostoh where idinventario=tblmovimientosdetalles.idinventario and fecha<=tblmovimientos.fecha order by fecha desc limit 1)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.estado=3 and tblmovimientos.fecha>=pfecha1 and tblmovimientos.fecha<=pfecha2 and tblmovimientos.idsucursal=pidsucursal),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<pfecha1 order by fecha desc limit 1),0),
ifnull((select costo from tblinventariocostoh where idinventario=tblinventario.idinventario and fecha<=pfecha2 order by fecha desc limit 1),0),
ifnull((select sum(tblventasinventario.cantidad) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblventasinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasinventario.idinventario and fecha<=tblventas.fechacancelado order by fecha desc limit 1)) from tblventasinventario inner join tblventas on tblventasinventario.idventa=tblventas.idventa where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.estado=4 and tblventas.fechacancelado>=pfecha1 and tblventas.fechacancelado<=pfecha2 and tblventas.idsucursal=pidsucursal and tblventas.porsurtir=0),0)+
ifnull((select sum(tblventasremisionesinventario.cantidad*(select costo from tblinventariocostoh where idinventario=tblventasremisionesinventario.idinventario and fecha<=tblventasremisiones.fechacancelado order by fecha desc limit 1)) from tblventasremisionesinventario inner join tblventasremisiones on tblventasremisionesinventario.idremision=tblventasremisiones.idremision where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.estado=4 and tblventasremisiones.fechacancelado>=pfecha1 and tblventasremisiones.fechacancelado<=pfecha2 and tblventasremisiones.idsucursal=pidsucursal and tblventasremisiones.porsurtir=0 and tblventasremisiones.idventar=0),0),
ifnull((select sum(tblcomprasdetalles.cantidad) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),
ifnull((select sum(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio,tblcomprasdetalles.costoindirecto+tblcomprasdetalles.precio*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.estado=4 and tblcompras.fecha>=pfecha1 and tblcompras.fecha<=pfecha2 and tblcompras.idsucursal=pidsucursal),0),

ifnull((
ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)


+ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fecha<pfecha1 and (tblcompras.estado=3 or tblcompras.estado=4) and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

-ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fecha<pfecha1 and (tbldevolucionescompras.estado=3 or tbldevolucionescompras.estado=4) and tbldevolucionescompras.idsucursal=pidsucursal),0)

+ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fecha<pfecha1 and (tblcomprasremisiones.estado=3 or tblcomprasremisiones.estado=4) and tblcomprasremisiones.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fecha<pfecha1 and (tblventas.estado=3 or tblventas.estado=4) and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fecha<pfecha1 and (tbldevoluciones.estado=3 or tbldevoluciones.estado=4) and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fecha<pfecha1 and (tblventasremisiones.estado=3 or tblventasremisiones.estado=4) and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fecha<pfecha1 and (tblmovimientos.estado=3 or tblmovimientos.estado=4) and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblventasapartadosdetalles.cantidad)
from tblventasapartados inner join tblventasapartadosdetalles on tblventasapartados.idapartado=tblventasapartadosdetalles.idapartado
where tblventasapartadosdetalles.idinventario=tblinventario.idinventario and tblventasapartados.fecha<pfecha1 and tblventasapartados.estado=3 and tblventasapartados.dinventario=1 and tblventasapartados.surtido=0 and tblventasapartados.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=4 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=1 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblmovimientosdetalles.cantidad)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto inner join tblalmacenes on tblalmacenes.idalmacen=tblmovimientosdetalles.idalmacen2 and tblalmacenes.idsucursal=tblmovimientos.idsucursal
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=3 and tblmovimientos.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasdetalles.cantidad)
from tblcompras inner join tblcomprasdetalles on tblcompras.idcompra=tblcomprasdetalles.idcompra
where tblcomprasdetalles.idinventario=tblinventario.idinventario and tblcompras.fechacancelado<pfecha1 and tblcompras.estado=4 and tblcompras.idsucursal=pidsucursal
and tblcompras.deremision=0),0)

+ifnull((select sum(tbldevolucionesdetallesc.cantidad)
from tbldevolucionescompras inner join tbldevolucionesdetallesc on tbldevolucionescompras.iddevolucion=tbldevolucionesdetallesc.iddevolucion
where tbldevolucionesdetallesc.idinventario=tblinventario.idinventario and tbldevolucionescompras.fechacancelado<pfecha1 and tbldevolucionescompras.estado=4 and tbldevolucionescompras.idsucursal=pidsucursal),0)

-ifnull((select sum(tblcomprasremisionesdetalles.cantidad)
from tblcomprasremisiones inner join tblcomprasremisionesdetalles on tblcomprasremisiones.idremision=tblcomprasremisionesdetalles.idremision
where tblcomprasremisionesdetalles.idinventario=tblinventario.idinventario and tblcomprasremisiones.fechacancelado<pfecha1 and tblcomprasremisiones.estado=4 and tblcomprasremisiones.idsucursal=pidsucursal) ,0)

+ifnull((select sum(tblventasinventario.cantidad)
from tblventas inner join tblventasinventario on tblventas.idventa=tblventasinventario.idventa
where tblventasinventario.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

+ifnull((select sum(tblventaskits.cantidad)
from tblventas inner join tblventaskits on tblventas.idventa=tblventaskits.idventa
where tblventaskits.idinventario=tblinventario.idinventario and tblventas.fechacancelado<pfecha1 and tblventas.estado=4 and tblventas.porsurtir=0 and tblventas.idsucursal=pidsucursal
and tblventas.deremision=0),0)/tblinventario.contenido

-ifnull((select sum(tbldevolucionesdetalles.cantidad)
from tbldevoluciones inner join tbldevolucionesdetalles on tbldevoluciones.iddevolucion=tbldevolucionesdetalles.iddevolucion
where tbldevolucionesdetalles.idinventario=tblinventario.idinventario and tbldevoluciones.fechacancelado<pfecha1 and tbldevoluciones.estado=4 and tbldevoluciones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventasremisionesinventario.cantidad)
from tblventasremisiones inner join tblventasremisionesinventario on tblventasremisiones.idremision=tblventasremisionesinventario.idremision
where tblventasremisionesinventario.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

+ifnull((select sum(tblventaskitsr.cantidad)
from tblventasremisiones inner join tblventaskitsr on tblventasremisiones.idremision=tblventaskitsr.idremision
where tblventaskitsr.idinventario=tblinventario.idinventario and tblventasremisiones.fechacancelado<pfecha1 and tblventasremisiones.estado=4 and tblventasremisiones.porsurtir=0 and tblventasremisiones.idsucursal=pidsucursal),0)/tblinventario.contenido

-ifnull((select sum(tblmovimientosdetalles.inventarioanterior)*-1
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior<=0 and tblmovimientos.idsucursal=pidsucursal),0)

+ifnull((select sum(tblmovimientosdetalles.inventarioanterior)
from tblmovimientos inner join tblmovimientosdetalles on tblmovimientos.idmovimiento=tblmovimientosdetalles.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto
where tblmovimientos.fechacancelado<pfecha1 and tblmovimientos.estado=4 and tblmovimientosdetalles.idinventario=tblinventario.idinventario and tblinventarioconceptos.tipo=2 and tblmovimientosdetalles.inventarioanterior>0 and tblmovimientos.idsucursal=pidsucursal),0)

),0),


0
 from tblinventario where tblinventario.idinventario>1 and tblinventario.idclasificacion=pidclase1;

 end if;
end if;
end if;



END $$

DELIMITER ;



insert into tblactualizaciones(version) values('ver 9025 rev 3');


ALTER TABLE `tblservicios` ADD COLUMN `Serie` VARCHAR(5) NOT NULL AFTER `idequipo`;


ALTER TABLE `tblopciones` ADD COLUMN `activarcopiafacturacre` TINYINT UNSIGNED NOT NULL AFTER `maximizarventas`,
 ADD COLUMN `activarcopiafacturacre2` TINYINT UNSIGNED NOT NULL AFTER `activarcopiafacturacre`,
 ADD COLUMN `activarcopiaremisioncre` TINYINT UNSIGNED NOT NULL AFTER `activarcopiafacturacre2`,
 ADD COLUMN `activarcopiaremisioncre2` TINYINT UNSIGNED NOT NULL AFTER `activarcopiaremisioncre`;

ALTER TABLE `tblopciones` ADD COLUMN `pagosticket` TINYINT UNSIGNED NOT NULL AFTER `activarcopiaremisioncre2`;

ALTER TABLE `tblventasremisiones` MODIFY COLUMN `credito` DOUBLE NOT NULL;

ALTER TABLE `tblinventarioprecios` ADD COLUMN `descuentoprecio` SMALLINT UNSIGNED NOT NULL AFTER `utilidad`;

ALTER TABLE `tblinventariopreciostemp` MODIFY COLUMN `utilidad` SMALLINT UNSIGNED NOT NULL,
 ADD COLUMN `descuentoprecio` SMALLINT UNSIGNED NOT NULL AFTER `utilidad`;


DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafecha` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafecha`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN
declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare vtipodecambio double;
declare vmetodo varchar(2);
declare P1 double;
if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
 insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  set vcosto=0;

  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);

    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;
  end while;

else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;

set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventariopreciosidmoneda<>2;


/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

end if;


set p1=ifnull((select precio from tblinventarioprecios where idlista=1 and idinventario=pidinventario limit 1),0);
update tblinventarioprecios set precio=p1-(p1*descuentoprecio/100) where idlista>1 and descuentoprecio<>0 and idinventario=pidinventario;


return ifnull(vcosto,0);
END $$

DELIMITER ;


DELIMITER $$

DROP FUNCTION IF EXISTS `spsacacostoarticuloafechaa` $$
CREATE DEFINER=`root`@`localhost` FUNCTION `spsacacostoarticuloafechaa`(pidinventario int,pfecha1 varchar(10),ptipocosteo tinyint) RETURNS double
BEGIN

declare c int;
declare minimo int;
declare maximo int;
declare vcantidad double;
declare vprecio double;
declare vcosto double;
declare vcosto2 double;
declare vcosto3 double;
declare vinvfinal double;
declare varfechamax varchar(10);
declare varinvant double;
declare varidmax int;
declare vtipodecambio double;
declare vmetodo varchar(2);
declare p1 double;
if ptipocosteo=0 then

  delete from tblinventariosacacostos where idinventario=pidinventario;
  delete from tblinventariosacacostosm where idinventario=pidinventario;
  delete from tblinventariosacacostosr where idinventario=pidinventario;
  delete from tblinventariosacacostosf where idinventario=pidinventario;
  delete from tblinventariosacacostosf2 where idinventario=pidinventario;

  insert into tblinventariosacacostos(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasdetalles.cantidad),sum(tblcomprasdetalles.costoindirecto+(if(tblcomprasdetalles.idmoneda=2,tblcomprasdetalles.precio,tblcomprasdetalles.precio*tblcompras.tipodecambio)))  from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha=pfecha1 and tblcomprasdetalles.idinventario=pidinventario group by fecha,idinventario;
  insert into tblinventariosacacostosr(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblcomprasremisionesdetalles.cantidad),sum(if(tblcomprasremisionesdetalles.idmoneda=2,tblcomprasremisionesdetalles.precio,tblcomprasremisionesdetalles.precio*tblcomprasremisiones.tipodecambio))  from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where tblcomprasremisiones.estado=3 and  tblcomprasremisiones.fecha=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisiones.usado=0 group by fecha,idinventario;
  insert into tblinventariosacacostosm(idinventario,fecha,cantidad,precio) select idinventario,fecha,sum(tblmovimientosdetalles.cantidad),sum(if(tblmovimientosdetalles.idmoneda=2,tblmovimientosdetalles.precio,tblmovimientosdetalles.precio*tblmovimientos.tipodecambio))  from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha=pfecha1 and idinventario=pidinventario group by fecha,idinventario;


  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostos.idinventario,tblinventariosacacostos.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos left outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostos.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostos.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostos.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostos right outer join tblinventariosacacostosm on tblinventariosacacostos.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostos.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosr.idinventario,tblinventariosacacostosr.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr left outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosr.idinventario=pidinventario;
  insert into tblinventariosacacostosf(idinventario,fecha,cantidad,precio) select tblinventariosacacostosm.idinventario,tblinventariosacacostosm.fecha,ifnull(tblinventariosacacostosr.cantidad,0)+ifnull(tblinventariosacacostosm.cantidad,0),ifnull(tblinventariosacacostosr.precio,0)+ifnull(tblinventariosacacostosm.precio,0) from tblinventariosacacostosr right outer join tblinventariosacacostosm on tblinventariosacacostosr.idinventario=tblinventariosacacostosm.idinventario and tblinventariosacacostosr.fecha=tblinventariosacacostosm.fecha where tblinventariosacacostosm.idinventario=pidinventario;
  insert into tblinventariosacacostosf2(idinventario,fecha,cantidad,precio,invfinal) select idinventario,fecha,cantidad,precio,spdainventarioafecha(idinventario,f2.fecha,0,0)
   from tblinventariosacacostosf as f2 where f2.idinventario=pidinventario group by f2.fecha order by f2.fecha;

  set minimo=ifnull((select min(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set maximo=ifnull((select max(id) from tblinventariosacacostosf2 where idinventario=pidinventario),0);
  set c=minimo;
  
  
  set varfechamax=ifnull((select max(fecha) from tblinventariocostohex where fecha<pfecha1),'1900/01/01');
  
  set vcosto=ifnull((select costo from tblinventariocostohex where fecha=varfechamax limit 1),0);
  
  while c<=maximo do

    set vcantidad=(select cantidad from tblinventariosacacostosf2 where id=c);
    set vprecio=(select precio from tblinventariosacacostosf2 where id=c);
    set vinvfinal=(select invfinal from tblinventariosacacostosf2 where id=c);
    if vcantidad+vinvfinal>0 then
      set vcosto=(vprecio+(vinvfinal*vcosto))/(vcantidad+vinvfinal);
    else
      set vcosto=0;
    end if;

    set c=c+1;

  end while;

    insert into tblinventariocostohex(idinventario,fecha,costo) values(pidinventario,pfecha1,vcosto);
else

set vcosto=ifnull((select if(tblcomprasdetalles.idmoneda=2,max(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad+tblcomprasdetalles.costoindirecto),max(tblcomprasdetalles.costoindirecto+(tblcomprasdetalles.precio/tblcomprasdetalles.cantidad)*tblcompras.tipodecambio)) from tblcomprasdetalles inner join tblcompras on tblcomprasdetalles.idcompra=tblcompras.idcompra where (tblcompras.estado=3) and  tblcompras.fecha<=pfecha1 and tblcomprasdetalles.idinventario=pidinventario and tblcomprasdetalles.cantidad<>0),0);
set vcosto3=ifnull((select if(tblcomprasremisionesdetalles.idmoneda=2,max(tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad),max((tblcomprasremisionesdetalles.precio/tblcomprasremisionesdetalles.cantidad)*tblcomprasremisiones.tipodecambio)) from tblcomprasremisionesdetalles inner join tblcomprasremisiones on tblcomprasremisionesdetalles.idremision=tblcomprasremisiones.idremision where (tblcomprasremisiones.estado=3) and  tblcomprasremisiones.fecha<=pfecha1 and tblcomprasremisionesdetalles.idinventario=pidinventario and tblcomprasremisionesdetalles.cantidad<>0 and tblcomprasremisiones.usado=0),0);
set vcosto2=ifnull((select if(tblmovimientosdetalles.idmoneda=2,max(tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad),max((tblmovimientosdetalles.precio/tblmovimientosdetalles.cantidad)*tblmovimientos.tipodecambio)) from tblmovimientosdetalles inner join tblmovimientos on tblmovimientosdetalles.idmovimiento=tblmovimientos.idmovimiento inner join tblinventarioconceptos on tblmovimientos.idconcepto=tblinventarioconceptos.idconcepto where (tipo=0 or tipo=4) and estado=3 and  fecha<=pfecha1 and idinventario=pidinventario and tblmovimientosdetalles.cantidad<>0),0);
if vcosto2>vcosto then
set vcosto=vcosto2;
end if;
if vcosto3>vcosto then
set vcosto=vcosto3;
end if;

end if;


set vtipodecambio=ifnull((select cantidad from tblmonedasconversiones limit 1),1);
set vmetodo=ifnull((select referenciadomiciliolocal from tblopciones limit 1),'0');

if vmetodo='0' then
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto*(1+tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventarioprecios.utilidad/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

else

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda=2;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto/(1-tblinventarioprecios.utilidad/100))/vtipodecambio
where tblinventarioprecios.idinventario=pidinventario and tblinventarioprecios.utilidad<>0 and tblinventarioprecios.idmoneda<>2;
/*
update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(vcosto*(1+tblinventario.iva/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0;
*/

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=vcosto/(1-tblinventarioprecios.utilidad/100)
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

update tblinventarioprecios inner join tblinventario on tblinventarioprecios.idinventario=tblinventario.idinventario
set tblinventarioprecios.precio=(precio*(1+(tblinventario.iva+tblinventario.ieps-tblinventario.ivaretenido)/100))
where tblinventarioprecios.idinventario=pidinventario and tblinventario.iva<>0 and tblinventario.precioneto<>0 and tblinventarioprecios.utilidad<>0;

end if;

set p1=ifnull((select precio from tblinventarioprecios where idlista=1 and idinventario=pidinventario limit 1),0);
update tblinventarioprecios set precio=p1-(p1*descuentoprecio/100) where idlista>1 and descuentoprecio<>0 and idinventario=pidinventario;


return ifnull(vcosto,0);


END $$

DELIMITER ;


insert into tblactualizaciones(version) values('ver 9025 rev 5');

ALTER TABLE `tblclientes` MODIFY COLUMN `zona` INTEGER UNSIGNED NOT NULL,
 MODIFY COLUMN `zona2` INTEGER UNSIGNED NOT NULL;

DELIMITER $$

DROP FUNCTION IF EXISTS `spdapreciolistauno` $$
CREATE FUNCTION `spdapreciolistauno` (pidinventario int) RETURNS INT
BEGIN
return ifnull((select precio from tblinventarioprecios where idlista=1 and idinventario=pidinventario limit 1),0);
END $$

DELIMITER ;


CREATE TABLE `tblAgrupadorCuentas` (
  `id` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  `codigo` VARCHAR(45) NOT NULL,
  `nombre` VARCHAR(65) NOT NULL,
  `tipo` VARCHAR(45) NOT NULL,
  `subtipo` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`)
)
ENGINE = InnoDB;




insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('1','CAJA','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('1.1','CAJA Y EFECTIVO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('2','BANCOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('2.1','BANCOS NACIONALES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('2.2','BANCOS EXTRANJEROS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('3','INVERSIONES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('3.1','INVERSIONES DE VALORES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('3.2','INVERSIONES TEMPORALES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('4','CLIENTES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('4.1','CLIENTES NACIONALES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('4.2','CLIENTES EXTRANJEROS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('4.3','PARTES RELACIONADAS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('5','CUENTAS POR COBRAR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('5.1','DOCUMENTOS POR COBRAR CORTO PLAZO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('5.2','PARTES RELACIONADAS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('5.3','INTERESES POR COBRAR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('6','TÍTULOS DE CRÉDITO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('6.1','TÍTULOS DE CRÉDITO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('7','CRÉDITOS OTORGADOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('7.1','CRÉDITOS OTORGADOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('8','DEUDORES DIVERSOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('8.1','FUNCIONARIOS Y EMPLEADOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('8.2','SOCIOS ACCIONISTAS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('8.3','PARTES RELACIONADAS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('8.4','OTROS DEUDORES DIVERSOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('9','ESTIMACIÓN DE CUENTAS INCOBRABLES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('9.1','ESTIMACIÓN DE CUENTAS INCOBRABLES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('10','PAGOS ANTICIPADOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('10.1','SEGUROS Y FINANZAS PAGADAS POR ANTICIPADO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('10.2','RENTAS PAGADAS POR ANTICIPADO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('10.3','INTERESES PAGADOS POR ANTICIPADO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('10.4','OTROS PAGOS ANTICIPADOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11','IMPUESTOS A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11.1','IVA A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11.2','ISR A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11.3','IETU A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11.4','IDE A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11.5','IA A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('11.6','OTROS IMPUESTOS A FAVOR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('12','PAGOS PROVISIONALES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('12.1','PAGOS PROVISIONALES ISR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('13','INVENTARIOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('13.1','INVENTARIOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('14','OBRAS EN PROCESO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('14.1','OBRAS EN PROCESO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15','IMPUESTOS ACREDITABLES PAGADOS','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15.1','IVA ACREDITABLE PAGADO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15.2','IVA ACREDITABLE DE IMPORTACIÓN PAGADO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15.3','IEPS ACREDITABLE PAGADO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15.4','IEPS PAGADO EN IMPORTACIÓN','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15.5','IMPUESTOS ACREDITABLES POR PAGAR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('15.6','IVA PENDIENTE DE PAGO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('16','IMPUESTOS ACREDITABLES POR PAGAR','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('16.1','IVA PENDIENTE DE PAGO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('16.2','IVA DE IMPORTACIÓN PENDIENTE DE PAGO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('16.3','IEPS PENDIENTE DE PAGO','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('16.4','IEPS PENDIENTE DE PAGO EN IMPORTACIÓN','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('17','ANTICIPO DE PROVEEDORES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('17.1','ANTICIPO DE PROVEEDORES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('18','OTROS ACTIVOS CIRCULARES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('18.1','OTROS ACTIVOS CIRCULARES','ACTIVO','ACTIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('19','TERRENOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('19.1','TERRENOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('20','EDIFICIOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('20.1','EDIFICIOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('21','MAQUINARIA Y EQUIPO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('21.1','MAQUINARIA Y EQUIPO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('22','EQUIPO DE TRANSPORTE','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('22.1','EQUIPO DE TRANSPORTE','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('23','MOBILIARIO Y EQUIPO DE OFICINA','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('23.1','MOBILIARIO Y EQUIPO DE OFICINA','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('24','EQUIPO DE CÓMPUTO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('24.1','EQUIPO DE CÓMPUTO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25','DEPRECIACIÓN ACUMULADA','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25.1','DEPRECIACIÓN ACUMULADA DE EDIFICIOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25.2','DEPRECIACIÓN ACUMULADA DE MAQUINARIA Y EQUIPO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25.4','DEPRECIACIÓN ACUMULADA DE MOBILIARIO Y EQUIPO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25.5','DEPRECIACIÓN ACUMULADA DE EQUIPO DE CÓMPUTO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25.6','DEPRECIACIÓN ACUMULADA DE OTROS ACTIVOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('25.3','DEPRECIACIÓN ACUMULADA DE EQUIPO DE TRANSPORTE','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('26','ADAPTACIONES Y MEJORAS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('26.1','ADAPTACIONES Y MEJORAS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('27','GASTOS PRE OPERATIVOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('27.1','GASTOS PRE OPERATIVOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('28','GASTOS DE INSTALACIÓN','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('28.1','GASTOS DE INSTALACIÓN','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('29','GASTOS DE ORGANIZACIÓN','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('29.1','GASTOS DE ORGANIZACIÓN','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('30','INVESTIGACIÓN Y DESARROLLO DE MERCADO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('30.1','INVESTIGACIÓN Y DESARROLLO DE MERCADO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('31','MARCAS Y PATENTES','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('31.1','MARCAS Y PATENTES','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('32','DEPÓSITOS DE GARANTÍA','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('32.1','DEPÓSITOS DE GARANTÍA','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('33','CRÉDITO MERCANTIL','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('33.1','CRÉDITO MERCANTIL','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('34','IMPUESTOS DIFERIDOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('34.1','IMPUESTOS DIFERIDOS','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('35','CUENTAS POR COBRAR A LARGO PLAZO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('35.1','CUENTAS POR COBRAR A LARGO PLAZO','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('36','OTROS ACTIVOS NO CIRCULARES','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('36.1','OTROS ACTIVOS NO CIRCULARES','ACTIVO','ACTIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('37','PROVEEDORES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('37.1','PROVEEDORES NACIONALES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('37.2','PROVEEDORES EXTRANJEROS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('37.3','PARTES RELACIONADAS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('38','CUENTAS POR PAGAR A CORTO PLAZO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('38.1','DOCUMENTOS POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('38.2','DOCUMENTOS POR PAGAR BANCARIOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('38.3','DIVIDENDOS POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('38.4','PARTES RELACIONADAS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('38.5','INTERESES POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('39','ACREEDORES DIVERSOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('39.1','SOCIOS,  ACCIONISTAS O REPRESENTANTE LEGAL','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('39.2','PARTES RELACIONADAS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('39.3','OTROS ACREEDORES DIVERSOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('40','ANTICIPO DE CLIENTES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('40.1','ANTICIPO DE CLIENTES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('41','IMPUESTOS TRASLADADOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('41.1','IVA TRASLADADO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('41.2','IEPS TRASLADADO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('42','IMPUESTOS TRASLADADOS COBRADOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('42.1','IVA TRASLADADO COBRADO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('42.2','IEPS TRASLADADO COBRADO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('43','IMPUESTOS TRASLADADOS NO COBRADOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('43.1','IVA TRASLADADO NO COBRADO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('43.2','IVA TRASLADADO NO COBRADO','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44','IMPUESTOS Y DERECHOS POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.1','IVA POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.2','IEPS POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.3','ISR POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.4','PTU POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.5','IETU POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.6','IMPUESTOS ESTATALES Y MUNICIPALES POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.7','OTROS IMPUESTOS POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('44.7','DERECHOS POR PAGAR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45','IMPUESTOS RETENIDOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45.1','RETENCIONES SALARIOS Y ASIMILADOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45.2','RETENCIONES IVA','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45.3','RETENCIONES ARRENDAMIENTO ISR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45.4','RETENCIONES SERVICIOS PROFESIONALES ISR','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45.5','RETENCIONES DIVIDENDOS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('45.6','OTRAS RETENCIONES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('46','PAGOS POR TERCEROS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('46.1','PAGOS POR TERCEROS','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('47','OTROS PASIVOS CIRCULARES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('47.1','OTROS PASIVOS CIRCULARES','PASIVO','PASIVOS CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('48','ACREEDORES A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('48.1','SOCIOS, ACCIONISTAS, REPRESENTANTE LEGAL','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('48.2','PARTES RELACIONADAS','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('48.3','OTROS ACREEDORES A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('49','CUENTAS POR PAGAR A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('49.1','DOCUMENTOS POR PAGAR A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('49.2','DOCUMENTOS POR PAGAR BANCARIOS A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('49.3','PARTES RELACIONADAS','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('49.4','HIPOTECAS POR PAGAR','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('49.5','INTERESES POR PAGAR A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('50','COBROS ANTICIPADOS','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('50.1','RENTA COBRADAS POR ANTICIPADO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('50.2','INTERESES COBRADOS POR ANTICIPADO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('50.3','FACTORAJE FINANCIERO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('50.4','OTROS COBROS POR ANTICIPADO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('51',' OTROS PASIVOS A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('51.1',' OTROS PASIVOS A LARGO PLAZO','PASIVO','PASIVOS NO CIRCULARES');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('52','CAPITAL SOCIAL','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('52.1','CAPITAL FIJO','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('52.2','CAPITAL VARIABLE','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('52.3','APORTACIONES PARA FUTUROS AUMENTOS A CAPITAL','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('53','RESERVA LEGAL','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('53.1','RESERVA LEGAL','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('54','RESULTADO DEL EJERCICIO','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('54.1','UTILIDAD DEL EJERCICIO','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('54.2','PÉRDIDA DEL EJERCICIO','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('55','RESULTADO DE EJERCICIOS ANTERIORES','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('55.1','UTILIDAD DE EJERCICIOS ANTERIORES','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('55.2','PÉRDIDA DE EJERCICIOS ANTERIORES','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('56','OTRAS CUENTAS DE CAPITAL','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('56.1','OTRAS CUENTAS DE CAPITAL','CAPITAL','CAPITAL');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57','VENTAS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57.1','VENTAS GRAVADAS A TASA GENERAL CONTADO','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57.2','VENTAS GRAVADAS A TASA GENERAL CRÉDITO','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57.3','VENTAS GRAVADAS AL 0% CONTADO','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57.4','VENTAS GRAVADAS AL 0% CRÉDITO','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57.5','VENTAS EXENTAS CONTADO','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('57.6','VENTAS EXENTAS CRÉDITO','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('58','DEVOLUCIONES, DESCUENTOS Y REBAJAS SOBRE VENTAS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('58.1','DEVOLUCIONES, DESCUENTOS Y REBAJAS SOBRE VENTAS A TASA GENERAL','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('58.2','DEVOLUCIONES, DESCUENTOS Y REBAJAS SOBRE VENTAS AL 0%','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('58.3','DEVOLUCIONES, DESCUENTOS Y REBAJAS SOBRE VENTAS EXENTAS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('59','PRODUCTOS FINANCIEROS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('59.1','PRODUCTOS FINANCIEROS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('60','OTROS INGRESOS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('60.1','OTROS INGRESOS','INGRESOS','INGRESOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('61','COSTO DE VENTAS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('61.1','COSTO DE VENTAS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('62','COMPRAS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('62.1','COMPRAS NACIONALES','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('62.2','COMPRAS AL EXTRANJERO','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('63','DEVOLUCIONES, DESCUENTOS, Y REBAJAS SOBRE COMPRAS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('63.1','DEVOLUCIONES, DESCUENTOS, Y REBAJAS SOBRE COMPRAS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('64','OTRAS CUENTAS DE COSTOS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('64.1','OTRAS CUENTAS DE COSTOS','COSTOS','COSTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65','GASTOS GENERALES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.1','GASTOS GENERALES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.2','COMBUSTIBLES Y LUBRICANTES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.3','CORREOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.4','INTERNET','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.5','VIÁTICOS Y GASTOS DE VIAJE','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.6','GASTOS DE REPRESENTACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.7','TELÉFONO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.8','AGUA','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.9','ELECTRICIDAD','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.10','VIGILANCIA Y LIMPIEZA','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.11','MATERIALES DE OFICINA','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.12','GASTOS LEGALES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.13','MANTENIMIENTO Y CONSERVACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.14','SEGUROS Y FINANZAS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.15','GASTOS NO DEDUCIBLES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.16','OTROS IMPUESTOS Y DERECHOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.17','RECARGOS FISCALES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.18','CUOTAS Y SUSCRIPCIONES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.19','PROPAGANDA Y PUBLICIDAD','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.20','FOTOCOPIADO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.21','DONATIVOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.22','ASISTENCIA TÉCNICA','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.23','FLETES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.24','IMPUESTO DE IMPORTACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.25','IMPUESTO DE EXPORTACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.26','REGALÍAS SIN RETENCIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.27','REGALÍAS SUJETAS AL 5%','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.28','REGALÍAS SUJETAS AL 10%','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.29','REGALÍAS SUJETAS AL 25%','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.30','REGALÍAS SUJETAS AL 30%','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.31','COMISIONES SOBRE VENTAS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.32','PATENTES Y MARCAS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.33','MATERIAS PRIMAS DE PRODUCCIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.34','MATERIALES AUXILIARES DE PRODUCCIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('65.35','COMISIONES BANCARIAS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('66','GASTOS DE VENTAS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('66.1','GASTOS DE VENTAS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('67','GASTOS DE ADMINISTRACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('67.1','GASTOS DE ADMINISTRACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('68','GASTOS FINANCIEROS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('68.1','GASTOS DE ADMINISTRACIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69','OTROS GASTOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.1','PERDIDA EN VENTA DE TERRENOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.2','PERDIDA EN VENTA DE EDIFICIOS Y CONSTRUCCIÓN','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.3','PERDIDA EN VENTA DE MAQUINARIA','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.4','PERDIDA EN VENTA DE EQUIPO DE TRANSPORTE','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.5','PERDIDA EN VENTA DE MOBILIARIO Y EQUIPO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.6','PERDIDA EN VENTA DE EQUIPO DE COMPUTO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.7','PERDIDA EN VENTA DE ACCIONES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.8','PERDIDA POR DETERIORO DE ACTIVOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('69.9','OTROS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('70','PARTICIPACIÓN DE LOS TRABAJADORES EN LAS UTILIDADES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('70.1','PARTICIPACIÓN DE LOS TRABAJADORES EN LAS UTILIDADES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('71','GASTOS NO DEDUCIBLES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('71.1','GASTOS NO DEDUCIBLES','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72','DEPRECIACIÓN CONTABLE','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72.1','DEPRECIACIÓN CONTABLE DE EDIFICIOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72.2','DEPRECIACIÓN CONTABLE DE MAQUINARIA Y EQUIPO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72.3','DEPRECIACIÓN CONTABLE DE EQUIPO DE TRANSPORTE','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72.4','DEPRECIACIÓN CONTABLE DE MOBILIARIO Y EQUIPO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72.5','DEPRECIACIÓN CONTABLE DE EQUIPO DE CÓMPUTO','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('72.6','DEPRECIACIÓN CONTABLE DE OTROS ACTIVOS','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('73','AMORTIZACIÓN CONTABLE','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('73.1','AMORTIZACIÓN CONTABLE','GASTOS','GASTOS');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('74','CUCA','CUENTAS DE ORDEN','CUENTAS DE ORDEN');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('74.1','CUCA','CUENTAS DE ORDEN','CUENTAS DE ORDEN');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('75','CUFIN','CUENTAS DE ORDEN','CUENTAS DE ORDEN');
insert into tblagrupadorcuentas (codigo,nombre,tipo,subtipo)values('75.1','CUFIN','CUENTAS DE ORDEN','CUENTAS DE ORDEN');

ALTER TABLE `tblccontables` MODIFY COLUMN `Nivel` INTEGER UNSIGNED DEFAULT NULL,
 MODIFY COLUMN `Tipo` INTEGER UNSIGNED DEFAULT NULL,
 MODIFY COLUMN `Naturaleza` INTEGER UNSIGNED DEFAULT NULL,
 ADD COLUMN `fecha` VARCHAR(11) NOT NULL AFTER `N5`;

ALTER TABLE `tblccontables` ADD COLUMN `cmb1` INTEGER UNSIGNED NOT NULL AFTER `fecha`,
 ADD COLUMN `cmb2` INTEGER UNSIGNED NOT NULL AFTER `cmb1`,
 ADD COLUMN `idContable` INTEGER UNSIGNED NOT NULL AFTER `cmb2`;



insert into tblactualizaciones(version) values('ver 9025 rev 6');

